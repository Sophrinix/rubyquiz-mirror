<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>


<!-- Start Wayback Rewrite JS Include -->
<script type="text/javascript" src="/static/js/jwplayer/jwplayer.js" ></script>
<script type="text/javascript" src="/static/js/video-embed-rewriter.js"></script>
<script type="text/javascript">
function initYTVideo(id)
{
	_wmVideos_.init("/web/", id);
}
</script>
<!-- End Wayback Rewrite JS Include -->

  <meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<title>Ruby Quiz - String Equations (#112)</title>
	<link rel="stylesheet" type="text/css" href="/web/20120121203329cs_/http://rubyquiz.com/quiz.css" />
	<link rel="stylesheet" type="text/css" href="/web/20120121203329cs_/http://rubyquiz.com/print.css" media="print" />
</head><body>
<!-- BEGIN WAYBACK TOOLBAR INSERT -->

<script type="text/javascript" src="/static/js/disclaim-element.js" ></script>
<script type="text/javascript" src="/static/js/graph-calc.js" ></script>
<script type="text/javascript" src="/static/jflot/jquery.min.js" ></script>
<script type="text/javascript">
//<![CDATA[
var firstDate = 820454400000;
var lastDate = 1388534399999;
var wbPrefix = "/web/";
var wbCurrentUrl = "http:\/\/rubyquiz.com\/quiz112.html";

var curYear = -1;
var curMonth = -1;
var yearCount = 18;
var firstYear = 1996;
var imgWidth = 450;
var yearImgWidth = 25;
var monthImgWidth = 2;
var trackerVal = "none";
var displayDay = "21";
var displayMonth = "Jan";
var displayYear = "2012";
var prettyMonths = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

function showTrackers(val) {
	if(val == trackerVal) {
		return;
	}
	if(val == "inline") {
		document.getElementById("displayYearEl").style.color = "#ec008c";
		document.getElementById("displayMonthEl").style.color = "#ec008c";
		document.getElementById("displayDayEl").style.color = "#ec008c";		
	} else {
		document.getElementById("displayYearEl").innerHTML = displayYear;
		document.getElementById("displayYearEl").style.color = "#ff0";
		document.getElementById("displayMonthEl").innerHTML = displayMonth;
		document.getElementById("displayMonthEl").style.color = "#ff0";
		document.getElementById("displayDayEl").innerHTML = displayDay;
		document.getElementById("displayDayEl").style.color = "#ff0";
	}
   document.getElementById("wbMouseTrackYearImg").style.display = val;
   document.getElementById("wbMouseTrackMonthImg").style.display = val;
   trackerVal = val;
}
function getElementX2(obj) {
	var thing = jQuery(obj);
	if((thing == undefined) 
			|| (typeof thing == "undefined") 
			|| (typeof thing.offset == "undefined")) {
		return getElementX(obj);
	}
	return Math.round(thing.offset().left);
}
function trackMouseMove(event,element) {

   var eventX = getEventX(event);
   var elementX = getElementX2(element);
   var xOff = eventX - elementX;
	if(xOff < 0) {
		xOff = 0;
	} else if(xOff > imgWidth) {
		xOff = imgWidth;
	}
   var monthOff = xOff % yearImgWidth;

   var year = Math.floor(xOff / yearImgWidth);
	var yearStart = year * yearImgWidth;
   var monthOfYear = Math.floor(monthOff / monthImgWidth);
   if(monthOfYear > 11) {
       monthOfYear = 11;
   }
   // 1 extra border pixel at the left edge of the year:
   var month = (year * 12) + monthOfYear;
   var day = 1;
	if(monthOff % 2 == 1) {
		day = 15;
	}
	var dateString = 
		zeroPad(year + firstYear) + 
		zeroPad(monthOfYear+1,2) +
		zeroPad(day,2) + "000000";

	var monthString = prettyMonths[monthOfYear];
	document.getElementById("displayYearEl").innerHTML = year + 1996;
	document.getElementById("displayMonthEl").innerHTML = monthString;
	// looks too jarring when it changes..
	//document.getElementById("displayDayEl").innerHTML = zeroPad(day,2);

	var url = wbPrefix + dateString + '/' +  wbCurrentUrl;
	document.getElementById('wm-graph-anchor').href = url;

   //document.getElementById("wmtbURL").value="evX("+eventX+") elX("+elementX+") xO("+xOff+") y("+year+") m("+month+") monthOff("+monthOff+") DS("+dateString+") Moy("+monthOfYear+") ms("+monthString+")";
   if(curYear != year) {
       var yrOff = year * yearImgWidth;
       document.getElementById("wbMouseTrackYearImg").style.left = yrOff + "px";
       curYear = year;
   }
   if(curMonth != month) {
       var mtOff = year + (month * monthImgWidth) + 1;
       document.getElementById("wbMouseTrackMonthImg").style.left = mtOff + "px";
       curMonth = month;
   }
}
//]]>
</script>

<style type="text/css">body{margin-top:0!important;padding-top:0!important;min-width:800px!important;}#wm-ipp a:hover{text-decoration:underline!important;}</style>
<div id="wm-ipp" style="display:none; position:relative;padding:0 5px;min-height:70px;min-width:800px; z-index:9000;">
<div id="wm-ipp-inside" style="position:fixed;padding:0!important;margin:0!important;width:97%;min-width:780px;border:5px solid #000;border-top:none;background-image:url(/static/images/toolbar/wm_tb_bk_trns.png);text-align:center;-moz-box-shadow:1px 1px 3px #333;-webkit-box-shadow:1px 1px 3px #333;box-shadow:1px 1px 3px #333;font-size:11px!important;font-family:'Lucida Grande','Arial',sans-serif!important;">
   <table style="border-collapse:collapse;margin:0;padding:0;width:100%;"><tbody><tr>
   <td style="padding:10px;vertical-align:top;min-width:110px;">
   <a href="/web/" title="Wayback Machine home page" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wayback-toolbar-logo.png" alt="Wayback Machine" width="110" height="39" border="0"/></a>
   </td>
   <td style="padding:0!important;text-align:center;vertical-align:top;width:100%;">

       <table style="border-collapse:collapse;margin:0 auto;padding:0;width:570px;"><tbody><tr>
       <td style="padding:3px 0;" colspan="2">
       <form target="_top" method="get" action="/web/form-submit.jsp" name="wmtb" id="wmtb" style="margin:0!important;padding:0!important;"><input type="text" name="url" id="wmtbURL" value="http://rubyquiz.com/quiz112.html" style="width:400px;font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;" onfocus="javascript:this.focus();this.select();" /><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20120121203329" /><input type="submit" value="Go" style="font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;margin-left:5px;" /><span id="wm_tb_options" style="display:block;"></span></form>
       </td>
       <td style="vertical-align:bottom;padding:5px 0 0 0!important;" rowspan="2">
           <table style="border-collapse:collapse;width:110px;color:#99a;font-family:'Helvetica','Lucida Grande','Arial',sans-serif;"><tbody>
			
           <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
           <tr style="width:110px;height:16px;font-size:10px!important;">
           	<td style="padding-right:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20110826110543/http://rubyquiz.com/quiz112.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="26 Aug 2011"><strong>AUG</strong></a>
		                
               </td>
               <td id="displayMonthEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight:bold;text-transform:uppercase;width:34px;height:15px;padding-top:1px;text-align:center;" title="You are here: 20:33:29 Jan 21, 2012">JAN</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20120418151927/http://www.rubyquiz.com/quiz112.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="18 Apr 2012"><strong>APR</strong></a>
		                
               </td>
           </tr>

           <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
           <tr>
               <td style="padding-right:9px;white-space:nowrap;overflow:visible;text-align:right!important;vertical-align:middle!important;" nowrap="nowrap">
               
		                <a href="/web/20110826110543/http://rubyquiz.com/quiz112.html" title="11:05:43 Aug 26, 2011" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0" /></a>
		                
               </td>
               <td id="displayDayEl" style="background:#000;color:#ff0;width:34px;height:24px;padding:2px 0 0 0;text-align:center;font-size:24px;font-weight: bold;" title="You are here: 20:33:29 Jan 21, 2012">21</td>
				<td style="padding-left:9px;white-space:nowrap;overflow:visible;text-align:left!important;vertical-align:middle!important;" nowrap="nowrap">
               
		                <a href="/web/20120418151927/http://www.rubyquiz.com/quiz112.html" title="15:19:27 Apr 18, 2012" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wm_tb_nxt_on.png" alt="Next capture" width="14" height="16" border="0"/></a>
		                
			    </td>
           </tr>

           <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
           <tr style="width:110px;height:13px;font-size:9px!important;">
				<td style="padding-right:9px;font-size:11px!important;font-weight: bold;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20101127175226/http://rubyquiz.com/quiz112.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="27 Nov 2010"><strong>2010</strong></a>
		                
               </td>
               <td id="displayYearEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight: bold;padding-top:1px;width:34px;height:13px;text-align:center;" title="You are here: 20:33:29 Jan 21, 2012">2012</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight: bold;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20130215052710/http://rubyquiz.com/quiz112.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="15 Feb 2013"><strong>2013</strong></a>
		                
				</td>
           </tr>
           </tbody></table>
       </td>

       </tr>
       <tr>
       <td style="vertical-align:middle;padding:0!important;">
           <a href="/web/20120121203329*/http://rubyquiz.com/quiz112.html" style="color:#33f;font-size:11px;font-weight:bold;background-color:transparent;border:none;" title="See a list of every capture for this URL"><strong>24 captures</strong></a>
           <div style="margin:0!important;padding:0!important;color:#666;font-size:9px;padding-top:2px!important;white-space:nowrap;" title="Timespan for captures of this URL">21 Apr 07 - 15 Feb 13</div>
       </td>
       <td style="padding:0!important;">
       <a style="position:relative; white-space:nowrap; width:450px;height:27px;" href="" id="wm-graph-anchor">
       <div id="wm-ipp-sparkline" style="position:relative; white-space:nowrap; width:450px;height:27px;background-color:#fff;cursor:pointer;border-right:1px solid #ccc;" title="Explore captures for this URL">
			<img id="sparklineImgId" style="position:absolute; z-index:9012; top:0px; left:0px;"
				onmouseover="showTrackers('inline');" 
				onmouseout="showTrackers('none');"
				onmousemove="trackMouseMove(event,this)"
				alt="sparklines"
				width="450"
				height="27"
				border="0"
				src="/web/jsp/graph.jsp?graphdata=450_27_1996:-1:000000000000_1997:-1:000000000000_1998:-1:000000000000_1999:-1:000000000000_2000:-1:000000000000_2001:-1:000000000000_2002:-1:000000000000_2003:-1:000000000000_2004:-1:000000000000_2005:-1:000000000000_2006:-1:000000000000_2007:-1:000100100000_2008:-1:000000000000_2009:-1:000000000000_2010:-1:000000000010_2011:-1:000000010000_2012:0:10016000a100_2013:-1:010000000000"></img>
			<img id="wbMouseTrackYearImg" 
				style="display:none; position:absolute; z-index:9010;"
				width="25" 
				height="27"
				border="0"
				src="/static/images/toolbar/transp-yellow-pixel.png"></img>
			<img id="wbMouseTrackMonthImg"
				style="display:none; position:absolute; z-index:9011; " 
				width="2"
				height="27" 
				border="0"
				src="/static/images/toolbar/transp-red-pixel.png"></img>
       </div>
		</a>

       </td>
       </tr></tbody></table>
   </td>
   <td style="text-align:right;padding:5px;width:65px;font-size:11px!important;">
       <a href="javascript:;" onclick="document.getElementById('wm-ipp').style.display='none';" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_close.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;margin-bottom:23px;background-color:transparent;border:none;" title="Close the toolbar">Close</a>
       <a href="http://faq.web.archive.org/" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_help.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;background-color:transparent;border:none;" title="Get some help using the Wayback Machine">Help</a>
   </td>
   </tr></tbody></table>

</div>
</div>
<script type="text/javascript">
 var wmDisclaimBanner = document.getElementById("wm-ipp");
 if(wmDisclaimBanner != null) {
   disclaimElement(wmDisclaimBanner);
 }
</script>
<!-- END WAYBACK TOOLBAR INSERT -->

	<div id="page">
		<div id="header"><span class="ruby">Ruby</span> <span class="quiz">Quiz</span></div>
		<div id="content">
			<span class="title">String Equations (#112)</span>
			<p>This quiz was adapted from an ACM programming challenge at the suggestion of Gavin Kistner.</p>
			<p>Let's define two operators for a simple set of string equations.</p>
			<p>First, we will use the plus (+) operator and keep Ruby's meaning of concatenation for it.  Therefore, "james" + "gray" is "jamesgray".</p>
			<p>The other operator we will support is equality (==).  Two strings will be considered equal if they are anagrams (they contain the same letters in a possibly different ordering).  In other words, "cinema" == "iceman".</p>
			<p>Using these two operators we can build equations:</p>
			<p class="example">"i" + "am" + "lord" + "voldemort" == "tom" + "marvolo" + "riddle"</p>
			<p>This week's quiz is to write a program that accepts a list of words on STDIN and outputs any one string equation using those words, assuming there is one.  Each word in the list may be used zero or more times, but only on one side of the equation.  The program should exit(0) on success and exit(1), without printing any output, if a solution cannot be found.</p>
			<p>Let's sidestep case sensitivity issues by lower casing all incoming words.  You can also remove all non-alphanumeric characters.</p>
			<p>Posting word lists and/or equations is not spoiler material.</p>
			<hr />
			<p><span class="title">Quiz Summary</span></p>
			<p>This quiz is much more difficult than it looks.  There are an infinite number of combinations, even for small word sets, because each term can be repeated.</p>
			<p>To handle this, most brave souls who solved the quiz used some matrix transformations from linear algebra for solving a system of linear equations.  This makes it possible to find solutions in reasonable time, but I had to drag out the math textbooks to decode the solutions.</p>
			<p>Let's take a look into one such solution by Eric I.:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    require <span class="string">'mathn'</span><br /><br />    CompactOutput = <span class="keyword">false</span><br /><br />    <span class="comment"># calculate the least common multiple of one or more numbers</span><br />    <span class="keyword">def</span> lcm(first, *rest)<br />      rest.inject(first) { |l, n| l.lcm(n) }<br />    <span class="keyword">end</span><br /><br />    <span class="comment"># ...</span><br /><br /></div></div>
			<p>This should be pretty easy to digest.  The mathn library is pulled in here to get more accurate results in the calculations the code will be doing, a constant selects the desired output mode, and a shortcut is defined for applying lcm() over an Array of numbers.</p>
			<p>The next method is where all the action is, so let's take that one slowly:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="comment"># ...</span><br /><br />    <span class="comment"># Returns nil if there is no solution or an array containing two</span><br />    <span class="comment"># elements, one for the left side of the equation and one for the</span><br />    <span class="comment"># right side.  Each of those elements is itself an array containing</span><br />    <span class="comment"># pairs, where each pair is an array in which the first element is the</span><br />    <span class="comment"># number of times that word appears and the second element is the</span><br />    <span class="comment"># word.</span><br />    <span class="keyword">def</span> solve_to_array(words)<br />      <span class="comment"># clean up word list by eliminating non-letters, converting to lower</span><br />      <span class="comment"># case, and removing duplicate words</span><br />      words.map! { |word| word.downcase.gsub(<span class="string">/[^a-z]/</span>, <span class="string">''</span>) }.uniq!<br /><br />      <span class="comment"># ...</span><br /><br /></div></div>
			<p>The first comment does a good job of describing the result this method will eventually produce, so you may want to glance back to it when we get that far.</p>
			<p>The first set of operations is the word normalization process right out of the quiz.  This code shouldn't scare anybody yet.  (Just a quick side note though, it is possible to use delete("^a-z") here instead of the gsub() call.)</p>
			<p>One more easy bit of code, then we will ramp things up:</p>
			<div class="code"><span class="type">ruby</span><div class="body">      <span class="comment"># ...</span><br /><br />      <span class="comment"># calculate the letters used in the set of words</span><br />      letters = Hash.new<br />      words.each <span class="keyword">do</span> |word|<br />        word.split(<span class="string">''</span>).each { |letter| letters[letter] = <span class="keyword">true</span> }<br />      <span class="keyword">end</span><br /><br />      <span class="comment"># ...</span><br /><br /></div></div>
			<p>This code just makes a list of all letters used in the word list.  (Only the keys() of the Hash are used.)  To see what that's for, we need to dive into the math:</p>
			<div class="code"><span class="type">ruby</span><div class="body">      <span class="comment"># ...</span><br /><br />      <span class="comment"># create a matrix to represent a set of linear equations.</span><br />      column_count = words.size<br />      row_count = letters.size<br />      equations = []<br />      letters.keys.each <span class="keyword">do</span> |letter|<br />        letter_counts = []<br />        words.each { |word| letter_counts &lt;&lt; word.count(letter) }<br />        equations &lt;&lt; letter_counts<br />      <span class="keyword">end</span><br /><br />      <span class="comment"># ...</span><br /><br /></div></div>
			<p>This code build the matrix we are going to work with to find answers.  Each column in the matrix represents a word and each row a letter.  The numbers in the matrix then are just a count of the letter in that word.  For example, using the quiz equation this code produces the following matrix:</p>
			<p class="example">          v      <br />          o      <br />          l   m  <br />          d   a r<br />          e   r i<br />        l m   v d<br />        o o t o d<br />      a r r o l l<br />    i m d t m o e<br />  +--------------<br />v | 0 0 0 1 0 1 0<br />l | 0 0 1 1 0 1 1<br />a | 0 1 0 0 0 1 0<br />m | 0 1 0 1 1 1 0<br />d | 0 0 1 1 0 0 2<br />o | 0 0 1 2 1 2 0<br />e | 0 0 0 1 0 0 1<br />r | 0 0 1 1 0 1 1<br />t | 0 0 0 1 1 0 0<br />i | 1 0 0 0 0 0 1</p>
			<p>If you glance back at the code now, it should be pretty clear how it builds the matrix as an Array of Arrays.</p>
			<p>Now we're ready to manipulate the matrix and this is the first chunk of code that does that:</p>
			<div class="code"><span class="type">ruby</span><div class="body">      <span class="comment"># ...</span><br /><br />      <span class="comment"># transform matrix into row echelon form</span><br />      equations.size.times <span class="keyword">do</span> |row|<br />        <span class="comment"># re-order the rows, so the row with a value in then next column</span><br />        <span class="comment"># to process is above those that contain zeroes</span><br />        equations.sort! <span class="keyword">do</span> |row1, row2|<br />          column = 0<br />          column += 1 <span class="keyword">until</span> column == column_count ||<br />            row2[column].abs != row1[column].abs<br />          <span class="keyword">if</span> column == column_count : 0<br />          <span class="keyword">else</span> row2[column].abs &lt;=&gt; row1[column].abs<br />          <span class="keyword">end</span><br />        <span class="keyword">end</span><br /><br />        <span class="comment"># figure out which column to work on</span><br />        column = (0...column_count).detect { |i| equations[row][i] != 0 }<br />        <span class="keyword">break</span> <span class="keyword">unless</span> column<br /><br />        <span class="comment"># transform rows below the current row so that there is a zero in</span><br />        <span class="comment"># the column being worked on</span><br />        ((row + 1)...equations.size).each <span class="keyword">do</span> |row2|<br />          factor = -equations[row2][column] / equations[row][column]<br />          (column...column_count).each <span class="keyword">do</span> |c|<br />            equations[row2][c] += factor * equations[row][c]<br />          <span class="keyword">end</span><br />        <span class="keyword">end</span><br />      <span class="keyword">end</span><br /><br />      <span class="comment"># ...</span><br /><br /></div></div>
			<p>Now you really don't want me to describe that line by line.  Trust me.  Instead, let me sum up what it does.</p>
			<p>This code transforms the matrix into row echelon form, which says that higher rows in the matrix have entries in further left columns and that the first significant entry in a row is preceded only by zeros.  That sounds scarier than it is.  Here's the transformed matrix (without the labels this time):</p>
			<p class="example">1  0  0  0  0  0  1<br />0  1  0  1  1  1  0<br />0  0  1  2  1  2  0<br />0  0  0 -1 -1 -2  2<br />0  0  0  0 -1 -2  3<br />0  0  0  0  0 -2  2<br />0  0  0  0  0  0  0<br />0  0  0  0  0  0  0<br />0  0  0  0  0  0  0<br />0  0  0  0  0  0  0</p>
			<p>The why behind this transformation is that its the first step in solving for our equation.</p>
			<p>On to the next bit of code:</p>
			<div class="code"><span class="type">ruby</span><div class="body">      <span class="comment"># ...</span><br /><br />      <span class="comment"># only one of the free variables chosen randomly will get a 1, the</span><br />      <span class="comment"># rest 0</span><br />      rank = equations.select { |row| row.any? { |v| v != 0 }}.size<br />      free = equations[0].size - rank<br />      free_values = Array.new(free, 0)<br />      free_values[rand(free)] = 2 * rand(2) - 1<br /><br />      <span class="comment"># ...</span><br /><br /></div></div>
			<p>This bit of math uses the rank of the matrix to determine the free variables it will solve for.  Free variables are just placeholders for substitutions in our system of equations.  More concretely, they are where one or more words will be inserted in our string equations.</p>
			<p>Setting a single value to one, as the comment mentions, is basically preparing to to work with one word at a time.  That's why the others are zeroed out.</p>
			<p>One more variable is prepared:</p>
			<div class="code"><span class="type">ruby</span><div class="body">      <span class="comment"># ...</span><br /><br />      values = Array.new(equations[0].size)  <span class="comment"># holds the word_counts</span><br /><br />      <span class="comment"># ...</span><br /><br /></div></div>
			<p>As the comment explains, this will eventually be the counts for each word.</p>
			<p>OK, here's the last big bit of math:</p>
			<div class="code"><span class="type">ruby</span><div class="body">      <span class="comment"># ...</span><br /><br />      <span class="comment"># use backward elimination to find values for the variables; process</span><br />      <span class="comment"># each row in reverse order</span><br />      equations.reverse_each <span class="keyword">do</span> |row|<br />        <span class="comment"># determine number of free variables for the given row</span><br />        free_variables = (0...column_count).inject(0) <span class="keyword">do</span> |sum, index|<br />          row[index] != 0 &amp;&amp; values[index].nil? ? sum + 1 : sum<br />        <span class="keyword">end</span><br /><br />        <span class="comment"># on this row, 1 free variable will be calculated, the others will</span><br />        <span class="comment"># get the predetermined free values; the one being calculated is</span><br />        <span class="comment"># marked with nil</span><br />        free_values.insert(rand(free_variables), <span class="keyword">nil</span>) <span class="keyword">if</span> free_variables &gt; 0<br /><br />        <span class="comment"># assign values to the variables</span><br />        sum = 0<br />        calc_index = <span class="keyword">nil</span><br />        row.each_index <span class="keyword">do</span> |index|<br />          <span class="keyword">if</span> row[index] != 0<br />            <span class="keyword">if</span> values[index].nil?<br />              values[index] = free_values.shift<br /><br />              <span class="comment"># determine if this is a calculated or given free value</span><br />              <span class="keyword">if</span> values[index] : sum += values[index] * row[index]<br />              <span class="keyword">else</span> calc_index = index<br />              <span class="keyword">end</span><br />            <span class="keyword">else</span><br />              sum += values[index] * row[index]<br />            <span class="keyword">end</span><br />          <span class="keyword">end</span><br />        <span class="keyword">end</span><br />        <span class="comment"># calculate the remaining value on the row</span><br />        values[calc_index] = -sum / row[calc_index] <span class="keyword">if</span> calc_index<br />      <span class="keyword">end</span><br /><br />      <span class="comment"># ...</span><br /><br /></div></div>
			<p>This elimination is the second and final matrix transform leading to a solution.  The code works through each row or equation of the matrix, determining values for the free variables.</p>
			<p>Again this process is much more linear algebra than Ruby, so I won't bother to break it down line by line.  Just know that the end result of this process is that values now holds the counts of the words needed to solve quiz.  Positive counts belong on one side of the equation, negative counts on the other.</p>
			<p>This is the code that breaks down those counts:</p>
			<div class="code"><span class="type">ruby</span><div class="body">      <span class="comment"># ...</span><br /><br />      <span class="keyword">if</span> values.all? { |v| v } &amp;&amp; values.any? { |v| v != 0 }<br />        <span class="comment"># in case we ended up with any non-integer values, multiply all</span><br />        <span class="comment"># values by their collective least common multiple of the</span><br />        <span class="comment"># denominators</span><br />        multiplier =<br />          lcm(*values.map { |v| v.kind_of?(Rational) ? v.denominator : 1 })<br />        values.map! { |v| v * multiplier }<br /><br />        <span class="comment"># deivide the terms into each side of the equation depending on</span><br />        <span class="comment"># whether the value is positive or negative</span><br />        left, right = [], []<br />        values.each_index <span class="keyword">do</span> |i|<br />          <span class="keyword">if</span> values[i] &gt; 0 : left &lt;&lt; [values[i], words[i]]<br />          <span class="keyword">elsif</span> values[i] &lt; 0 : right &lt;&lt; [-values[i], words[i]]<br />          <span class="keyword">end</span><br />        <span class="keyword">end</span><br /><br />        [left, right]   <span class="comment"># return found equation</span><br />      <span class="keyword">else</span><br />        <span class="keyword">nil</span>  <span class="comment"># return no found equation</span><br />      <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br />    <span class="comment"># ...</span><br /><br /></div></div>
			<p>Assuming we found a solution, this code divides the words to be used into two groups, one for each side of the equation.  It divides based on the positive and negative counts I just explained in values and the end result was described in that first comment at the top of this long method.</p>
			<p>With the math behind us, the rest of the code is easy:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="comment"># ...</span><br /><br />    <span class="comment"># Returns a string containing a solution if one exists; otherwise</span><br />    <span class="comment"># returns nil.  The returned string can be in either compact or</span><br />    <span class="comment"># non-compact form depending on the CompactOutput boolean constant.</span><br />    <span class="keyword">def</span> solve_to_string(words)<br />      result = solve_to_array(words)<br />      <span class="keyword">if</span> result<br />        <span class="keyword">if</span> CompactOutput<br />          result.map <span class="keyword">do</span> |side|<br />            side.map { |term| <span class="string">"#{term[0]}*\"#{term[1]}\""</span> }.join(<span class="string">' + '</span>)<br />          <span class="keyword">end</span>.join(<span class="string">" == "</span>)<br />        <span class="keyword">else</span><br />          result.map <span class="keyword">do</span> |side|<br />            side.map { |term| ([<span class="string">"\"#{term[1]}\""</span>] * term[0]).join(<span class="string">' + '</span>) }.<br />              join(<span class="string">' + '</span>)<br />          <span class="keyword">end</span>.join(<span class="string">" == "</span>)<br />        <span class="keyword">end</span><br />      <span class="keyword">else</span><br />        <span class="keyword">nil</span><br />      <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br />    <span class="comment"># ...</span><br /><br /></div></div>
			<p>This method just wraps the previous solver and transforms the resulting Arrays into the quiz equation format.  Two different output options are controlled by the constant we saw at the beginning of the program.</p>
			<p>Here's the final piece of the puzzle:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="comment"># ...</span><br /><br />    <span class="keyword">if</span> <span class="keyword">__FILE__</span> == <span class="global">$0</span>  <span class="comment"># if run from the command line...</span><br />      <span class="comment"># collect words from STDIN</span><br />      words = []<br />      <span class="keyword">while</span> line = gets<br />        words &lt;&lt; line.chomp<br />      <span class="keyword">end</span><br /><br />      result = solve_to_string(words)<br /><br />      <span class="keyword">if</span> result : puts result<br />      <span class="keyword">else</span> exit 1<br />      <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br /></div></div>
			<p>This code just brings in the word list, taps the solver to do the hard work, and sends back the results.  This turns the code into a complete solution.</p>
			<p>My thanks to all of you who know math so much better than me.  I had to use math books and my pet math nerd just to breakdown how these solutions worked.</p>
			<p>Tomorrow we return to easier problems, pop quiz style...</p>
		</div>
		<div id="logo"><img src="/web/20120121203329im_/http://rubyquiz.com/images/ruby_quiz_logo.jpg" alt="" width="157" height="150" /></div>
		<div id="links">
			<span class="title">Quiz Solutions</span>
			<ol>
				<li><a href="/web/20120121203329/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/237546">Paolo Negri</a></li>
				<li><a href="/web/20120121203329/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/237549">Sander Land</a></li>
				<li><a href="/web/20120121203329/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/237557">Daniel Lucraft</a></li>
				<li><a href="/web/20120121203329/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/237574">Eric I.</a></li>
				<li><a href="/web/20120121203329/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/238261">Kyle Schmitt</a></li>
			</ol>
			<p><a href="/web/20120121203329/http://rubyquiz.com/quiz112_sols.zip">Download Solutions</a></p>
			<p><a href="/web/20120121203329/http://rubyquiz.com/index.html">Back to Quiz Listing</a></p>
		</div>
		<div id="footer">&nbsp;</div>
	</div>
</body>
</html>





<!--
     FILE ARCHIVED ON 20:33:29 Jan 21, 2012 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 13:10:38 Jun 5, 2013.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
