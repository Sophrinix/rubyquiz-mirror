<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>


<!-- Start Wayback Rewrite JS Include -->
<script type="text/javascript" src="/static/js/jwplayer/jwplayer.js" ></script>
<script type="text/javascript" src="/static/js/video-embed-rewriter.js"></script>
<script type="text/javascript">
function initYTVideo(id)
{
	_wmVideos_.init("/web/", id);
}
</script>
<!-- End Wayback Rewrite JS Include -->

  <meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<title>Ruby Quiz - Housie (#114)</title>
	<link rel="stylesheet" type="text/css" href="/web/20120121202409cs_/http://rubyquiz.com/quiz.css" />
	<link rel="stylesheet" type="text/css" href="/web/20120121202409cs_/http://rubyquiz.com/print.css" media="print" />
</head><body>
<!-- BEGIN WAYBACK TOOLBAR INSERT -->

<script type="text/javascript" src="/static/js/disclaim-element.js" ></script>
<script type="text/javascript" src="/static/js/graph-calc.js" ></script>
<script type="text/javascript" src="/static/jflot/jquery.min.js" ></script>
<script type="text/javascript">
//<![CDATA[
var firstDate = 820454400000;
var lastDate = 1388534399999;
var wbPrefix = "/web/";
var wbCurrentUrl = "http:\/\/rubyquiz.com\/quiz114.html";

var curYear = -1;
var curMonth = -1;
var yearCount = 18;
var firstYear = 1996;
var imgWidth = 450;
var yearImgWidth = 25;
var monthImgWidth = 2;
var trackerVal = "none";
var displayDay = "21";
var displayMonth = "Jan";
var displayYear = "2012";
var prettyMonths = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

function showTrackers(val) {
	if(val == trackerVal) {
		return;
	}
	if(val == "inline") {
		document.getElementById("displayYearEl").style.color = "#ec008c";
		document.getElementById("displayMonthEl").style.color = "#ec008c";
		document.getElementById("displayDayEl").style.color = "#ec008c";		
	} else {
		document.getElementById("displayYearEl").innerHTML = displayYear;
		document.getElementById("displayYearEl").style.color = "#ff0";
		document.getElementById("displayMonthEl").innerHTML = displayMonth;
		document.getElementById("displayMonthEl").style.color = "#ff0";
		document.getElementById("displayDayEl").innerHTML = displayDay;
		document.getElementById("displayDayEl").style.color = "#ff0";
	}
   document.getElementById("wbMouseTrackYearImg").style.display = val;
   document.getElementById("wbMouseTrackMonthImg").style.display = val;
   trackerVal = val;
}
function getElementX2(obj) {
	var thing = jQuery(obj);
	if((thing == undefined) 
			|| (typeof thing == "undefined") 
			|| (typeof thing.offset == "undefined")) {
		return getElementX(obj);
	}
	return Math.round(thing.offset().left);
}
function trackMouseMove(event,element) {

   var eventX = getEventX(event);
   var elementX = getElementX2(element);
   var xOff = eventX - elementX;
	if(xOff < 0) {
		xOff = 0;
	} else if(xOff > imgWidth) {
		xOff = imgWidth;
	}
   var monthOff = xOff % yearImgWidth;

   var year = Math.floor(xOff / yearImgWidth);
	var yearStart = year * yearImgWidth;
   var monthOfYear = Math.floor(monthOff / monthImgWidth);
   if(monthOfYear > 11) {
       monthOfYear = 11;
   }
   // 1 extra border pixel at the left edge of the year:
   var month = (year * 12) + monthOfYear;
   var day = 1;
	if(monthOff % 2 == 1) {
		day = 15;
	}
	var dateString = 
		zeroPad(year + firstYear) + 
		zeroPad(monthOfYear+1,2) +
		zeroPad(day,2) + "000000";

	var monthString = prettyMonths[monthOfYear];
	document.getElementById("displayYearEl").innerHTML = year + 1996;
	document.getElementById("displayMonthEl").innerHTML = monthString;
	// looks too jarring when it changes..
	//document.getElementById("displayDayEl").innerHTML = zeroPad(day,2);

	var url = wbPrefix + dateString + '/' +  wbCurrentUrl;
	document.getElementById('wm-graph-anchor').href = url;

   //document.getElementById("wmtbURL").value="evX("+eventX+") elX("+elementX+") xO("+xOff+") y("+year+") m("+month+") monthOff("+monthOff+") DS("+dateString+") Moy("+monthOfYear+") ms("+monthString+")";
   if(curYear != year) {
       var yrOff = year * yearImgWidth;
       document.getElementById("wbMouseTrackYearImg").style.left = yrOff + "px";
       curYear = year;
   }
   if(curMonth != month) {
       var mtOff = year + (month * monthImgWidth) + 1;
       document.getElementById("wbMouseTrackMonthImg").style.left = mtOff + "px";
       curMonth = month;
   }
}
//]]>
</script>

<style type="text/css">body{margin-top:0!important;padding-top:0!important;min-width:800px!important;}#wm-ipp a:hover{text-decoration:underline!important;}</style>
<div id="wm-ipp" style="display:none; position:relative;padding:0 5px;min-height:70px;min-width:800px; z-index:9000;">
<div id="wm-ipp-inside" style="position:fixed;padding:0!important;margin:0!important;width:97%;min-width:780px;border:5px solid #000;border-top:none;background-image:url(/static/images/toolbar/wm_tb_bk_trns.png);text-align:center;-moz-box-shadow:1px 1px 3px #333;-webkit-box-shadow:1px 1px 3px #333;box-shadow:1px 1px 3px #333;font-size:11px!important;font-family:'Lucida Grande','Arial',sans-serif!important;">
   <table style="border-collapse:collapse;margin:0;padding:0;width:100%;"><tbody><tr>
   <td style="padding:10px;vertical-align:top;min-width:110px;">
   <a href="/web/" title="Wayback Machine home page" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wayback-toolbar-logo.png" alt="Wayback Machine" width="110" height="39" border="0"/></a>
   </td>
   <td style="padding:0!important;text-align:center;vertical-align:top;width:100%;">

       <table style="border-collapse:collapse;margin:0 auto;padding:0;width:570px;"><tbody><tr>
       <td style="padding:3px 0;" colspan="2">
       <form target="_top" method="get" action="/web/form-submit.jsp" name="wmtb" id="wmtb" style="margin:0!important;padding:0!important;"><input type="text" name="url" id="wmtbURL" value="http://rubyquiz.com/quiz114.html" style="width:400px;font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;" onfocus="javascript:this.focus();this.select();" /><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20120121202409" /><input type="submit" value="Go" style="font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;margin-left:5px;" /><span id="wm_tb_options" style="display:block;"></span></form>
       </td>
       <td style="vertical-align:bottom;padding:5px 0 0 0!important;" rowspan="2">
           <table style="border-collapse:collapse;width:110px;color:#99a;font-family:'Helvetica','Lucida Grande','Arial',sans-serif;"><tbody>
			
           <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
           <tr style="width:110px;height:16px;font-size:10px!important;">
           	<td style="padding-right:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20110826105838/http://rubyquiz.com/quiz114.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="26 Aug 2011"><strong>AUG</strong></a>
		                
               </td>
               <td id="displayMonthEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight:bold;text-transform:uppercase;width:34px;height:15px;padding-top:1px;text-align:center;" title="You are here: 20:24:09 Jan 21, 2012">JAN</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20120418140620/http://www.rubyquiz.com/quiz114.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="18 Apr 2012"><strong>APR</strong></a>
		                
               </td>
           </tr>

           <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
           <tr>
               <td style="padding-right:9px;white-space:nowrap;overflow:visible;text-align:right!important;vertical-align:middle!important;" nowrap="nowrap">
               
		                <a href="/web/20110826105838/http://rubyquiz.com/quiz114.html" title="10:58:38 Aug 26, 2011" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0" /></a>
		                
               </td>
               <td id="displayDayEl" style="background:#000;color:#ff0;width:34px;height:24px;padding:2px 0 0 0;text-align:center;font-size:24px;font-weight: bold;" title="You are here: 20:24:09 Jan 21, 2012">21</td>
				<td style="padding-left:9px;white-space:nowrap;overflow:visible;text-align:left!important;vertical-align:middle!important;" nowrap="nowrap">
               
		                <a href="/web/20120418140620/http://www.rubyquiz.com/quiz114.html" title="14:06:20 Apr 18, 2012" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wm_tb_nxt_on.png" alt="Next capture" width="14" height="16" border="0"/></a>
		                
			    </td>
           </tr>

           <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
           <tr style="width:110px;height:13px;font-size:9px!important;">
				<td style="padding-right:9px;font-size:11px!important;font-weight: bold;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20101127174251/http://rubyquiz.com/quiz114.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="27 Nov 2010"><strong>2010</strong></a>
		                
               </td>
               <td id="displayYearEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight: bold;padding-top:1px;width:34px;height:13px;text-align:center;" title="You are here: 20:24:09 Jan 21, 2012">2012</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight: bold;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20130215052823/http://rubyquiz.com/quiz114.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="15 Feb 2013"><strong>2013</strong></a>
		                
				</td>
           </tr>
           </tbody></table>
       </td>

       </tr>
       <tr>
       <td style="vertical-align:middle;padding:0!important;">
           <a href="/web/20120121202409*/http://rubyquiz.com/quiz114.html" style="color:#33f;font-size:11px;font-weight:bold;background-color:transparent;border:none;" title="See a list of every capture for this URL"><strong>25 captures</strong></a>
           <div style="margin:0!important;padding:0!important;color:#666;font-size:9px;padding-top:2px!important;white-space:nowrap;" title="Timespan for captures of this URL">21 Apr 07 - 15 Feb 13</div>
       </td>
       <td style="padding:0!important;">
       <a style="position:relative; white-space:nowrap; width:450px;height:27px;" href="" id="wm-graph-anchor">
       <div id="wm-ipp-sparkline" style="position:relative; white-space:nowrap; width:450px;height:27px;background-color:#fff;cursor:pointer;border-right:1px solid #ccc;" title="Explore captures for this URL">
			<img id="sparklineImgId" style="position:absolute; z-index:9012; top:0px; left:0px;"
				onmouseover="showTrackers('inline');" 
				onmouseout="showTrackers('none');"
				onmousemove="trackMouseMove(event,this)"
				alt="sparklines"
				width="450"
				height="27"
				border="0"
				src="/web/jsp/graph.jsp?graphdata=450_27_1996:-1:000000000000_1997:-1:000000000000_1998:-1:000000000000_1999:-1:000000000000_2000:-1:000000000000_2001:-1:000000000000_2002:-1:000000000000_2003:-1:000000000000_2004:-1:000000000000_2005:-1:000000000000_2006:-1:000000000000_2007:-1:000100100000_2008:-1:000000000000_2009:-1:000000000000_2010:-1:100000000010_2011:-1:000000010000_2012:0:10016000a100_2013:-1:010000000000"></img>
			<img id="wbMouseTrackYearImg" 
				style="display:none; position:absolute; z-index:9010;"
				width="25" 
				height="27"
				border="0"
				src="/static/images/toolbar/transp-yellow-pixel.png"></img>
			<img id="wbMouseTrackMonthImg"
				style="display:none; position:absolute; z-index:9011; " 
				width="2"
				height="27" 
				border="0"
				src="/static/images/toolbar/transp-red-pixel.png"></img>
       </div>
		</a>

       </td>
       </tr></tbody></table>
   </td>
   <td style="text-align:right;padding:5px;width:65px;font-size:11px!important;">
       <a href="javascript:;" onclick="document.getElementById('wm-ipp').style.display='none';" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_close.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;margin-bottom:23px;background-color:transparent;border:none;" title="Close the toolbar">Close</a>
       <a href="http://faq.web.archive.org/" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_help.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;background-color:transparent;border:none;" title="Get some help using the Wayback Machine">Help</a>
   </td>
   </tr></tbody></table>

</div>
</div>
<script type="text/javascript">
 var wmDisclaimBanner = document.getElementById("wm-ipp");
 if(wmDisclaimBanner != null) {
   disclaimElement(wmDisclaimBanner);
 }
</script>
<!-- END WAYBACK TOOLBAR INSERT -->

	<div id="page">
		<div id="header"><span class="ruby">Ruby</span> <span class="quiz">Quiz</span></div>
		<div id="content">
			<span class="title">Housie (#114)</span>
			<p>by Brian Candler</p>
			<p>A version of Bingo played in the UK and some other countries is called "Housie". Players buy "books" of 6 tickets. Each ticket shows exactly 15 numbers, and in each book every number from 1 to 90 is used exactly once.</p>
			<p>A ticket is a grid of 3 rows by 9 columns. The first column contains numbers from 1 to 9; the second column numbers from 10 to 19; the third 20 to 29 and so on up until the last column, which contains numbers from 80 to 90.</p>
			<p>Each column contains one, two or three numbers, in increasing order downwards. Each row contains exactly 5 numbers (and hence 4 blanks).</p>
			<p>An example ticket looks like this:</p>
			<p class="example">+----+----+----+----+----+----+----+----+----+<br />|  5 |    |    |    | 49 |    | 63 | 75 | 80 |<br />+----+----+----+----+----+----+----+----+----+<br />|    |    | 28 | 34 |    | 52 | 66 | 77 |    |<br />+----+----+----+----+----+----+----+----+----+<br />|  6 | 11 |    |    |    | 59 | 69 |    | 82 |<br />+----+----+----+----+----+----+----+----+----+</p>
			<p>There are two levels of quiz difficulty to choose from. Given the above rules for the validity of tickets and books, then:</p>
			<p class="example">1. Write a Ruby program which generates random individual tickets<br />or<br />2. Write a Ruby program which generates random complete books of tickets</p>
			<hr />
			<p><span class="title">Quiz Summary</span></p>
			<p>Eric I. said it best in a note attached to his solution:</p>
			<p class="example">I really enjoyed this quiz.  On the surface it seems relatively simple.<br />But there are some important subtleties.</p>
			<p>This is the realization I came to as well.  When Brian first suggested the quiz, we discussed the possible solutions.  When I say discussed, I mean that Brian generated a nearly endless stream of excellent ideas while I watched it all happen.  The more he generated, the more I realized how much I liked the problem.  It's quite rich.</p>
			<p>There are many ways to approach this quiz.  Brian's own solution generates bit map patterns representing blanks and non-blanks in a ticket, then uses those patterns to construct books filling in numbers as it works.  Eric I. used a backtracking search, verifying that a solution is still possible as each ticket is added.  Below I will examine a slightly simpler solution, that still produces pretty good results.</p>
			<p>Andy Restrepo's code is a random generation scheme.  It builds random books from random tickets made out of random rows.  If the book doesn't end up being valid, it just tries again.  However, it arranges the random generation such that rows are correct more often than you might expect.</p>
			<p>Let's jump into the code to see how it does that.  The process begins with this trivial call:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    TicketGenerator.new.print_book<br /><br /></div></div>
			<p>That's Ruby's default new() and TicketGenerator doesn't define an initialize() method, so let's skip to print_book():</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="keyword">class</span> TicketGenerator<br />     <span class="keyword">def</span> print_book<br />       <span class="comment"># Keep generating ticket books until a valid</span><br />       <span class="comment"># one is returned.  Then, print out the tickets.</span><br />       book = build_book <span class="keyword">until</span> book<br />       book.each { |t| t.print_ticket; puts <span class="string">"\n"</span>}<br />     <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br /></div></div>
			<p>This is the process I explained earlier.  An attempt is made to build a book.  If we get one, we're done.  Otherwise we try again.  When we have them all, the tickets in the book are printed.</p>
			<p>Let's dig deeper into book creation:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="keyword">class</span> TicketGenerator<br />     <span class="keyword">def</span> build_book<br />       <span class="comment"># Generate 18 rows and divide them between six tickets</span><br />       init_bins<br />       all_rows = Array.new(18){ retrieve_row }<br />       tickets = Array.new<br />       0.step(15, 3) <span class="keyword">do</span> |x|<br />         ticket = Ticket.new(all_rows[x...x+3].sort_by { rand })<br />         tickets.push(ticket)<br />         <span class="comment"># If an invalid ticket is found, indicate failure</span><br />         <span class="comment"># by setting the return value to false.</span><br />         <span class="keyword">if</span> <span class="keyword">not</span> ticket.is_valid?<br />           tickets = <span class="keyword">false</span>; <span class="keyword">break</span><br />         <span class="keyword">end</span><br />       <span class="keyword">end</span><br />       tickets<br />     <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br /></div></div>
			<p>The first two lines here make use of other methods in the class to create a set of 18 rows.  We will get to those methods in a moment, but take it on faith for now.</p>
			<p>The rest of the method walks those rows in threes, making Ticket objects out of them.  Each time a Ticket is made, the code ensures it is valid or bails out. We haven't seen this class yet either, but it shouldn't too hard to guess what the is_valid?() method does.</p>
			<p>Here are the row making methods (with one minor edit by me):</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="keyword">class</span> TicketGenerator<br />     <span class="keyword">def</span> init_bins<br />       <span class="comment"># Create and fill the 9 bins of numbers, corresponding to</span><br />       <span class="comment"># the allowed numbers for each column.</span><br />       <span class="variable">@bins</span> = Array.new<br />       <span class="comment"># 1 through 9</span><br />       <span class="variable">@bins</span> &lt;&lt; (1..9).sort_by{ rand }<br />       <span class="comment"># 10 through 19, 20 through 29, etc.</span><br />       10.step(70, 10) <span class="keyword">do</span> |x|<br />         <span class="variable">@bins</span> &lt;&lt; (x..x+9).sort_by{ rand }<br />       <span class="keyword">end</span><br />       <span class="comment"># 80 through 90</span><br />       <span class="variable">@bins</span> &lt;&lt; (80..90).sort_by{ rand }<br />     <span class="keyword">end</span><br />     <span class="keyword">def</span> retrieve_row<br />       <span class="comment"># Create a row by pulling one number from each of five non-empty bins.</span><br />       row = Array.new(9, <span class="keyword">nil</span>)<br />       <span class="comment"># Randomize which bins to choose from, but favor the most filled</span><br />       <span class="comment"># bins -- so we don't end up with less than 5 non-empty bins with</span><br />       <span class="comment"># still more rows to create.</span><br />       bin_index_array = (0...<span class="variable">@bins</span>.length).sort_by{ |b|<br />         [<span class="variable">@bins</span>[b].length, rand]<br />       }<br />       5.times <span class="keyword">do</span><br />         bin_index = bin_index_array.pop<br />         row[bin_index] = <span class="variable">@bins</span>[bin_index].pop<br />       <span class="keyword">end</span><br />       row<br />     <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br /></div></div>
			<p>First, init_bins() fills an Array with Arrays of randomized numbers for each column.  These columns span six tickets and are used to build the entire book.</p>
			<p>Now, retrieve_row() is used to create the 18 rows the code eventually builds books out of.  It works by creating an empty row, choosing five of the column bins, and adding a random number to the row from each bin.  The selection of bins is not-quite-random and that turns out to be the best and worst feature of this solution.</p>
			<p>Bins are sorted first by length and then in random order before a pick is made from the end.  This means that a selection will always be made from a bin with the most members remaining.  That bin is selected randomly from those with the same number of members remaining, but that doesn't mean the choice is random.</p>
			<p>Think of it this way, the bins don't even start with the same number of members.  The eighth bin has eleven and will always sort to be chosen first.  Likewise, the zeroth bin always sorts first and thus cannot be selected by this algorithm during the creation of the first row.  Even after the first row is created the eighth bin will still be tied for most entries and thus it will always come up again in the second row.  That means the first ticket produced by this solution will always have two or three numbers in the final column.  Never just one.</p>
			<p>The downside of all of this is that the tickets aren't completely random.  There's a pattern to them and you can find it if you look for it.  Given that, these books would be fine for casual play, but probably not for games where money is on the line.</p>
			<p>The upside is speed.  Even though tickets are randomly generated, the sorting keeps valid combination extremely likely.  In a set of ten sample runs I conducted the code only called build_book() a maximum of two times per run and it only needed one call eight out of ten times.  A truly random pattern would need a lot more attempts to find a workable solution.  You can simulate this scenario by removing the bin length sort condition from Andy's code.  It still finds answers, but it can take some time.</p>
			<p>The last bit of TicketGenerator code sets method visibility:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="keyword">class</span> TicketGenerator<br />     private :init_bins, :retrieve_row, :build_book<br />     public :print_book<br />    <span class="keyword">end</span><br /><br /></div></div>
			<p>The other piece of this puzzle is the Ticket class, so we will look at that now.  Tickets are just three rows that know how to validate and draw themselves.  The initialization process for a Ticket is spread over three methods, so let's begin with those:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="keyword">class</span> Ticket<br />     <span class="keyword">def</span> initialize(rows)<br />       <span class="comment"># A ticket consists of an array of three rows,</span><br />       <span class="comment"># with 5 numbers and 4 nil entries per row.</span><br />       <span class="variable">@rows</span> = rows<br />       <span class="variable">@empty_column</span> = <span class="keyword">false</span><br />       validate_ticket<br />     <span class="keyword">end</span><br />     <span class="keyword">def</span> validate_ticket<br />       <span class="comment"># Convert three rows of 9 numbers into 9 columns of three numbers,</span><br />       <span class="comment"># check that each column satisfies the ascending order constraint,</span><br />       <span class="comment"># and then convert back into rows.</span><br />       columns = Array.new(9) { [] }<br />       columns.each { |c| <span class="variable">@rows</span>.each { |r| c &lt;&lt; r.shift }; rectify(c) }<br />       <span class="variable">@rows</span>.each { |r| columns.each { |c| r &lt;&lt; c.shift } }<br />     <span class="keyword">end</span><br />     <span class="keyword">def</span> rectify(column)<br />       <span class="comment"># If there are 2 or 3 numbers in a column, they must</span><br />       <span class="comment"># appear in increasing order downward.  If they don't, then</span><br />       <span class="comment"># swap the numbers around while maintaining 5 numbers</span><br />       <span class="comment"># in each row.</span><br />       <span class="keyword">case</span> column.nitems<br />         <span class="keyword">when</span> 0 <span class="keyword">then</span> <span class="variable">@empty_column</span> = <span class="keyword">true</span><br />         <span class="keyword">when</span> 1 <span class="keyword">then</span> column <span class="comment"># do nothing</span><br />         <span class="keyword">when</span> 2<br />           nil_index = column.index(<span class="keyword">nil</span>)<br />           non_nils = [0,1,2] - [nil_index]<br />           first_nn, last_nn = non_nils.first, non_nils.last<br />           <span class="comment"># Swap the two non-nil elements</span><br />           <span class="keyword">if</span> column[first_nn] &gt; column[last_nn]<br />             column[first_nn], column[last_nn] = column[last_nn],<br />                                                 column[first_nn]<br />           <span class="keyword">end</span><br />         <span class="keyword">when</span> 3 <span class="keyword">then</span> column.sort! <span class="comment"># just sort the three numbers</span><br />       <span class="keyword">end</span><br />     <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br /></div></div>
			<p>You can see that initialize() just stores the rows and kicks off validate_ticket().  That method does a bit of a dance to rearrange the rows into columns, clean and validate those columns, and change them back.  Array#transpose() probably would have simplified this process a bit.</p>
			<p>The real work happens in rectify().  This method serves two purposes.  Its main job is to reorder the numbers in a column to ensure they count down.  As it works though, it watches for empty columns that would invalidate the Ticket.</p>
			<p>Once we know whether or not a Ticket is valid, we need to provide easy access to that information:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="keyword">class</span> Ticket<br />     <span class="keyword">def</span> is_valid?<br />       <span class="keyword">not</span> <span class="variable">@empty_column</span><br />     <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br /></div></div>
			<p>That's the method we saw TicketGenerator using to determine when a book build needed to be restarted.</p>
			<p>Tickets can also print themselves:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="keyword">class</span> Ticket<br />     <span class="keyword">def</span> print_ticket<br />       puts <span class="string">"+----"</span> * 9 + <span class="string">"+"</span><br />       <span class="variable">@rows</span>.each <span class="keyword">do</span> |row|<br />         line = row.inject(<span class="string">"|"</span>) <span class="keyword">do</span> |str, x|<br />           <span class="keyword">if</span> <span class="keyword">not</span> x<br />             str + <span class="string">"    |"</span><br />           <span class="keyword">elsif</span> x &lt; 10<br />             str + <span class="string">"  #{x} |"</span><br />           <span class="keyword">else</span><br />             str + <span class="string">" #{x} |"</span><br />           <span class="keyword">end</span><br />         <span class="keyword">end</span><br />         puts line<br />         puts <span class="string">"+----"</span> * 9 + <span class="string">"+"</span><br />       <span class="keyword">end</span><br />     <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br /></div></div>
			<p>That code just walks the rows, printing fields as it goes.  The if chain in the middle could be simplified a bit to:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    str + <span class="string">" %2s |"</span> % x<br /><br /></div></div>
			<p>Finally, the code again sets the visibility for these methods:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="keyword">class</span> Ticket<br />     private :validate_ticket, :rectify<br />     public :print_ticket, :is_valid?<br />    <span class="keyword">end</span><br /><br /></div></div>
			<p>My thanks to all the book builders.  I didn't expect to see so many varied approaches.</p>
			<p>Tomorrow, I will put you to work solving a long-standing Ruby Quiz issue...</p>
		</div>
		<div id="logo"><img src="/web/20120121202409im_/http://rubyquiz.com/images/ruby_quiz_logo.jpg" alt="" width="157" height="150" /></div>
		<div id="links">
			<span class="title">Quiz Solutions</span>
			<ol>
				<li><a href="/web/20120121202409/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/239809">Eric I.</a></li>
				<li><a href="/web/20120121202409/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/239817">Christoffer Lern&ouml;</a></li>
				<li><a href="/web/20120121202409/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/239831">Andy Restrepo</a></li>
				<li><a href="/web/20120121202409/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/239836">Dennis</a></li>
				<li><a href="/web/20120121202409/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/239860">Christoffer Lern&ouml; (2)</a></li>
				<li><a href="/web/20120121202409/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/239865">Doug Meyer</a></li>
				<li><a href="/web/20120121202409/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/239877">Andy Restrepo (2)</a></li>
				<li><a href="/web/20120121202409/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/239886">Christoffer Lern&ouml; (3)</a></li>
				<li><a href="/web/20120121202409/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/239905">Daniel N</a></li>
				<li><a href="/web/20120121202409/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/239970">Christian Neukirchen</a></li>
				<li><a href="/web/20120121202409/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/240053">Ruben Medellin</a></li>
				<li><a href="/web/20120121202409/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/240265">Brian Candler</a></li>
			</ol>
			<p><a href="/web/20120121202409/http://rubyquiz.com/quiz114_sols.zip">Download Solutions</a></p>
			<p><a href="/web/20120121202409/http://rubyquiz.com/index.html">Back to Quiz Listing</a></p>
		</div>
		<div id="footer">&nbsp;</div>
	</div>
</body>
</html>





<!--
     FILE ARCHIVED ON 20:24:09 Jan 21, 2012 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 13:10:39 Jun 5, 2013.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
