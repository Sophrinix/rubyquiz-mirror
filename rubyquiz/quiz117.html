<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>


<!-- Start Wayback Rewrite JS Include -->
<script type="text/javascript" src="/static/js/jwplayer/jwplayer.js" ></script>
<script type="text/javascript" src="/static/js/video-embed-rewriter.js"></script>
<script type="text/javascript">
function initYTVideo(id)
{
	_wmVideos_.init("/web/", id);
}
</script>
<!-- End Wayback Rewrite JS Include -->

  <meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<title>Ruby Quiz - SimFrost (#117)</title>
	<link rel="stylesheet" type="text/css" href="/web/20120121201828cs_/http://rubyquiz.com/quiz.css" />
	<link rel="stylesheet" type="text/css" href="/web/20120121201828cs_/http://rubyquiz.com/print.css" media="print" />
</head><body>
<!-- BEGIN WAYBACK TOOLBAR INSERT -->

<script type="text/javascript" src="/static/js/disclaim-element.js" ></script>
<script type="text/javascript" src="/static/js/graph-calc.js" ></script>
<script type="text/javascript" src="/static/jflot/jquery.min.js" ></script>
<script type="text/javascript">
//<![CDATA[
var firstDate = 820454400000;
var lastDate = 1388534399999;
var wbPrefix = "/web/";
var wbCurrentUrl = "http:\/\/rubyquiz.com\/quiz117.html";

var curYear = -1;
var curMonth = -1;
var yearCount = 18;
var firstYear = 1996;
var imgWidth = 450;
var yearImgWidth = 25;
var monthImgWidth = 2;
var trackerVal = "none";
var displayDay = "21";
var displayMonth = "Jan";
var displayYear = "2012";
var prettyMonths = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

function showTrackers(val) {
	if(val == trackerVal) {
		return;
	}
	if(val == "inline") {
		document.getElementById("displayYearEl").style.color = "#ec008c";
		document.getElementById("displayMonthEl").style.color = "#ec008c";
		document.getElementById("displayDayEl").style.color = "#ec008c";		
	} else {
		document.getElementById("displayYearEl").innerHTML = displayYear;
		document.getElementById("displayYearEl").style.color = "#ff0";
		document.getElementById("displayMonthEl").innerHTML = displayMonth;
		document.getElementById("displayMonthEl").style.color = "#ff0";
		document.getElementById("displayDayEl").innerHTML = displayDay;
		document.getElementById("displayDayEl").style.color = "#ff0";
	}
   document.getElementById("wbMouseTrackYearImg").style.display = val;
   document.getElementById("wbMouseTrackMonthImg").style.display = val;
   trackerVal = val;
}
function getElementX2(obj) {
	var thing = jQuery(obj);
	if((thing == undefined) 
			|| (typeof thing == "undefined") 
			|| (typeof thing.offset == "undefined")) {
		return getElementX(obj);
	}
	return Math.round(thing.offset().left);
}
function trackMouseMove(event,element) {

   var eventX = getEventX(event);
   var elementX = getElementX2(element);
   var xOff = eventX - elementX;
	if(xOff < 0) {
		xOff = 0;
	} else if(xOff > imgWidth) {
		xOff = imgWidth;
	}
   var monthOff = xOff % yearImgWidth;

   var year = Math.floor(xOff / yearImgWidth);
	var yearStart = year * yearImgWidth;
   var monthOfYear = Math.floor(monthOff / monthImgWidth);
   if(monthOfYear > 11) {
       monthOfYear = 11;
   }
   // 1 extra border pixel at the left edge of the year:
   var month = (year * 12) + monthOfYear;
   var day = 1;
	if(monthOff % 2 == 1) {
		day = 15;
	}
	var dateString = 
		zeroPad(year + firstYear) + 
		zeroPad(monthOfYear+1,2) +
		zeroPad(day,2) + "000000";

	var monthString = prettyMonths[monthOfYear];
	document.getElementById("displayYearEl").innerHTML = year + 1996;
	document.getElementById("displayMonthEl").innerHTML = monthString;
	// looks too jarring when it changes..
	//document.getElementById("displayDayEl").innerHTML = zeroPad(day,2);

	var url = wbPrefix + dateString + '/' +  wbCurrentUrl;
	document.getElementById('wm-graph-anchor').href = url;

   //document.getElementById("wmtbURL").value="evX("+eventX+") elX("+elementX+") xO("+xOff+") y("+year+") m("+month+") monthOff("+monthOff+") DS("+dateString+") Moy("+monthOfYear+") ms("+monthString+")";
   if(curYear != year) {
       var yrOff = year * yearImgWidth;
       document.getElementById("wbMouseTrackYearImg").style.left = yrOff + "px";
       curYear = year;
   }
   if(curMonth != month) {
       var mtOff = year + (month * monthImgWidth) + 1;
       document.getElementById("wbMouseTrackMonthImg").style.left = mtOff + "px";
       curMonth = month;
   }
}
//]]>
</script>

<style type="text/css">body{margin-top:0!important;padding-top:0!important;min-width:800px!important;}#wm-ipp a:hover{text-decoration:underline!important;}</style>
<div id="wm-ipp" style="display:none; position:relative;padding:0 5px;min-height:70px;min-width:800px; z-index:9000;">
<div id="wm-ipp-inside" style="position:fixed;padding:0!important;margin:0!important;width:97%;min-width:780px;border:5px solid #000;border-top:none;background-image:url(/static/images/toolbar/wm_tb_bk_trns.png);text-align:center;-moz-box-shadow:1px 1px 3px #333;-webkit-box-shadow:1px 1px 3px #333;box-shadow:1px 1px 3px #333;font-size:11px!important;font-family:'Lucida Grande','Arial',sans-serif!important;">
   <table style="border-collapse:collapse;margin:0;padding:0;width:100%;"><tbody><tr>
   <td style="padding:10px;vertical-align:top;min-width:110px;">
   <a href="/web/" title="Wayback Machine home page" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wayback-toolbar-logo.png" alt="Wayback Machine" width="110" height="39" border="0"/></a>
   </td>
   <td style="padding:0!important;text-align:center;vertical-align:top;width:100%;">

       <table style="border-collapse:collapse;margin:0 auto;padding:0;width:570px;"><tbody><tr>
       <td style="padding:3px 0;" colspan="2">
       <form target="_top" method="get" action="/web/form-submit.jsp" name="wmtb" id="wmtb" style="margin:0!important;padding:0!important;"><input type="text" name="url" id="wmtbURL" value="http://rubyquiz.com/quiz117.html" style="width:400px;font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;" onfocus="javascript:this.focus();this.select();" /><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20120121201828" /><input type="submit" value="Go" style="font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;margin-left:5px;" /><span id="wm_tb_options" style="display:block;"></span></form>
       </td>
       <td style="vertical-align:bottom;padding:5px 0 0 0!important;" rowspan="2">
           <table style="border-collapse:collapse;width:110px;color:#99a;font-family:'Helvetica','Lucida Grande','Arial',sans-serif;"><tbody>
			
           <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
           <tr style="width:110px;height:16px;font-size:10px!important;">
           	<td style="padding-right:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20110901190206/http://www.rubyquiz.com/quiz117.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="1 Sep 2011"><strong>SEP</strong></a>
		                
               </td>
               <td id="displayMonthEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight:bold;text-transform:uppercase;width:34px;height:15px;padding-top:1px;text-align:center;" title="You are here: 20:18:28 Jan 21, 2012">JAN</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20120418144223/http://www.rubyquiz.com/quiz117.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="18 Apr 2012"><strong>APR</strong></a>
		                
               </td>
           </tr>

           <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
           <tr>
               <td style="padding-right:9px;white-space:nowrap;overflow:visible;text-align:right!important;vertical-align:middle!important;" nowrap="nowrap">
               
		                <a href="/web/20110901190206/http://www.rubyquiz.com/quiz117.html" title="19:02:06 Sep 1, 2011" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0" /></a>
		                
               </td>
               <td id="displayDayEl" style="background:#000;color:#ff0;width:34px;height:24px;padding:2px 0 0 0;text-align:center;font-size:24px;font-weight: bold;" title="You are here: 20:18:28 Jan 21, 2012">21</td>
				<td style="padding-left:9px;white-space:nowrap;overflow:visible;text-align:left!important;vertical-align:middle!important;" nowrap="nowrap">
               
		                <a href="/web/20120418144223/http://www.rubyquiz.com/quiz117.html" title="14:42:23 Apr 18, 2012" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wm_tb_nxt_on.png" alt="Next capture" width="14" height="16" border="0"/></a>
		                
			    </td>
           </tr>

           <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
           <tr style="width:110px;height:13px;font-size:9px!important;">
				<td style="padding-right:9px;font-size:11px!important;font-weight: bold;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20101127171734/http://rubyquiz.com/quiz117.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="27 Nov 2010"><strong>2010</strong></a>
		                
               </td>
               <td id="displayYearEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight: bold;padding-top:1px;width:34px;height:13px;text-align:center;" title="You are here: 20:18:28 Jan 21, 2012">2012</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight: bold;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20130215052415/http://rubyquiz.com/quiz117.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="15 Feb 2013"><strong>2013</strong></a>
		                
				</td>
           </tr>
           </tbody></table>
       </td>

       </tr>
       <tr>
       <td style="vertical-align:middle;padding:0!important;">
           <a href="/web/20120121201828*/http://rubyquiz.com/quiz117.html" style="color:#33f;font-size:11px;font-weight:bold;background-color:transparent;border:none;" title="See a list of every capture for this URL"><strong>25 captures</strong></a>
           <div style="margin:0!important;padding:0!important;color:#666;font-size:9px;padding-top:2px!important;white-space:nowrap;" title="Timespan for captures of this URL">21 Apr 07 - 10 Mar 13</div>
       </td>
       <td style="padding:0!important;">
       <a style="position:relative; white-space:nowrap; width:450px;height:27px;" href="" id="wm-graph-anchor">
       <div id="wm-ipp-sparkline" style="position:relative; white-space:nowrap; width:450px;height:27px;background-color:#fff;cursor:pointer;border-right:1px solid #ccc;" title="Explore captures for this URL">
			<img id="sparklineImgId" style="position:absolute; z-index:9012; top:0px; left:0px;"
				onmouseover="showTrackers('inline');" 
				onmouseout="showTrackers('none');"
				onmousemove="trackMouseMove(event,this)"
				alt="sparklines"
				width="450"
				height="27"
				border="0"
				src="/web/jsp/graph.jsp?graphdata=450_27_1996:-1:000000000000_1997:-1:000000000000_1998:-1:000000000000_1999:-1:000000000000_2000:-1:000000000000_2001:-1:000000000000_2002:-1:000000000000_2003:-1:000000000000_2004:-1:000000000000_2005:-1:000000000000_2006:-1:000000000000_2007:-1:000101000000_2008:-1:000000000000_2009:-1:000000000000_2010:-1:000000000010_2011:-1:000000001000_2012:0:10016000a100_2013:-1:011000000000"></img>
			<img id="wbMouseTrackYearImg" 
				style="display:none; position:absolute; z-index:9010;"
				width="25" 
				height="27"
				border="0"
				src="/static/images/toolbar/transp-yellow-pixel.png"></img>
			<img id="wbMouseTrackMonthImg"
				style="display:none; position:absolute; z-index:9011; " 
				width="2"
				height="27" 
				border="0"
				src="/static/images/toolbar/transp-red-pixel.png"></img>
       </div>
		</a>

       </td>
       </tr></tbody></table>
   </td>
   <td style="text-align:right;padding:5px;width:65px;font-size:11px!important;">
       <a href="javascript:;" onclick="document.getElementById('wm-ipp').style.display='none';" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_close.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;margin-bottom:23px;background-color:transparent;border:none;" title="Close the toolbar">Close</a>
       <a href="http://faq.web.archive.org/" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_help.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;background-color:transparent;border:none;" title="Get some help using the Wayback Machine">Help</a>
   </td>
   </tr></tbody></table>

</div>
</div>
<script type="text/javascript">
 var wmDisclaimBanner = document.getElementById("wm-ipp");
 if(wmDisclaimBanner != null) {
   disclaimElement(wmDisclaimBanner);
 }
</script>
<!-- END WAYBACK TOOLBAR INSERT -->

	<div id="page">
		<div id="header"><span class="ruby">Ruby</span> <span class="quiz">Quiz</span></div>
		<div id="content">
			<span class="title">SimFrost (#117)</span>
			<p>This was one of the Perl Quiz of the Week problems a couple of years ago.  It's also my favorite computer simulation.</p>
			<p>The goal is to create a simulation of frost.  The end result should look something like this (13MB Quicktime Movie):</p>
			<p><a href="/web/20120121201828/http://www.rubyquiz.com/SimFrost.mov">Simulation Example</a></p>
			<p>Of course, you don't have to create a movie.  Using the terminal is just fine.</p>
			<p>Here are the rules of the simulation.</p>
			<p>First, create a two-dimensional grid to hold our simulation.  The width and height must be even numbers.  The top of this grid wraps (or connects) to the bottom and the left and right sides also touch, so technically we are representing a torus here.</p>
			<p>Each cell in the grid can hold one of three things:  vacuum, vapor, or ice.  To begin with, place a single ice particle in the center of the grid and fill the remaining space with some random mix of vacuum and vapor.  You will probably want to leave yourself a way to easily adjust the starting vapor percentage as you begin to play with the simulation.</p>
			<p>Display the starting grid for the user, then begin a cycle of "ticks" that change the current state of the grid.  Redraw the grid after each tick, so the user can see the changes.  The simulation continues until there are no more vapor particles.  At that time your program should exit.</p>
			<p>Each tick changes the grid as follows.  First, divide the board into "neighborhoods."  A neighborhood is always a square of four cells.  Given that, on the first tick we would divide a six by four grid as:</p>
			<p class="example">+--+--+--+<br />|  |  |  |<br />|  |  |  |<br />+--+--+--+<br />|  |  |  |<br />|  |  |  |<br />+--+--+--+</p>
			<p>However, even numbered ticks divide the board with an offset of one.  In other words, the neighborhoods will be as follows in the second round:</p>
			<p class="example"> |  |  |<br />-+--+--+-<br /> |  |  | <br /> |  |  |<br />-+--+--+-<br /> |  |  |</p>
			<p>Remember that the grid wraps in all directions, so there are still just six neighborhoods here.  Later ticks just alternate these two styles of dividing the grid.</p>
			<p>In each neighborhood, apply one of the following two changes:</p>
			<p class="example">1.  If any cell in the neighborhood contains ice, all vapor particles in the<br />    neighborhood turn to ice.<br />2.  Otherwise, rotate the contents of the neighborhood 90 degrees clockwise<br />    or counter-clockwise (50% random chance for either).</p>
			<p>For example (using " " for vacuum, "." for vapor, and "*" for ice), the first rule changes:</p>
			<p class="example">+--+<br />| .|<br />|* |<br />+--+</p>
			<p>into:</p>
			<p class="example">+--+<br />| *|<br />|* |<br />+--+</p>
			<p>The second rule changes:</p>
			<p class="example">+--+<br />|..|<br />|  |<br />+--+</p>
			<p>into:</p>
			<p class="example">+--+      +--+<br />|. |  or  | .|  50% chance<br />|. |      | .|<br />+--+      +--+</p>
			<p>Time is discrete in these ticks, so given some grid state at tick T all neighborhood changes appear simultaneously in tick T + 1.</p>
			<p>Again, use whatever output you are comfortable with, from ASCII art in the terminal to pretty graphics.</p>
			<hr />
			<p><span class="title">Quiz Summary</span></p>
			<p>Isn't this one a fun problem?  Three cheers to Mark Jason Dominus for introducing it to me.</p>
			<p>The solutions were fantastic as well.  In particular, people found many interesting ways to render the output:  using some Unixisms in the terminal, using curses, rendering trivial image formats like PPM and XPM, building images programmatically with RMagick, and even 3D rendering with OpenGL.  All of those were very cool.</p>
			<p>I'm going to show my own code below, but I will take a few diversions as we go.  Here's the start of my simulator class:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="comment">#!/usr/bin/env ruby -w</span><br /><br />    <span class="keyword">class</span> SimFrost<br />      <span class="keyword">def</span> initialize(width, height, vapor)<br />        <span class="variable">@ticks</span> = 0<br />        <span class="variable">@grid</span>  = Array.new(height) <span class="keyword">do</span><br />          Array.new(width) { rand(100) &lt; vapor ? <span class="string">"."</span> : <span class="string">" "</span> }<br />        <span class="keyword">end</span><br />        <span class="variable">@grid</span>[height <span class="string">/ 2][width /</span> 2] = <span class="string">"*"</span><br />      <span class="keyword">end</span><br /><br />      attr_reader :ticks<br /><br />      <span class="keyword">def</span> width<br />        <span class="variable">@grid</span>.first.size<br />      <span class="keyword">end</span><br /><br />      <span class="keyword">def</span> height<br />        <span class="variable">@grid</span>.size<br />      <span class="keyword">end</span><br /><br />      <span class="comment"># ...</span><br /><br /></div></div>
			<p>This setup code creates the grid object, filled with the particles described in the quiz using the quiz example notation.  Several other solvers used Symbols or constants for these element which reads a lot better.</p>
			<p>My grid is just Arrays of columns inside an Array of rows.  This is called "row major" order.  It's a little backwards to the way we normally think, because you index with a Y coordinate and then the X, but that's easy enough to fix with a helper method.  It's also great for showing results, because you can process them row by row.</p>
			<p>The other three methods are just accessors for attributes of the simulation.</p>
			<p>One interesting point of discussion raised on the mailing list by Christoffer Lern&ouml; was that populating the grid as I do above, by testing a percentage for every cell, doesn't necessarily fill the grid with that exact percent of elements.  The smaller the grid, the more likely you are to be off.  For example:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    &gt;&gt; percent = 30<br />    =&gt; 30<br />    &gt;&gt; grid = Array.new(100) { rand(100) &lt; 30 ? <span class="string">"."</span> : <span class="string">" "</span> }<br />    =&gt; [<span class="string">" "</span>, <span class="string">"."</span>, <span class="string">"."</span>, <span class="string">" "</span>, <span class="string">" "</span>, <span class="string">" "</span>, ..., <span class="string">" "</span>]<br />    &gt;&gt; grid.grep(<span class="string">/\./</span>).size<br />    =&gt; 37<br /><br /></div></div>
			<p>Notice how the actual percentage is off from my requested percentage by seven percent.  This is less of an issue the bigger the grid gets and small grids don't tend to be too interesting anyway, but there will usually be some level of error with this approach.</p>
			<p>To solve this, you really need to calculate the percentage against the full grid size and ensure that you fill exactly that many cells.  Christoffer's code for that was:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    require <span class="string">'enumerator'</span><br /><br />    percentage = 30<br />    width      = 30<br />    height     = 20<br />    vapour     = width * height * percentage / 100<br />    vacuum     = width * height - vapour<br />    grid       = []<br /><br />    (Array.new(vacuum, <span class="string">' '</span>) + Array.new(vapour, <span class="string">'.'</span>)).<br />        sort_by { rand }.<br />        each_slice(width) { |s| grid &lt;&lt; s }<br /><br /></div></div>
			<p>Laziness won out though and most of us used the trivial cell by cell fill strategy.</p>
			<p>Getting back to my code, here are two more methods on the simulator:</p>
			<div class="code"><span class="type">ruby</span><div class="body">      <span class="comment"># ...</span><br /><br />      <span class="keyword">def</span> complete?<br />        <span class="keyword">not</span> <span class="variable">@grid</span>.flatten.include? <span class="string">"."</span><br />      <span class="keyword">end</span><br /><br />      <span class="keyword">def</span> to_s<br />        <span class="variable">@grid</span>.map { |row| row.join }.join(<span class="string">"\n"</span>)<br />      <span class="keyword">end</span><br /><br />      <span class="comment"># ...</span><br /><br /></div></div>
			<p>These are pretty easy.  First, complete?() just tells us if we are done by checking for any remaining vapor particles.  The other method, to_s(), is just a nested join() on the grid object used to output results.</p>
			<p>Now we're ready for the heart of the simulation:</p>
			<div class="code"><span class="type">ruby</span><div class="body">      <span class="comment"># ...</span><br /><br />      <span class="keyword">def</span> tick<br />        (tick_start...height).step(2) <span class="keyword">do</span> |y|<br />          (tick_start...width).step(2) <span class="keyword">do</span> |x|<br />            cells = [ [x,             y            ],<br />                      [wrap_x(x + 1), y            ],<br />                      [wrap_x(x + 1), wrap_y(y + 1)],<br />                      [x,             wrap_y(y + 1)] ]<br />            <span class="keyword">if</span> cells.any? { |xy| cell(xy) == <span class="string">"*"</span> }<br />              cells.select { |xy| cell(xy) == <span class="string">"."</span> }.<br />                    each { |xy| cell(xy, <span class="string">"*"</span>) }<br />            <span class="keyword">else</span><br />              rotated = cells.dup<br />              <span class="keyword">if</span> rand(2).zero?<br />                rotated.push(rotated.shift)<br />              <span class="keyword">else</span><br />                rotated.unshift(rotated.pop)<br />              <span class="keyword">end</span><br />              new_cells = rotated.map { |xy| cell(xy) }<br />              cells.zip(new_cells) { |xy, value| cell(xy, value) }<br />            <span class="keyword">end</span><br />          <span class="keyword">end</span><br />        <span class="keyword">end</span><br />        <span class="variable">@ticks</span> += 1<br />      <span class="keyword">end</span><br /><br />      private<br /><br />      <span class="keyword">def</span> tick_start; (<span class="variable">@ticks</span> % 2).zero? ? 0 : 1 <span class="keyword">end</span><br /><br />      <span class="keyword">def</span> wrap_x(x) x % width  <span class="keyword">end</span><br />      <span class="keyword">def</span> wrap_y(y) y % height <span class="keyword">end</span><br /><br />      <span class="keyword">def</span> cell(xy, value = <span class="keyword">nil</span>)<br />        <span class="keyword">if</span> value<br />          <span class="variable">@grid</span>[xy.last][xy.first] = value<br />        <span class="keyword">else</span><br />          <span class="variable">@grid</span>[xy.last][xy.first]<br />        <span class="keyword">end</span><br />      <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br />    <span class="comment"># ...</span><br /><br /></div></div>
			<p>The tick() method is where the action is.  It walks the grid neighborhood by neighborhood making changes.  Note that cells are managed as just two element Arrays and I use the human-friendly X-before-Y notation.  I also build the neighborhood by putting the cells in clockwise order.  This means a rotation is just a shift() and push(), or pop() and unshift() to go the other way.</p>
			<p>Cell access is all handled through the cell() helper method, which switches the order for row major access.  Christoffer Lern&ouml; had an interesting approach to this cell access problem where he defined a handful of methods with some metaprogramming:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="keyword">class</span> Neighbourhood<br /><br />      2.times <span class="keyword">do</span> |y|<br />        2.times <span class="keyword">do</span> |x|<br />          class_eval <span class="string">%Q{<br />            def xy#{x}#{y}; @grid[@x + #{x}, @y + #{y}]; end<br />            def xy#{x}#{y}=(v); @grid[@x + #{x}, @y + #{y}] = v; end<br />          }</span><br />        <span class="keyword">end</span><br />      <span class="keyword">end</span><br /><br />      <span class="comment"># ...</span><br /><br /></div></div>
			<p>This allowed him to define rotations as:</p>
			<div class="code"><span class="type">ruby</span><div class="body">      <span class="comment"># ...</span><br /><br />      <span class="keyword">def</span> ccw90<br />        <span class="keyword">self</span>.xy00, <span class="keyword">self</span>.xy10, <span class="keyword">self</span>.xy01, <span class="keyword">self</span>.xy11 = xy10, xy11, xy00, xy01<br />      <span class="keyword">end</span><br /><br />      <span class="keyword">def</span> cw90<br />        <span class="keyword">self</span>.xy00, <span class="keyword">self</span>.xy10, <span class="keyword">self</span>.xy01, <span class="keyword">self</span>.xy11 = xy01, xy00, xy11, xy10<br />      <span class="keyword">end</span><br /><br />      <span class="comment"># ...</span><br /><br /></div></div>
			<p>Getting back to my code, I also have wrappers for X and Y coordinates so I can properly handle the grid edges with modulo arithmetic.  This code only ever runs off the right and bottom edges of the grid and only by one cell, so we don't need to worry about negative numbers.</p>
			<p>Finally, tick_start() toggles the neighborhood offset for me, though Dave Burt did it with some cool bitwise XOR operations that looked like this:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    &gt;&gt; offset = 0<br />    =&gt; 0<br />    &gt;&gt; offset ^= 1<br />    =&gt; 1<br />    &gt;&gt; offset ^= 1<br />    =&gt; 0<br />    &gt;&gt; offset ^= 1<br />    =&gt; 1<br /><br /></div></div>
			<p>Now that we have a simulator, we're ready for some display code.  The first display model I built was based on the Unix terminal because it was so easy to do:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="comment"># ...</span><br /><br />    <span class="keyword">class</span> UnixTerminalDisplay<br />      BLUE     = <span class="string">"\e[34m"</span><br />      WHITE    = <span class="string">"\e[37m"</span><br />      ON_BLACK = <span class="string">"\e[40m"</span><br />      CLEAR    = <span class="string">"\e[0m"</span><br /><br />      <span class="keyword">def</span> initialize(simulator)<br />        <span class="variable">@simulator</span> = simulator<br />      <span class="keyword">end</span><br /><br />      <span class="keyword">def</span> clear<br />        <span class="variable">@clear</span> ||= <span class="string">`clear`</span><br />      <span class="keyword">end</span><br /><br />      <span class="keyword">def</span> display<br />        print clear<br />        puts <span class="variable">@simulator</span>.to_s.gsub(<span class="string">/\.+/</span>, <span class="string">"#{BLUE  + ON_BLACK}\\&amp;#{CLEAR}"</span>).<br />                             gsub(<span class="string">/\*+/</span>, <span class="string">"#{WHITE + ON_BLACK}\\&amp;#{CLEAR}"</span>).<br />                             gsub(<span class="string">/ +/</span>,  <span class="string">"#{        ON_BLACK}\\&amp;#{CLEAR}"</span>)<br />      <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br />    <span class="comment"># ...</span><br /><br /></div></div>
			<p>Here we just wrap a simulator with some search and replace logic.  The regexen are used to wrap the icons in terminal escape codes to color them.  The code also shells out to clear, or uses the cached result, to erase the terminal before each round of drawing.</p>
			<p>While that's easy to code, it's not portable or flashy.  Simulations look so much better in graphical representations and as I mentioned before, solvers produced those in a variety of ways.</p>
			<p>My own solution to the graphics problem is another trick I learned from Mark Jason Dominus.  Believe it or not, there are a few super trivial image formats that you can hand roll in no time.  It pays to learn one of them, for situations like this, when you just need some quick and dirty image output.  You can always use a converter to get them into more popular image formats.  That's exactly how I built the quiz movie.</p>
			<p>There are a few versions of the PPM image format, but the one I used goes by the following rules:</p>
			<p class="example">1.  Start the image file with P6 on its own line.<br />2.  The second line is the width in pixels, followed by the height in<br />    pixels, followed by the color range (just use 255 for this) as a<br />    space delimited list of integers.  For example, a 640 by 480 image<br />    has a second line of: 640 480 255.<br />3.  From that point on, the rest of data is binary.  Each pixel is<br />    represented by three characters which represent the amount of red,<br />    green, and blue coloring in that pixel.  The numeric byte value of<br />    the character is the amount for the color it represents.</p>
			<p>Watch how easy that is to code up:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="comment"># ...</span><br /><br />    <span class="keyword">class</span> PPMImageDisplay<br />      BLUE  = [0,   0,   255].pack(<span class="string">"C*"</span>)<br />      WHITE = [255, 255, 255].pack(<span class="string">"C*"</span>)<br />      BLACK = [0,   0,   0  ].pack(<span class="string">"C*"</span>)<br /><br />      <span class="keyword">def</span> initialize(simulator, directory)<br />        <span class="variable">@simulator</span> = simulator<br />        <span class="variable">@directory</span> = directory<br /><br />        Dir.mkdir directory <span class="keyword">unless</span> File.exist? directory<br />      <span class="keyword">end</span><br /><br />      <span class="keyword">def</span> display<br />        File.open(file_name, <span class="string">"w"</span>) <span class="keyword">do</span> |image|<br />          image.puts <span class="string">"P6"</span><br />          image.puts <span class="string">"#{@simulator.width} #{@simulator.height} 255"</span><br />          <span class="variable">@simulator</span>.to_s.each_byte <span class="keyword">do</span> |cell|<br />            <span class="keyword">case</span> cell.chr<br />            <span class="keyword">when</span> <span class="string">"."</span> <span class="keyword">then</span> image.print BLUE<br />            <span class="keyword">when</span> <span class="string">"*"</span> <span class="keyword">then</span> image.print WHITE<br />            <span class="keyword">when</span> <span class="string">" "</span> <span class="keyword">then</span> image.print BLACK<br />            <span class="keyword">else</span>          <span class="keyword">next</span><br />            <span class="keyword">end</span><br />          <span class="keyword">end</span><br />        <span class="keyword">end</span><br />      <span class="keyword">end</span><br /><br />      private<br /><br />      <span class="keyword">def</span> file_name<br />        File.join(<span class="variable">@directory</span>, <span class="string">"%04d.ppm"</span> % <span class="variable">@simulator</span>.ticks)<br />      <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br />    <span class="comment"># ...</span><br /><br /></div></div>
			<p>The image implementation I just described in encapsulated in the display() method.  The binary values are handled by constants at the top of the class.  Note how easy it is to build PPM's RGB colors using pack().  The rest of the class just creates a directory to hold the frame images and builds file names based on the current tick count.</p>
			<p>Finally, we come to the application code of my solution:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="keyword">if</span> <span class="keyword">__FILE__</span> == <span class="global">$PROGRAM_NAME</span><br />      require <span class="string">"optparse"</span><br /><br />      options = { :width     =&gt; 80,<br />                  :height    =&gt; 22,<br />                  :vapor     =&gt; 30,<br />                  :output    =&gt; UnixTerminalDisplay,<br />                  :directory =&gt; <span class="string">"frost_images"</span> }<br /><br />      ARGV.options <span class="keyword">do</span> |opts|<br />        opts.banner = <span class="string">"Usage:  #{File.basename($PROGRAM_NAME)} [OPTIONS]"</span><br /><br />        opts.separator <span class="string">""</span><br />        opts.separator <span class="string">"Specific Options:"</span><br /><br />        opts.on( <span class="string">"-w"</span>, <span class="string">"--width EVEN_INT"</span>, Integer,<br />                 <span class="string">"Sets the width for the simulation."</span> ) <span class="keyword">do</span> |width|<br />          options[:width] = width<br />        <span class="keyword">end</span><br />        opts.on( <span class="string">"-h"</span>, <span class="string">"--height EVEN_INT"</span>, Integer,<br />                 <span class="string">"Sets the height for the simulation."</span> ) <span class="keyword">do</span> |height|<br />          options[:height] = height<br />        <span class="keyword">end</span><br />        opts.on( <span class="string">"-v"</span>, <span class="string">"--vapor PERCENT_INT"</span>, Integer,<br />                 <span class="string">"The percent of the grid filled with vapor."</span> ) <span class="keyword">do</span> |vapor|<br />          options[:vapor] = vapor<br />        <span class="keyword">end</span><br />        opts.on( <span class="string">"-t"</span>, <span class="string">"--terminal"</span>,<br />                 <span class="string">"Unix terminal display (default)."</span> ) <span class="keyword">do</span><br />          options[:output] = UnixTerminalDisplay<br />        <span class="keyword">end</span><br />        opts.on( <span class="string">"-i"</span>, <span class="string">"--image"</span>,<br />                 <span class="string">"PPM image series display."</span> ) <span class="keyword">do</span><br />          options[:output] = PPMImageDisplay<br />        <span class="keyword">end</span><br />        opts.on( <span class="string">"-d"</span>, <span class="string">"--directory DIR"</span>, String,<br />                 <span class="string">"Where to place PPM image files.  "</span>,<br />                 <span class="string">%Q{Defaults to "frost_images".}</span> ) <span class="keyword">do</span> |directory|<br />          options[:directory] = directory<br />        <span class="keyword">end</span><br /><br />        opts.separator <span class="string">"Common Options:"</span><br /><br />        opts.on( <span class="string">"-?"</span>, <span class="string">"--help"</span>,<br />                 <span class="string">"Show this message."</span> ) <span class="keyword">do</span><br />          puts opts<br />          exit<br />        <span class="keyword">end</span><br /><br />        <span class="keyword">begin</span><br />          opts.parse!<br />        <span class="keyword">rescue</span><br />          puts opts<br />          exit<br />        <span class="keyword">end</span><br />      <span class="keyword">end</span><br /><br />      simulator = SimFrost.new( options[:width],<br />                                options[:height],<br />                                options[:vapor] )<br />      setup     = options[:output] == PPMImageDisplay ?<br />                  [simulator, options[:directory]]    :<br />                  [simulator]<br />      terminal  = options[:output].new(*setup)<br /><br />      terminal.display<br />      <span class="keyword">until</span> simulator.complete?<br />        sleep 0.5 <span class="keyword">if</span> options[:output] == UnixTerminalDisplay<br />        simulator.tick<br />        terminal.display<br />      <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br /></div></div>
			<p>While that looks like a lot of code, most of it is just option parsing where I fill an options Hash.  The last twelve lines are where the interesting stuff happens.  A simulator is constructed and then wrapped in a display class.  From there we go into the main event loop which is just sleep (terminal display only), tick(), and draw until the simulation is complete?().</p>
			<p>My thanks to all the super cool Ruby programmers who can literally create ice with the movements of their fingers.</p>
			<p>Ruby Quiz will now take a two week vacation so I can get out of town and have a little fun.  Send me some great quiz ideas while I'm gone and we will get them into play when I return.</p>
		</div>
		<div id="logo"><img src="/web/20120121201828im_/http://rubyquiz.com/images/ruby_quiz_logo.jpg" alt="" width="157" height="150" /></div>
		<div id="links">
			<span class="title">Quiz Solutions</span>
			<ol>
				<li><a href="/web/20120121201828/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/242978">Albert Ng</a></li>
				<li><a href="/web/20120121201828/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/242979">Christoffer Lern&ouml;</a></li>
				<li><a href="/web/20120121201828/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/242980">Albert Ng (2)</a></li>
				<li><a href="/web/20120121201828/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/242982">Robert Dober</a></li>
				<li><a href="/web/20120121201828/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/242988">Robert Dober (2)</a></li>
				<li><a href="/web/20120121201828/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/242995">Dave Burt</a></li>
				<li><a href="/web/20120121201828/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/242996">James Edward Gray II</a></li>
				<li><a href="/web/20120121201828/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/243001">Chris Shea</a></li>
				<li><a href="/web/20120121201828/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/243005">Harrison Reiser</a></li>
				<li><a href="/web/20120121201828/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/243006">Harrison Reiser (2)</a></li>
				<li><a href="/web/20120121201828/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/243013">Eric I.</a></li>
				<li><a href="/web/20120121201828/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/243016">Robert Dober (3)</a></li>
				<li><a href="/web/20120121201828/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/243017">Raj Sahae</a></li>
				<li><a href="/web/20120121201828/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/243027">Gordon Thiesfeld</a></li>
				<li><a href="/web/20120121201828/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/243062">Tom Rauchenwald</a></li>
				<li><a href="/web/20120121201828/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/243068">Albert Ng (3)</a></li>
				<li><a href="/web/20120121201828/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/243110">Ruben Medellin</a></li>
				<li><a href="/web/20120121201828/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/243443">doug meyer</a></li>
				<li><a href="/web/20120121201828/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/243467">Robert Retzbach</a></li>
				<li><a href="/web/20120121201828/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/243498">David Tran</a></li>
				<li><a href="/web/20120121201828/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/243564">Ruben Medellin (2)</a></li>
				<li><a href="/web/20120121201828/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/243820">Josef 'Jupp' Schugt</a></li>
			</ol>
			<p><a href="/web/20120121201828/http://rubyquiz.com/quiz117_sols.zip">Download Solutions</a></p>
			<p><a href="/web/20120121201828/http://rubyquiz.com/index.html">Back to Quiz Listing</a></p>
		</div>
		<div id="footer">&nbsp;</div>
	</div>
</body>
</html>





<!--
     FILE ARCHIVED ON 20:18:28 Jan 21, 2012 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 13:10:42 Jun 5, 2013.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
