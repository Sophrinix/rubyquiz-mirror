<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>


<!-- Start Wayback Rewrite JS Include -->
<script type="text/javascript" src="/static/js/jwplayer/jwplayer.js" ></script>
<script type="text/javascript" src="/static/js/video-embed-rewriter.js"></script>
<script type="text/javascript">
function initYTVideo(id)
{
	_wmVideos_.init("/web/", id);
}
</script>
<!-- End Wayback Rewrite JS Include -->

  <meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<title>Ruby Quiz - Magic Squares (#124)</title>
	<link rel="stylesheet" type="text/css" href="/web/20120119235251cs_/http://rubyquiz.com/quiz.css" />
	<link rel="stylesheet" type="text/css" href="/web/20120119235251cs_/http://rubyquiz.com/print.css" media="print" />
</head><body>
<!-- BEGIN WAYBACK TOOLBAR INSERT -->

<script type="text/javascript" src="/static/js/disclaim-element.js" ></script>
<script type="text/javascript" src="/static/js/graph-calc.js" ></script>
<script type="text/javascript" src="/static/jflot/jquery.min.js" ></script>
<script type="text/javascript">
//<![CDATA[
var firstDate = 820454400000;
var lastDate = 1388534399999;
var wbPrefix = "/web/";
var wbCurrentUrl = "http:\/\/rubyquiz.com\/quiz124.html";

var curYear = -1;
var curMonth = -1;
var yearCount = 18;
var firstYear = 1996;
var imgWidth = 450;
var yearImgWidth = 25;
var monthImgWidth = 2;
var trackerVal = "none";
var displayDay = "19";
var displayMonth = "Jan";
var displayYear = "2012";
var prettyMonths = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

function showTrackers(val) {
	if(val == trackerVal) {
		return;
	}
	if(val == "inline") {
		document.getElementById("displayYearEl").style.color = "#ec008c";
		document.getElementById("displayMonthEl").style.color = "#ec008c";
		document.getElementById("displayDayEl").style.color = "#ec008c";		
	} else {
		document.getElementById("displayYearEl").innerHTML = displayYear;
		document.getElementById("displayYearEl").style.color = "#ff0";
		document.getElementById("displayMonthEl").innerHTML = displayMonth;
		document.getElementById("displayMonthEl").style.color = "#ff0";
		document.getElementById("displayDayEl").innerHTML = displayDay;
		document.getElementById("displayDayEl").style.color = "#ff0";
	}
   document.getElementById("wbMouseTrackYearImg").style.display = val;
   document.getElementById("wbMouseTrackMonthImg").style.display = val;
   trackerVal = val;
}
function getElementX2(obj) {
	var thing = jQuery(obj);
	if((thing == undefined) 
			|| (typeof thing == "undefined") 
			|| (typeof thing.offset == "undefined")) {
		return getElementX(obj);
	}
	return Math.round(thing.offset().left);
}
function trackMouseMove(event,element) {

   var eventX = getEventX(event);
   var elementX = getElementX2(element);
   var xOff = eventX - elementX;
	if(xOff < 0) {
		xOff = 0;
	} else if(xOff > imgWidth) {
		xOff = imgWidth;
	}
   var monthOff = xOff % yearImgWidth;

   var year = Math.floor(xOff / yearImgWidth);
	var yearStart = year * yearImgWidth;
   var monthOfYear = Math.floor(monthOff / monthImgWidth);
   if(monthOfYear > 11) {
       monthOfYear = 11;
   }
   // 1 extra border pixel at the left edge of the year:
   var month = (year * 12) + monthOfYear;
   var day = 1;
	if(monthOff % 2 == 1) {
		day = 15;
	}
	var dateString = 
		zeroPad(year + firstYear) + 
		zeroPad(monthOfYear+1,2) +
		zeroPad(day,2) + "000000";

	var monthString = prettyMonths[monthOfYear];
	document.getElementById("displayYearEl").innerHTML = year + 1996;
	document.getElementById("displayMonthEl").innerHTML = monthString;
	// looks too jarring when it changes..
	//document.getElementById("displayDayEl").innerHTML = zeroPad(day,2);

	var url = wbPrefix + dateString + '/' +  wbCurrentUrl;
	document.getElementById('wm-graph-anchor').href = url;

   //document.getElementById("wmtbURL").value="evX("+eventX+") elX("+elementX+") xO("+xOff+") y("+year+") m("+month+") monthOff("+monthOff+") DS("+dateString+") Moy("+monthOfYear+") ms("+monthString+")";
   if(curYear != year) {
       var yrOff = year * yearImgWidth;
       document.getElementById("wbMouseTrackYearImg").style.left = yrOff + "px";
       curYear = year;
   }
   if(curMonth != month) {
       var mtOff = year + (month * monthImgWidth) + 1;
       document.getElementById("wbMouseTrackMonthImg").style.left = mtOff + "px";
       curMonth = month;
   }
}
//]]>
</script>

<style type="text/css">body{margin-top:0!important;padding-top:0!important;min-width:800px!important;}#wm-ipp a:hover{text-decoration:underline!important;}</style>
<div id="wm-ipp" style="display:none; position:relative;padding:0 5px;min-height:70px;min-width:800px; z-index:9000;">
<div id="wm-ipp-inside" style="position:fixed;padding:0!important;margin:0!important;width:97%;min-width:780px;border:5px solid #000;border-top:none;background-image:url(/static/images/toolbar/wm_tb_bk_trns.png);text-align:center;-moz-box-shadow:1px 1px 3px #333;-webkit-box-shadow:1px 1px 3px #333;box-shadow:1px 1px 3px #333;font-size:11px!important;font-family:'Lucida Grande','Arial',sans-serif!important;">
   <table style="border-collapse:collapse;margin:0;padding:0;width:100%;"><tbody><tr>
   <td style="padding:10px;vertical-align:top;min-width:110px;">
   <a href="/web/" title="Wayback Machine home page" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wayback-toolbar-logo.png" alt="Wayback Machine" width="110" height="39" border="0"/></a>
   </td>
   <td style="padding:0!important;text-align:center;vertical-align:top;width:100%;">

       <table style="border-collapse:collapse;margin:0 auto;padding:0;width:570px;"><tbody><tr>
       <td style="padding:3px 0;" colspan="2">
       <form target="_top" method="get" action="/web/form-submit.jsp" name="wmtb" id="wmtb" style="margin:0!important;padding:0!important;"><input type="text" name="url" id="wmtbURL" value="http://rubyquiz.com/quiz124.html" style="width:400px;font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;" onfocus="javascript:this.focus();this.select();" /><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20120119235251" /><input type="submit" value="Go" style="font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;margin-left:5px;" /><span id="wm_tb_options" style="display:block;"></span></form>
       </td>
       <td style="vertical-align:bottom;padding:5px 0 0 0!important;" rowspan="2">
           <table style="border-collapse:collapse;width:110px;color:#99a;font-family:'Helvetica','Lucida Grande','Arial',sans-serif;"><tbody>
			
           <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
           <tr style="width:110px;height:16px;font-size:10px!important;">
           	<td style="padding-right:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20110826110053/http://rubyquiz.com/quiz124.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="26 Aug 2011"><strong>AUG</strong></a>
		                
               </td>
               <td id="displayMonthEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight:bold;text-transform:uppercase;width:34px;height:15px;padding-top:1px;text-align:center;" title="You are here: 23:52:51 Jan 19, 2012">JAN</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20120418081201/http://www.rubyquiz.com/quiz124.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="18 Apr 2012"><strong>APR</strong></a>
		                
               </td>
           </tr>

           <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
           <tr>
               <td style="padding-right:9px;white-space:nowrap;overflow:visible;text-align:right!important;vertical-align:middle!important;" nowrap="nowrap">
               
		                <a href="/web/20110826110053/http://rubyquiz.com/quiz124.html" title="11:00:53 Aug 26, 2011" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0" /></a>
		                
               </td>
               <td id="displayDayEl" style="background:#000;color:#ff0;width:34px;height:24px;padding:2px 0 0 0;text-align:center;font-size:24px;font-weight: bold;" title="You are here: 23:52:51 Jan 19, 2012">19</td>
				<td style="padding-left:9px;white-space:nowrap;overflow:visible;text-align:left!important;vertical-align:middle!important;" nowrap="nowrap">
               
		                <a href="/web/20120418081201/http://www.rubyquiz.com/quiz124.html" title="8:12:01 Apr 18, 2012" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wm_tb_nxt_on.png" alt="Next capture" width="14" height="16" border="0"/></a>
		                
			    </td>
           </tr>

           <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
           <tr style="width:110px;height:13px;font-size:9px!important;">
				<td style="padding-right:9px;font-size:11px!important;font-weight: bold;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20101127174111/http://rubyquiz.com/quiz124.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="27 Nov 2010"><strong>2010</strong></a>
		                
               </td>
               <td id="displayYearEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight: bold;padding-top:1px;width:34px;height:13px;text-align:center;" title="You are here: 23:52:51 Jan 19, 2012">2012</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight: bold;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20130215052803/http://rubyquiz.com/quiz124.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="15 Feb 2013"><strong>2013</strong></a>
		                
				</td>
           </tr>
           </tbody></table>
       </td>

       </tr>
       <tr>
       <td style="vertical-align:middle;padding:0!important;">
           <a href="/web/20120119235251*/http://rubyquiz.com/quiz124.html" style="color:#33f;font-size:11px;font-weight:bold;background-color:transparent;border:none;" title="See a list of every capture for this URL"><strong>31 captures</strong></a>
           <div style="margin:0!important;padding:0!important;color:#666;font-size:9px;padding-top:2px!important;white-space:nowrap;" title="Timespan for captures of this URL">21 Apr 07 - 15 Feb 13</div>
       </td>
       <td style="padding:0!important;">
       <a style="position:relative; white-space:nowrap; width:450px;height:27px;" href="" id="wm-graph-anchor">
       <div id="wm-ipp-sparkline" style="position:relative; white-space:nowrap; width:450px;height:27px;background-color:#fff;cursor:pointer;border-right:1px solid #ccc;" title="Explore captures for this URL">
			<img id="sparklineImgId" style="position:absolute; z-index:9012; top:0px; left:0px;"
				onmouseover="showTrackers('inline');" 
				onmouseout="showTrackers('none');"
				onmousemove="trackMouseMove(event,this)"
				alt="sparklines"
				width="450"
				height="27"
				border="0"
				src="/web/jsp/graph.jsp?graphdata=450_27_1996:-1:000000000000_1997:-1:000000000000_1998:-1:000000000000_1999:-1:000000000000_2000:-1:000000000000_2001:-1:000000000000_2002:-1:000000000000_2003:-1:000000000000_2004:-1:000000000000_2005:-1:000000000000_2006:-1:000000000000_2007:-1:000100100000_2008:-1:000000010000_2009:-1:000000000000_2010:-1:100000000010_2011:-1:000000010000_2012:0:1001b000a100_2013:-1:010000000000"></img>
			<img id="wbMouseTrackYearImg" 
				style="display:none; position:absolute; z-index:9010;"
				width="25" 
				height="27"
				border="0"
				src="/static/images/toolbar/transp-yellow-pixel.png"></img>
			<img id="wbMouseTrackMonthImg"
				style="display:none; position:absolute; z-index:9011; " 
				width="2"
				height="27" 
				border="0"
				src="/static/images/toolbar/transp-red-pixel.png"></img>
       </div>
		</a>

       </td>
       </tr></tbody></table>
   </td>
   <td style="text-align:right;padding:5px;width:65px;font-size:11px!important;">
       <a href="javascript:;" onclick="document.getElementById('wm-ipp').style.display='none';" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_close.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;margin-bottom:23px;background-color:transparent;border:none;" title="Close the toolbar">Close</a>
       <a href="http://faq.web.archive.org/" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_help.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;background-color:transparent;border:none;" title="Get some help using the Wayback Machine">Help</a>
   </td>
   </tr></tbody></table>

</div>
</div>
<script type="text/javascript">
 var wmDisclaimBanner = document.getElementById("wm-ipp");
 if(wmDisclaimBanner != null) {
   disclaimElement(wmDisclaimBanner);
 }
</script>
<!-- END WAYBACK TOOLBAR INSERT -->

	<div id="page">
		<div id="header"><span class="ruby">Ruby</span> <span class="quiz">Quiz</span></div>
		<div id="content">
			<span class="title">Magic Squares (#124)</span>
			<p>A magic square of size N is a square with the numbers from 1 to N ** 2 arranged so that each row, column, and the two long diagonals have the same sum.  For example, a magic square for N = 5 could be:</p>
			<p class="example">+------------------------+<br />| 15 |  8 |  1 | 24 | 17 |<br />+------------------------+<br />| 16 | 14 |  7 |  5 | 23 |<br />+------------------------+<br />| 22 | 20 | 13 |  6 |  4 |<br />+------------------------+<br />|  3 | 21 | 19 | 12 | 10 |<br />+------------------------+<br />|  9 |  2 | 25 | 18 | 11 |<br />+------------------------+</p>
			<p>In this case the magic sum is 65.  All rows, columns, and both diagonals add up to that.</p>
			<p>This week's Ruby Quiz is to write a program that builds magic squares.  To keep the problem easy, I will say that your program only needs to work for odd values of N.  Try to keep your runtimes pretty reasonable even for the bigger values of N:</p>
			<p class="example">$ time ruby magic_square.rb 9<br />+--------------------------------------------+<br />| 45 | 34 | 23 | 12 |  1 | 80 | 69 | 58 | 47 |<br />+--------------------------------------------+<br />| 46 | 44 | 33 | 22 | 11 |  9 | 79 | 68 | 57 |<br />+--------------------------------------------+<br />| 56 | 54 | 43 | 32 | 21 | 10 |  8 | 78 | 67 |<br />+--------------------------------------------+<br />| 66 | 55 | 53 | 42 | 31 | 20 | 18 |  7 | 77 |<br />+--------------------------------------------+<br />| 76 | 65 | 63 | 52 | 41 | 30 | 19 | 17 |  6 |<br />+--------------------------------------------+<br />|  5 | 75 | 64 | 62 | 51 | 40 | 29 | 27 | 16 |<br />+--------------------------------------------+<br />| 15 |  4 | 74 | 72 | 61 | 50 | 39 | 28 | 26 |<br />+--------------------------------------------+<br />| 25 | 14 |  3 | 73 | 71 | 60 | 49 | 38 | 36 |<br />+--------------------------------------------+<br />| 35 | 24 | 13 |  2 | 81 | 70 | 59 | 48 | 37 |<br />+--------------------------------------------+<br /><br />real    0m0.012s<br />user    0m0.006s<br />sys     0m0.006s</p>
			<p>For extra credit, support even values of N.  You don't need to worry about N = 2 though as it is impossible.</p>
			<hr />
			<p><span class="title">Quiz Summary</span></p>
			<p>I was pleasantly surprised by the number of people that tackled the extra credit this time around.  Essentially, there are different algorithms for building magic squares depending on the size of the square.  There are in fact three different algorithms:  one for odd sizes, one for doubly even (divisible by 4) sizes, and another for singly even (divisible by 2 but not 4) sizes.</p>
			<p>One solution that did handle all three cases came from David Tran.  Let's dive right into how David constructs the squares:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="keyword">class</span> MagicSquare<br /><br />      <span class="keyword">def</span> initialize(size = 3)<br />        raise <span class="string">"Error: size must greater than 2."</span> <span class="keyword">if</span> size &lt; 3<br />        <span class="variable">@magic_square</span> = <span class="keyword">if</span> (size % 2 != 0)<br />          OddMagicSquare.new(size)<br />        <span class="keyword">elsif</span> (size % 4 == 0)<br />          DoublyEvenMagicSquare.new(size)<br />        <span class="keyword">else</span><br />          SinglyEvenMagicSquare.new(size)<br />        <span class="keyword">end</span><br />      <span class="keyword">end</span><br /><br />      <span class="comment"># ...</span><br /><br /></div></div>
			<p>Here we see the initialization deferred to various classes based on the requested square size.  These are just the conditions for the various algorithms I mentioned earlier.</p>
			<p>One point of interest is that this solution won't construct a magic square of size one, though they are legal:</p>
			<p class="example">+---+<br />| 1 |<br />+---+</p>
			<p>Let's see some of the other methods in this class:</p>
			<div class="code"><span class="type">ruby</span><div class="body">      <span class="comment"># ...</span><br /><br />      <span class="keyword">def</span> size<br />        <span class="variable">@magic_square</span>.size<br />      <span class="keyword">end</span><br /><br />      <span class="keyword">def</span> [](i,j)<br />        <span class="variable">@magic_square</span>[i,j]<br />      <span class="keyword">end</span><br /><br />      <span class="comment"># ...</span><br /><br /></div></div>
			<p>These two methods just delegate to the inner square object.  Nothing tricky there.</p>
			<p>Next we have the pretty printer:</p>
			<div class="code"><span class="type">ruby</span><div class="body">      <span class="comment"># ...</span><br /><br />      <span class="keyword">def</span> to_s<br />        digits = (size * size).to_s.size<br />        divider = <span class="string">'+'</span> + <span class="string">'-'</span> * ((digits + 2) * size + (size - 1)) + <span class="string">"+\n"</span><br />        (0...size).inject(divider) <span class="keyword">do</span> |s, i|<br />          (0...size).inject(s + <span class="string">"|"</span>) <span class="keyword">do</span> |s, j|<br />            s + <span class="string">" #{self[i,j].to_s.rjust(digits)} |"</span><br />          <span class="keyword">end</span> + <span class="string">"\n"</span> + divider<br />        <span class="keyword">end</span><br />      <span class="keyword">end</span><br /><br />      <span class="comment"># ...</span><br /><br /></div></div>
			<p>Most solutions included a routine pretty similar to this.  You first have to find the width of the largest number and assemble a properly size border.  Then you can iterate over the rows and cells printing them at the proper width and with borders between.</p>
			<p>David also included a method that verifies his work:</p>
			<div class="code"><span class="type">ruby</span><div class="body">      <span class="comment"># ...</span><br /><br />      <span class="keyword">def</span> is_magic_square?<br />        size = <span class="keyword">self</span>.size<br />        n = size * size<br /><br />        array = Array.new(n)<br />        (0...size).each <span class="keyword">do</span> |i|<br />          (0...size).each <span class="keyword">do</span> |j|<br />            index = <span class="keyword">self</span>[i,j] - 1<br />            <span class="keyword">return</span> <span class="keyword">false</span> <span class="keyword">if</span> (index &lt; 0) || (index &gt;= n) || array[index]<br />            array[index] = <span class="keyword">true</span><br />          <span class="keyword">end</span><br />        <span class="keyword">end</span><br />        <span class="keyword">return</span> <span class="keyword">false</span> <span class="keyword">unless</span> array.all?<br /><br />        sum = size * (size * size + 1) / 2<br />        (0...size).each <span class="keyword">do</span> |i|<br />          <span class="keyword">return</span> <span class="keyword">false</span> <span class="keyword">if</span> sum != (0...size).inject(0) { |s,j| s + <span class="keyword">self</span>[i,j] }<br />          <span class="keyword">return</span> <span class="keyword">false</span> <span class="keyword">if</span> sum != (0...size).inject(0) { |s,j| s + <span class="keyword">self</span>[j,i] }<br />        <span class="keyword">end</span><br />        <span class="keyword">return</span> <span class="keyword">false</span> <span class="keyword">if</span> sum != (0...size).inject(0) { |s,i| s + <span class="keyword">self</span>[i,i] }<br />        <span class="keyword">return</span> <span class="keyword">false</span> <span class="keyword">if</span> sum != (0...size).inject(0) { |s,i|<br />          s + <span class="keyword">self</span>[i, size-1-i]<br />        }<br />        <span class="keyword">true</span><br />      <span class="keyword">end</span><br /><br />      <span class="comment"># ...</span><br /><br /></div></div>
			<p>This method begins by calculating a few sizes.  It then launches into verifying that all the numbers in the expected range were used.  This code works by filling an Array the length of all the numbers with nils.  It then walks all numbers of the square, replacing that index with a true value.  Finally it checks that they are all true.  The rest of the method does the standard magic square validation by row, column, and diagonal.</p>
			<p>We're now ready to examine the three individual algorithms:</p>
			<div class="code"><span class="type">ruby</span><div class="body">      <span class="comment"># ...</span><br /><br />      private<br />      <span class="keyword">class</span> OddMagicSquare<br />        attr_reader :size<br /><br />        <span class="keyword">def</span> initialize(size)<br />          <span class="variable">@size</span> = size<br />          n = <span class="variable">@size</span> * <span class="variable">@size</span><br />          <span class="variable">@array</span> = Array.new(n)<br />          i, j = 0, <span class="variable">@size</span>/2<br />          (1..n).each <span class="keyword">do</span> |v|<br />            <span class="variable">@array</span>[get_index(i,j)] = v<br />            a, b = i-1, j+1<br />            i, j = <span class="keyword">self</span>[a,b] ? [i+1, j] : [a, b]<br />          <span class="keyword">end</span><br />        <span class="keyword">end</span><br /><br />        <span class="keyword">def</span> [](i, j)<br />          <span class="variable">@array</span>[get_index(i,j)]<br />        <span class="keyword">end</span><br /><br />        private<br />        <span class="keyword">def</span> get_index(i, j)<br />          (i % <span class="variable">@size</span>) * <span class="variable">@size</span> + (j % <span class="variable">@size</span>)<br />        <span class="keyword">end</span><br />      <span class="keyword">end</span><br /><br />      <span class="comment"># ...</span><br /><br /></div></div>
			<p>The algorithm for odd size magic squares is pretty straightforward.  You begin by placing a one in the top center of the of the square.  From there you just count, placing each number you come to in the square above and to the right of the last square you filled.  The board "wraps" for these movements, so moving off the top brings you to the bottom and moving off the right side returns you to the left.  If a normal move would take you to a filled square, you drop one square instead.</p>
			<p>The above is a Ruby implementation of this algorithm.  The values are all calculated at the time of object construction and stored in an instance variable.  They can then be accessed at any time via the [] method which uses row major indexing.</p>
			<div class="code"><span class="type">ruby</span><div class="body">      <span class="comment"># ...</span><br /><br />      <span class="keyword">class</span> DoublyEvenMagicSquare<br />        attr_reader :size<br /><br />        <span class="keyword">def</span> initialize(size)<br />          <span class="variable">@size</span> = size<br />        <span class="keyword">end</span><br /><br />        <span class="keyword">def</span> [](i, j)<br />          i, j = i % <span class="variable">@size</span>, j % <span class="variable">@size</span><br />          value = (i * <span class="variable">@size</span>) + j + 1<br />          i, j = i % 4, j % 4<br />          ((i == j) || (i + j == 3)) ? (<span class="variable">@size</span>*<span class="variable">@size</span>+1-value) : value<br />        <span class="keyword">end</span><br />      <span class="keyword">end</span><br /><br />      <span class="comment"># ...</span><br /><br /></div></div>
			<p>Doubly even squares use an easy algorithm that can calculate a given value given just the coordinates.  Because of that, no effort is made to pre-calculate the values here and all the work is done in the []() method.</p>
			<p>This algorithm divides the overall grid into two kinds of squares.  One type is all squares that land on any diagonal created by subdividing the grid into four by four subgrids.  All other squares make up the other type.  Once you know which type of square you are dealing with, simple counting, from left to right and top to bottom, will give you the value of the square.  Diagonal squares count down from the highest number and the other squares count up from one.</p>
			<p>We have one more algorithm to go:</p>
			<div class="code"><span class="type">ruby</span><div class="body">      <span class="keyword">class</span> SinglyEvenMagicSquare<br />        attr_reader :size<br /><br />        L = [4, 1, 2, 3]<br />        U = [1, 4, 2, 3]<br />        X = [1, 4, 3, 2]<br /><br />        <span class="keyword">def</span> initialize(size)<br />          <span class="variable">@size</span> = size<br />          <span class="variable">@odd_magic_square</span> = MagicSquare.new(<span class="variable">@size</span>/2)<br />        <span class="keyword">end</span><br /><br />        <span class="keyword">def</span> [](i, j)<br />          i, j = i % <span class="variable">@size</span>, j % <span class="variable">@size</span><br />          ii, jj = i <span class="string">/ 2, j /</span> 2<br />          center = <span class="variable">@size</span> <span class="string">/ 2 /</span> 2<br />          value = <span class="variable">@odd_magic_square</span>[ii, jj]<br />          <span class="keyword">case</span><br />            <span class="keyword">when</span> ii &lt; center <span class="keyword">then</span> L<br />            <span class="keyword">when</span> ii == center <span class="keyword">then</span> (jj == center) ? U : L<br />            <span class="keyword">when</span> ii == center+1 <span class="keyword">then</span> (jj == center) ? L : U<br />            <span class="keyword">else</span> X<br />          <span class="keyword">end</span> [i%2*2 + j%2] + 4 * (value - 1)<br />        <span class="keyword">end</span><br />      <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br />    <span class="comment"># ...</span><br /><br /></div></div>
			<p>The final algorithm is the trickiest.  You divide the grid into two by two subgrids.  Each subgrid is assigned a letter:  L, U, or X.  The first (size - 2) / 4 + 1 rows are L's, there's one row of U's, and the rest of the rows are X's.  You also swap the center U with the L just above it.  The letters describe the order you fill subgrids.  You can see these orders defined in constants at the top of David's class.  The only other element you need to know is the order to fill in the subgrids.  That is determined by building a size / 2 magic square using the odd pattern described early.  The order of those numbers dictate the order the subgrids are filled in.</p>
			<p>The final piece of the puzzle is the application code:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="comment"># ...</span><br /><br />    <span class="keyword">if</span> <span class="keyword">__FILE__</span> == <span class="global">$0</span><br />      puts MagicSquare.new(ARGV[0].to_i)<br />    <span class="keyword">end</span><br /><br /></div></div>
			<p>This just builds and prints the correct square object from the choices we have been examining.  Note that to_s() is called implicitly by puts().</p>
			<p>My thanks to all the brave souls who went above and beyond the quiz requirements to show us great solutions.</p>
			<p>Tomorrow we will play with some fractal fun...</p>
		</div>
		<div id="logo"><img src="/web/20120119235251im_/http://rubyquiz.com/images/ruby_quiz_logo.jpg" alt="" width="157" height="150" /></div>
		<div id="links">
			<span class="title">Quiz Solutions</span>
			<ol>
				<li><a href="/web/20120119235251/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/252102">Drew Olson</a></li>
				<li><a href="/web/20120119235251/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/252267">Harry Kakueki</a></li>
				<li><a href="/web/20120119235251/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/252269">Robert Dober</a></li>
				<li><a href="/web/20120119235251/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/252276">akbarhome</a></li>
				<li><a href="/web/20120119235251/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/252285">Rick DeNatale</a></li>
				<li><a href="/web/20120119235251/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/252286">Bryan Weatherly</a></li>
				<li><a href="/web/20120119235251/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/252296">James Koppel</a></li>
				<li><a href="/web/20120119235251/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/252297">Hirotsugu Asari</a></li>
				<li><a href="/web/20120119235251/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/252300">James Edward Gray II</a></li>
				<li><a href="/web/20120119235251/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/252307">Drew Olson (2)</a></li>
				<li><a href="/web/20120119235251/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/252315">Donald Ball</a></li>
				<li><a href="/web/20120119235251/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/252328">Dan Manges</a></li>
				<li><a href="/web/20120119235251/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/252335">David Tran</a></li>
				<li><a href="/web/20120119235251/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/252336">Christian Roese</a></li>
				<li><a href="/web/20120119235251/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/252338">David Tran (2)</a></li>
				<li><a href="/web/20120119235251/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/252342">Harry Kakueki (2)</a></li>
				<li><a href="/web/20120119235251/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/252363">Nicolas Modrzyk</a></li>
				<li><a href="/web/20120119235251/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/252365">David Tran (3)</a></li>
				<li><a href="/web/20120119235251/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/252374">Yossef Mendelssohn</a></li>
				<li><a href="/web/20120119235251/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/252379">doug meyer</a></li>
				<li><a href="/web/20120119235251/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/252443">Ivo Dancet</a></li>
				<li><a href="/web/20120119235251/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/252534">G.Durga Prasad</a></li>
				<li><a href="/web/20120119235251/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/252561">Ruben</a></li>
				<li><a href="/web/20120119235251/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/253064">Harry Kakueki (3)</a></li>
			</ol>
			<p><a href="/web/20120119235251/http://rubyquiz.com/quiz124_sols.zip">Download Solutions</a></p>
			<p><a href="/web/20120119235251/http://rubyquiz.com/index.html">Back to Quiz Listing</a></p>
		</div>
		<div id="footer">&nbsp;</div>
	</div>
</body>
</html>





<!--
     FILE ARCHIVED ON 23:52:51 Jan 19, 2012 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 13:10:47 Jun 5, 2013.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
