<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>


<!-- Start Wayback Rewrite JS Include -->
<script type="text/javascript" src="/static/js/jwplayer/jwplayer.js" ></script>
<script type="text/javascript" src="/static/js/video-embed-rewriter.js"></script>
<script type="text/javascript">
function initYTVideo(id)
{
	_wmVideos_.init("/web/", id);
}
</script>
<!-- End Wayback Rewrite JS Include -->

	<title>Ruby Quiz - Cows and Bulls (#32)</title>
	<link rel="stylesheet" type="text/css" href="/web/20120121205703cs_/http://rubyquiz.com/quiz.css" />
	<link rel="stylesheet" type="text/css" href="/web/20120121205703cs_/http://rubyquiz.com/print.css" media="print" />
</head><body>
<!-- BEGIN WAYBACK TOOLBAR INSERT -->

<script type="text/javascript" src="/static/js/disclaim-element.js" ></script>
<script type="text/javascript" src="/static/js/graph-calc.js" ></script>
<script type="text/javascript" src="/static/jflot/jquery.min.js" ></script>
<script type="text/javascript">
//<![CDATA[
var firstDate = 820454400000;
var lastDate = 1388534399999;
var wbPrefix = "/web/";
var wbCurrentUrl = "http:\/\/rubyquiz.com\/quiz32.html";

var curYear = -1;
var curMonth = -1;
var yearCount = 18;
var firstYear = 1996;
var imgWidth = 450;
var yearImgWidth = 25;
var monthImgWidth = 2;
var trackerVal = "none";
var displayDay = "21";
var displayMonth = "Jan";
var displayYear = "2012";
var prettyMonths = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

function showTrackers(val) {
	if(val == trackerVal) {
		return;
	}
	if(val == "inline") {
		document.getElementById("displayYearEl").style.color = "#ec008c";
		document.getElementById("displayMonthEl").style.color = "#ec008c";
		document.getElementById("displayDayEl").style.color = "#ec008c";		
	} else {
		document.getElementById("displayYearEl").innerHTML = displayYear;
		document.getElementById("displayYearEl").style.color = "#ff0";
		document.getElementById("displayMonthEl").innerHTML = displayMonth;
		document.getElementById("displayMonthEl").style.color = "#ff0";
		document.getElementById("displayDayEl").innerHTML = displayDay;
		document.getElementById("displayDayEl").style.color = "#ff0";
	}
   document.getElementById("wbMouseTrackYearImg").style.display = val;
   document.getElementById("wbMouseTrackMonthImg").style.display = val;
   trackerVal = val;
}
function getElementX2(obj) {
	var thing = jQuery(obj);
	if((thing == undefined) 
			|| (typeof thing == "undefined") 
			|| (typeof thing.offset == "undefined")) {
		return getElementX(obj);
	}
	return Math.round(thing.offset().left);
}
function trackMouseMove(event,element) {

   var eventX = getEventX(event);
   var elementX = getElementX2(element);
   var xOff = eventX - elementX;
	if(xOff < 0) {
		xOff = 0;
	} else if(xOff > imgWidth) {
		xOff = imgWidth;
	}
   var monthOff = xOff % yearImgWidth;

   var year = Math.floor(xOff / yearImgWidth);
	var yearStart = year * yearImgWidth;
   var monthOfYear = Math.floor(monthOff / monthImgWidth);
   if(monthOfYear > 11) {
       monthOfYear = 11;
   }
   // 1 extra border pixel at the left edge of the year:
   var month = (year * 12) + monthOfYear;
   var day = 1;
	if(monthOff % 2 == 1) {
		day = 15;
	}
	var dateString = 
		zeroPad(year + firstYear) + 
		zeroPad(monthOfYear+1,2) +
		zeroPad(day,2) + "000000";

	var monthString = prettyMonths[monthOfYear];
	document.getElementById("displayYearEl").innerHTML = year + 1996;
	document.getElementById("displayMonthEl").innerHTML = monthString;
	// looks too jarring when it changes..
	//document.getElementById("displayDayEl").innerHTML = zeroPad(day,2);

	var url = wbPrefix + dateString + '/' +  wbCurrentUrl;
	document.getElementById('wm-graph-anchor').href = url;

   //document.getElementById("wmtbURL").value="evX("+eventX+") elX("+elementX+") xO("+xOff+") y("+year+") m("+month+") monthOff("+monthOff+") DS("+dateString+") Moy("+monthOfYear+") ms("+monthString+")";
   if(curYear != year) {
       var yrOff = year * yearImgWidth;
       document.getElementById("wbMouseTrackYearImg").style.left = yrOff + "px";
       curYear = year;
   }
   if(curMonth != month) {
       var mtOff = year + (month * monthImgWidth) + 1;
       document.getElementById("wbMouseTrackMonthImg").style.left = mtOff + "px";
       curMonth = month;
   }
}
//]]>
</script>

<style type="text/css">body{margin-top:0!important;padding-top:0!important;min-width:800px!important;}#wm-ipp a:hover{text-decoration:underline!important;}</style>
<div id="wm-ipp" style="display:none; position:relative;padding:0 5px;min-height:70px;min-width:800px; z-index:9000;">
<div id="wm-ipp-inside" style="position:fixed;padding:0!important;margin:0!important;width:97%;min-width:780px;border:5px solid #000;border-top:none;background-image:url(/static/images/toolbar/wm_tb_bk_trns.png);text-align:center;-moz-box-shadow:1px 1px 3px #333;-webkit-box-shadow:1px 1px 3px #333;box-shadow:1px 1px 3px #333;font-size:11px!important;font-family:'Lucida Grande','Arial',sans-serif!important;">
   <table style="border-collapse:collapse;margin:0;padding:0;width:100%;"><tbody><tr>
   <td style="padding:10px;vertical-align:top;min-width:110px;">
   <a href="/web/" title="Wayback Machine home page" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wayback-toolbar-logo.png" alt="Wayback Machine" width="110" height="39" border="0"/></a>
   </td>
   <td style="padding:0!important;text-align:center;vertical-align:top;width:100%;">

       <table style="border-collapse:collapse;margin:0 auto;padding:0;width:570px;"><tbody><tr>
       <td style="padding:3px 0;" colspan="2">
       <form target="_top" method="get" action="/web/form-submit.jsp" name="wmtb" id="wmtb" style="margin:0!important;padding:0!important;"><input type="text" name="url" id="wmtbURL" value="http://rubyquiz.com/quiz32.html" style="width:400px;font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;" onfocus="javascript:this.focus();this.select();" /><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20120121205703" /><input type="submit" value="Go" style="font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;margin-left:5px;" /><span id="wm_tb_options" style="display:block;"></span></form>
       </td>
       <td style="vertical-align:bottom;padding:5px 0 0 0!important;" rowspan="2">
           <table style="border-collapse:collapse;width:110px;color:#99a;font-family:'Helvetica','Lucida Grande','Arial',sans-serif;"><tbody>
			
           <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
           <tr style="width:110px;height:16px;font-size:10px!important;">
           	<td style="padding-right:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20110824083027/http://www.rubyquiz.com/quiz32.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="24 Aug 2011"><strong>AUG</strong></a>
		                
               </td>
               <td id="displayMonthEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight:bold;text-transform:uppercase;width:34px;height:15px;padding-top:1px;text-align:center;" title="You are here: 20:57:03 Jan 21, 2012">JAN</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20120418140739/http://www.rubyquiz.com/quiz32.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="18 Apr 2012"><strong>APR</strong></a>
		                
               </td>
           </tr>

           <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
           <tr>
               <td style="padding-right:9px;white-space:nowrap;overflow:visible;text-align:right!important;vertical-align:middle!important;" nowrap="nowrap">
               
		                <a href="/web/20110824083027/http://www.rubyquiz.com/quiz32.html" title="8:30:27 Aug 24, 2011" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0" /></a>
		                
               </td>
               <td id="displayDayEl" style="background:#000;color:#ff0;width:34px;height:24px;padding:2px 0 0 0;text-align:center;font-size:24px;font-weight: bold;" title="You are here: 20:57:03 Jan 21, 2012">21</td>
				<td style="padding-left:9px;white-space:nowrap;overflow:visible;text-align:left!important;vertical-align:middle!important;" nowrap="nowrap">
               
		                <a href="/web/20120418140739/http://www.rubyquiz.com/quiz32.html" title="14:07:39 Apr 18, 2012" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wm_tb_nxt_on.png" alt="Next capture" width="14" height="16" border="0"/></a>
		                
			    </td>
           </tr>

           <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
           <tr style="width:110px;height:13px;font-size:9px!important;">
				<td style="padding-right:9px;font-size:11px!important;font-weight: bold;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20101127172907/http://rubyquiz.com/quiz32.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="27 Nov 2010"><strong>2010</strong></a>
		                
               </td>
               <td id="displayYearEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight: bold;padding-top:1px;width:34px;height:13px;text-align:center;" title="You are here: 20:57:03 Jan 21, 2012">2012</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight: bold;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20130215052615/http://rubyquiz.com/quiz32.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="15 Feb 2013"><strong>2013</strong></a>
		                
				</td>
           </tr>
           </tbody></table>
       </td>

       </tr>
       <tr>
       <td style="vertical-align:middle;padding:0!important;">
           <a href="/web/20120121205703*/http://rubyquiz.com/quiz32.html" style="color:#33f;font-size:11px;font-weight:bold;background-color:transparent;border:none;" title="See a list of every capture for this URL"><strong>30 captures</strong></a>
           <div style="margin:0!important;padding:0!important;color:#666;font-size:9px;padding-top:2px!important;white-space:nowrap;" title="Timespan for captures of this URL">12 Apr 06 - 15 Feb 13</div>
       </td>
       <td style="padding:0!important;">
       <a style="position:relative; white-space:nowrap; width:450px;height:27px;" href="" id="wm-graph-anchor">
       <div id="wm-ipp-sparkline" style="position:relative; white-space:nowrap; width:450px;height:27px;background-color:#fff;cursor:pointer;border-right:1px solid #ccc;" title="Explore captures for this URL">
			<img id="sparklineImgId" style="position:absolute; z-index:9012; top:0px; left:0px;"
				onmouseover="showTrackers('inline');" 
				onmouseout="showTrackers('none');"
				onmousemove="trackMouseMove(event,this)"
				alt="sparklines"
				width="450"
				height="27"
				border="0"
				src="/web/jsp/graph.jsp?graphdata=450_27_1996:-1:000000000000_1997:-1:000000000000_1998:-1:000000000000_1999:-1:000000000000_2000:-1:000000000000_2001:-1:000000000000_2002:-1:000000000000_2003:-1:000000000000_2004:-1:000000000000_2005:-1:000000000000_2006:-1:000100000100_2007:-1:000100200000_2008:-1:000010000000_2009:-1:000000000000_2010:-1:100000000010_2011:-1:000000010000_2012:0:10017000a100_2013:-1:010000000000"></img>
			<img id="wbMouseTrackYearImg" 
				style="display:none; position:absolute; z-index:9010;"
				width="25" 
				height="27"
				border="0"
				src="/static/images/toolbar/transp-yellow-pixel.png"></img>
			<img id="wbMouseTrackMonthImg"
				style="display:none; position:absolute; z-index:9011; " 
				width="2"
				height="27" 
				border="0"
				src="/static/images/toolbar/transp-red-pixel.png"></img>
       </div>
		</a>

       </td>
       </tr></tbody></table>
   </td>
   <td style="text-align:right;padding:5px;width:65px;font-size:11px!important;">
       <a href="javascript:;" onclick="document.getElementById('wm-ipp').style.display='none';" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_close.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;margin-bottom:23px;background-color:transparent;border:none;" title="Close the toolbar">Close</a>
       <a href="http://faq.web.archive.org/" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_help.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;background-color:transparent;border:none;" title="Get some help using the Wayback Machine">Help</a>
   </td>
   </tr></tbody></table>

</div>
</div>
<script type="text/javascript">
 var wmDisclaimBanner = document.getElementById("wm-ipp");
 if(wmDisclaimBanner != null) {
   disclaimElement(wmDisclaimBanner);
 }
</script>
<!-- END WAYBACK TOOLBAR INSERT -->

	<div id="page">
		<div id="header"><span class="ruby">Ruby</span> <span class="quiz">Quiz</span></div>
		<div id="content">
			<span class="title">Cows and Bulls (#32)</span>
			<p>by Pat Eyler</p>
			<p>My kids like to play a variant of "Cows and Bulls" when we're driving.  One of them (the server, to use a computing term -- you'll see why in a minute) will think of a word (we usually play with either three or four letters), and the other (the client) will try to guess it.  With each guess, the server will respond with the number of 'cows' (letters in the word, but not in the right place) and bulls (letters in the correct place in the word).  </p>
			<p>Here's a short example:</p>
			<p class="example">Server:  (thinks of the word cow)  I'm thinking of a three letter word.<br />Client:  cab<br />Server:  0 cows and 1 bull<br />Client:  cat<br />Server:  0 cows and 1 bull<br />Client:  cot<br />Server:  0 cows and 2 bulls<br />Client:  cow<br />Server:  That's right!</p>
			<p>This weeks quiz has a couple of flavors:</p>
			<p>1)  You can write a server that will play our version of "Cows and Bulls".  It should follow a simplified version of the above, and look like:</p>
			<p class="example">Server:  3                 # the number of letters in the word<br />Client:  "cab"<br />Server:  "0 1"<br />Client:  "cat"<br />Server:  "0 1"<br />Client:  "cot"<br />Server:  "0 2"<br />Client:  "cow"<br />Server:  1                 #  indicating success</p>
			<p>2) You should write also write a client that a player can interact with to play the game.</p>
			<p>3) You can also write a player that will interact with the server and play a game.</p>
			<hr />
			<p><span class="title">Quiz Summary</span></p>
			<p>This game isn't much of a challenge to implement, but it's plenty hard enough to actually play.  I don't even want to tell you how many guesses it took me to figure out the simple word "yes", while testing my solution.  Worse, it had me so shaken by that point all it had to say was, "I'm thinking of an 11 letter word." to send me straight to Control-C!  I don't think so.</p>
			<p>The solutions are interesting as usual.  Brian Schroeder was the only one who tried an AI player and it's a pretty basic implementation.  It just randomly guesses groups of letters, ruling out letters it knows don't work (0 cows and 0 bulls), until it gets pretty lucky and nails the word.  Brian also used the readline library for his client, which is a very nice feature.  Take a look if you haven't seen that used before.  (I hadn't.)  You can find both of the above highlights in Brian's cows-and-bulls-client.rb file.</p>
			<p>Ilmari Heikkinen's code was simple and easy to follow.  Might want to glance in there if need to see an example of basic socket usage.  (Both Ilmari and Brian rolled their own client and server code.)</p>
			<p>I'll look into my code below this time.  I was pretty lazy and cheated everywhere I could, so that should make it easy to summarize.  (Further reinforcing that I really am lazy!)</p>
			<p>Let's start with my cowsnbulls library:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="comment">#!/usr/local/bin/ruby -w</span><br /><br />    <span class="keyword">class</span> WordGame<br />        DICTIONARY = <span class="string">%w{cow moon}</span><br /><br />        <span class="keyword">def</span> <span class="keyword">self</span>.load_dictionary( file_name )<br />            DICTIONARY.clear<br /><br />            File.foreach(file_name) <span class="keyword">do</span> |line|<br />                line.downcase!<br />                line.gsub!(<span class="string">/[^a-z]/</span>, <span class="string">""</span>)<br /><br />                <span class="keyword">next</span> <span class="keyword">if</span> line.empty?<br /><br />                DICTIONARY &lt;&lt; line<br />            <span class="keyword">end</span><br />            DICTIONARY.uniq!<br />        <span class="keyword">end</span><br /><br />        <span class="comment"># ...</span><br /><br /></div></div>
			<p>The first thing any good word game needs is a dictionary and you can see my version here.  Initially, I just assigned "cow" and "moon" for testing purposes (unit tests not shown).  Then I added the class method load_dictionary() for providing a real dictionary.  Technically, this method reassigns a constant, which may feel wrong to some of you, but it's really just intended for the initial load.  You can see that it's a line-by-line read and I downcase() and remove any non-letter characters.  Because that process could create duplicates, I end with a call to uniq!().</p>
			<div class="code"><span class="type">ruby</span><div class="body">        <span class="comment"># ...</span><br /><br />        <span class="keyword">def</span> initialize( size = <span class="keyword">nil</span> )<br />            <span class="variable">@word</span> = <span class="keyword">nil</span><br /><br />            <span class="keyword">if</span> size<br />                count = 0<br />                DICTIONARY.each <span class="keyword">do</span> |word|<br />                    <span class="keyword">if</span> word.size == size<br />                        count += 1<br />                        <span class="variable">@word</span> = word <span class="keyword">if</span> rand(count) == 0<br />                    <span class="keyword">end</span><br />                <span class="keyword">end</span><br />            <span class="keyword">end</span><br /><br />            <span class="variable">@word</span> = DICTIONARY[rand(DICTIONARY.size)] <span class="keyword">if</span> <span class="variable">@word</span>.nil?<br />        <span class="keyword">end</span><br /><br />        attr_accessor :word<br /><br />        <span class="comment"># ...</span><br /><br /></div></div>
			<p>The only goal of initialize() is to pick the word for the game.  The only time that's at all tricky, is when we are given a size preference.  I could have made that section shorter with a call to find_all() and a random pick from the resulting set, but I decided to be clever and do all the work with a single walk of the dictionary.  To do that, I adapted the popular "read a random line from a file" algorithm.  I just count the correct sized words passed and replace my word choice whenever rand(count) == 0.  That assures that the first correctly sized word is replaced 100% of the time, the second 50%, the third 33.33%, etc.  That gives us a fair random pick, only walking the list once.  The final line of the method is our fall back plan (random pick), if a size was not given or found.</p>
			<p>I didn't originally have the accessor for word and it's not used in any code I'll show today.  Unfortunately, it was a necessary evil for my Web interface (not shown).</p>
			<p>Let's get to the actual game code:</p>
			<div class="code"><span class="type">ruby</span><div class="body">        <span class="comment"># ...</span><br /><br />        <span class="keyword">def</span> guess( word )<br />            answer = <span class="variable">@word</span>.dup<br />            word   = word.downcase.gsub(<span class="string">/[^a-z]/</span>, <span class="string">""</span>)<br /><br />            <span class="keyword">return</span> <span class="keyword">true</span> <span class="keyword">if</span> word == answer<br /><br />            bulls = 0<br />            word.scan(<span class="string">/[a-z]/</span>).each_with_index <span class="keyword">do</span> |char, index|<br />                <span class="keyword">break</span> <span class="keyword">if</span> index == answer.size<br />                <span class="keyword">if</span> char == answer[index, 1]<br />                    word[index, 1] = answer[index, 1] = <span class="string">"."</span><br />                    bulls += 1<br />                <span class="keyword">end</span><br />            <span class="keyword">end</span><br /><br />            cows = 0<br />            word.scan(<span class="string">/[a-z]/</span>).each <span class="keyword">do</span> |char|<br />                <span class="keyword">if</span> index = answer.index(char)<br />                    answer[index, 1] = <span class="string">"."</span><br />                    cows += 1<br />                <span class="keyword">end</span><br />            <span class="keyword">end</span><br /><br />            <span class="keyword">return</span> cows, bulls<br />        <span class="keyword">end</span><br /><br />        <span class="keyword">def</span> word_length(  )<br />            <span class="variable">@word</span>.length<br />        <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br /></div></div>
			<p>The guess() methods is really the entire game.  It starts by making a duplicate of the answer word, so it's free to damage it, and normalizing the provided guess word, same as I did with the dictionary words.  If they're the same at that point, we return true to indicate a win.  Otherwise, we return a two element Array containing a count of "cows" and "bulls".</p>
			<p>Bulls are counted simply by looking for like characters at each index.  When found, we set that index to a nonsense character (".") in both guess and answer, to keep them from affecting our count of cows.  That count again scan()s the guess word letter-by-letter, but this time index() is used to find a match in the answer, allowing it to occur anywhere.  Again, the answer location is set to a nonsense character, in case the same letter occurs more than once.</p>
			<p>The word_length() method just returns the length of the selected word, as expected.</p>
			<p>We'll skip the rest of the code in that file.  All it does it to create a command-line interface, when the library is executed.  That doesn't have anything to do with the quiz solution and it's not as cool as Brian's readline enhanced version, so look there instead.</p>
			<p>Here is my actual solution, the server:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="comment">#!/usr/local/bin/ruby -w</span><br /><br />    require <span class="string">"gserver"</span><br />    require <span class="string">"cowsnbulls"</span><br />    require <span class="string">"optparse"</span><br /><br />    <span class="keyword">class</span> TelnetServer &lt; GServer<br />        <span class="keyword">def</span> <span class="keyword">self</span>.handle_telnet( line, io )          <span class="comment"># minimal Telnet</span><br />            line.gsub!(<span class="string">/([^\015])\012/</span>, <span class="string">"\\1"</span>)      <span class="comment"># ignore bare LFs</span><br />            line.gsub!(<span class="string">/\015\0/</span>, <span class="string">""</span>)                <span class="comment"># ignore bare CRs</span><br />            line.gsub!(<span class="string">/\0/</span>, <span class="string">""</span>)                    <span class="comment"># ignore bare NULs</span><br /><br />            <span class="keyword">while</span> line.index(<span class="string">"\377"</span>)                <span class="comment"># parse Telnet codes</span><br />                <span class="keyword">if</span> line.sub!(<span class="string">/(^|[^\377])\377[\375\376](.)/</span>, <span class="string">"\\1"</span>)<br />                    <span class="comment"># answer DOs and DON'Ts with WON'Ts</span><br />                    io.print <span class="string">"\377\374#{$2}"</span><br />                <span class="keyword">elsif</span> line.sub!(<span class="string">/(^|[^\377])\377[\373\374](.)/</span>, <span class="string">"\\1"</span>)<br />                    <span class="comment"># answer WILLs and WON'Ts with DON'Ts</span><br />                    io.print <span class="string">"\377\376#{$2}"</span><br />                <span class="keyword">elsif</span> line.sub!(<span class="string">/(^|[^\377])\377\366/</span>, <span class="string">"\\1"</span>)<br />                    <span class="comment"># answer "Are You There" codes</span><br />                    io.puts <span class="string">"Still here, yes."</span><br />                <span class="keyword">elsif</span> line.sub!(<span class="string">/(^|[^\377])\377\364/</span>, <span class="string">"\\1"</span>)<br />                    <span class="comment"># do nothing - ignore IP Telnet codes</span><br />                <span class="keyword">elsif</span> line.sub!(<span class="string">/(^|[^\377])\377[^\377]/</span>, <span class="string">"\\1"</span>)<br />                    <span class="comment"># do nothing - ignore other Telnet codes</span><br />                <span class="keyword">elsif</span> line.sub!(<span class="string">/\377\377/</span>, <span class="string">"\377"</span>)<br />                    <span class="comment"># do nothing - handle escapes</span><br />                <span class="keyword">end</span><br />            <span class="keyword">end</span><br /><br />            line<br />        <span class="keyword">end</span><br /><br />        <span class="comment"># ...</span><br /><br /></div></div>
			<p>You can see that I require Ruby's standard gserver in this code and that my TelnetServer inherits from GServer.  More on that in a bit.</p>
			<p>The rest of that chunk code is just an ugly method filled with a bunch of calls to gsub!().  I'm not much of a fan of using custom protocols when it can be avoided, so my server is meant to talk to simple Telnet clients.  (You can usually get away with using Telnet without any fancy coding, but this is a minimal handler for Telnet codes.)  The method just cleanses the passed line of Telnet codes, responding to them as needed.  It tells the Telnet client that we aren't capable of any special features and ignores everything else.  That's as basic as Telnet can be.</p>
			<div class="code"><span class="type">ruby</span><div class="body">        <span class="comment"># ...</span><br /><br />        <span class="keyword">def</span> initialize( port = 61676, *args )<br />            <span class="keyword">super</span>(port, *args)<br />        <span class="keyword">end</span><br /><br />        <span class="keyword">def</span> serve( io )<br />            game = WordGame.new<br />            io.puts <span class="string">"I'm thinking of a #{game.word_length} word."</span><br />            loop <span class="keyword">do</span><br />                io.print <span class="string">"Your guess?  "</span><br />                try = <span class="keyword">self</span>.<span class="keyword">class</span>.handle_telnet(io.gets, io)<br /><br />                results = game.guess(try)<br />                <span class="keyword">if</span> results == <span class="keyword">true</span><br />                    io.puts <span class="string">"That's right!"</span><br /><br />                    io.print <span class="string">"Play again?  "</span><br />                    <span class="keyword">if</span> <span class="keyword">self</span>.<span class="keyword">class</span>.handle_telnet(io.gets[0], io) == ?y<br />                        game = WordGame.new<br />                        io.puts <span class="string">"I'm thinking of a "</span> +<br />                                <span class="string">"#{game.word_length} letter word."</span><br />                    <span class="keyword">else</span><br />                        <span class="keyword">break</span><br />                    <span class="keyword">end</span><br />                <span class="keyword">else</span><br />                    cows = <span class="keyword">if</span> results.first == 1<br />                        <span class="string">"1 Cow"</span><br />                    <span class="keyword">else</span><br />                        <span class="string">"#{results.first} Cows"</span><br />                    <span class="keyword">end</span><br />                    bulls = <span class="keyword">if</span> results.last == 1<br />                        <span class="string">"1 Bull"</span><br />                    <span class="keyword">else</span><br />                        <span class="string">"#{results.last} Bulls"</span><br />                    <span class="keyword">end</span><br />                    io.puts <span class="string">"#{cows} and #{bulls}"</span><br />                <span class="keyword">end</span><br />            <span class="keyword">end</span><br />        <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br />    <span class="comment"># ...</span><br /><br /></div></div>
			<p>Back to GServer.  Using it is a simple two-step process.  First, you need to initialize() the server and you can see that I do that here, just by setting a port to listen on.  The only other step is to override serve(), to handle individual connections.</p>
			<p>As you can see, serve() gets passed an io object, that can be read from and written to as needed.  My implementation is basically just a command-line program using io instead of STDIN and STDOUT.  I do filter all input through handle_telnet() to catch the codes, of course.  I tell the player the size of the word, loop over their answers until they get it right, offer them a new game, and end when they've had enough.  Notice that I don't need to worry about threading in here.  GServer takes care of that for me.  When serve() returns, the connection will be terminated.</p>
			<p>GServer is great for these simple networking tasks.  It's not up to the challenges of bigger server projects, but it's nice when the job is easy.</p>
			<p>Here's the final bit of code:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="comment"># ...</span><br /><br />    listen_port = 61676<br />    ARGV.options <span class="keyword">do</span> |opts|<br />        opts.banner = <span class="string">"Usage:  #{File.basename($0)}  [OPTIONS]"</span><br /><br />        opts.separator <span class="string">""</span><br />        opts.separator <span class="string">"Specific Options:"</span><br /><br />        opts.on( <span class="string">"-d"</span>, <span class="string">"--dictionary DICT_FILE"</span>,<br />                 <span class="string">"The dictionary file to pull words from."</span> ) <span class="keyword">do</span> |dict|<br />            WordGame.load_dictionary(dict)<br />        <span class="keyword">end</span><br />        opts.on( <span class="string">"-p"</span>, <span class="string">"--port PORT"</span>, Integer,<br />                 <span class="string">"The port to listen for connections on."</span> ) <span class="keyword">do</span> |port|<br />            listen_port = port<br />        <span class="keyword">end</span><br /><br />        opts.separator <span class="string">"Common Options:"</span><br /><br />        opts.on( <span class="string">"-h"</span>, <span class="string">"--help"</span>,<br />                 <span class="string">"Show this message."</span> ) <span class="keyword">do</span><br />            puts opts<br />            exit<br />        <span class="keyword">end</span><br />    <span class="keyword">end</span>.parse!<br /><br />    server = TelnetServer.new(listen_port)<br />    server.start<br />    server.join<br /><br /></div></div>
			<p>Most of that code is just option parsing with optparse.  I'm allowing a port and dictionary to be specified when the server is launched.</p>
			<p>The final three lines kick off GServer.  I build an instance, passing the port; start() the server process; and join() the server, so my code won't exit until all the server Threads do.  That's all it takes to run GServer.</p>
			<p>My thanks to Brian and Ilmari for the solutions and Pat for the quiz.  Good stuff all around.</p>
			<p>Tomorrow the I've got another submitted quiz for you, this time a tiling problem...</p>
		</div>
		<div id="logo"><img src="/web/20120121205703im_/http://rubyquiz.com/images/ruby_quiz_logo.jpg" alt="" width="157" height="150" /></div>
		<div id="links">
			<span class="title">Quiz Solutions</span>
			<ol>
				<li><a href="/web/20120121205703/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/142798">Brian Schr&ouml;der</a></li>
				<li><a href="/web/20120121205703/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/142801">Ilmari Heikkinen</a></li>
				<li><a href="/web/20120121205703/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/142909">James Edward Gray II</a></li>
			</ol>
			<p><a href="/web/20120121205703/http://rubyquiz.com/quiz32_sols.zip">Download Solutions</a></p>
			<p><a href="/web/20120121205703/http://rubyquiz.com/index.html">Back to Quiz Listing</a></p>
		</div>
		<div id="footer">&nbsp;</div>
	</div>
</body>
</html>





<!--
     FILE ARCHIVED ON 20:57:03 Jan 21, 2012 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 13:09:27 Jun 5, 2013.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
