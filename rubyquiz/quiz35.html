<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>


<!-- Start Wayback Rewrite JS Include -->
<script type="text/javascript" src="/static/js/jwplayer/jwplayer.js" ></script>
<script type="text/javascript" src="/static/js/video-embed-rewriter.js"></script>
<script type="text/javascript">
function initYTVideo(id)
{
	_wmVideos_.init("/web/", id);
}
</script>
<!-- End Wayback Rewrite JS Include -->

	<title>Ruby Quiz - Chess Variants (I) (#35)</title>
	<link rel="stylesheet" type="text/css" href="/web/20120120004210cs_/http://rubyquiz.com/quiz.css" />
	<link rel="stylesheet" type="text/css" href="/web/20120120004210cs_/http://rubyquiz.com/print.css" media="print" />
</head><body>
<!-- BEGIN WAYBACK TOOLBAR INSERT -->

<script type="text/javascript" src="/static/js/disclaim-element.js" ></script>
<script type="text/javascript" src="/static/js/graph-calc.js" ></script>
<script type="text/javascript" src="/static/jflot/jquery.min.js" ></script>
<script type="text/javascript">
//<![CDATA[
var firstDate = 820454400000;
var lastDate = 1388534399999;
var wbPrefix = "/web/";
var wbCurrentUrl = "http:\/\/rubyquiz.com\/quiz35.html";

var curYear = -1;
var curMonth = -1;
var yearCount = 18;
var firstYear = 1996;
var imgWidth = 450;
var yearImgWidth = 25;
var monthImgWidth = 2;
var trackerVal = "none";
var displayDay = "20";
var displayMonth = "Jan";
var displayYear = "2012";
var prettyMonths = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

function showTrackers(val) {
	if(val == trackerVal) {
		return;
	}
	if(val == "inline") {
		document.getElementById("displayYearEl").style.color = "#ec008c";
		document.getElementById("displayMonthEl").style.color = "#ec008c";
		document.getElementById("displayDayEl").style.color = "#ec008c";		
	} else {
		document.getElementById("displayYearEl").innerHTML = displayYear;
		document.getElementById("displayYearEl").style.color = "#ff0";
		document.getElementById("displayMonthEl").innerHTML = displayMonth;
		document.getElementById("displayMonthEl").style.color = "#ff0";
		document.getElementById("displayDayEl").innerHTML = displayDay;
		document.getElementById("displayDayEl").style.color = "#ff0";
	}
   document.getElementById("wbMouseTrackYearImg").style.display = val;
   document.getElementById("wbMouseTrackMonthImg").style.display = val;
   trackerVal = val;
}
function getElementX2(obj) {
	var thing = jQuery(obj);
	if((thing == undefined) 
			|| (typeof thing == "undefined") 
			|| (typeof thing.offset == "undefined")) {
		return getElementX(obj);
	}
	return Math.round(thing.offset().left);
}
function trackMouseMove(event,element) {

   var eventX = getEventX(event);
   var elementX = getElementX2(element);
   var xOff = eventX - elementX;
	if(xOff < 0) {
		xOff = 0;
	} else if(xOff > imgWidth) {
		xOff = imgWidth;
	}
   var monthOff = xOff % yearImgWidth;

   var year = Math.floor(xOff / yearImgWidth);
	var yearStart = year * yearImgWidth;
   var monthOfYear = Math.floor(monthOff / monthImgWidth);
   if(monthOfYear > 11) {
       monthOfYear = 11;
   }
   // 1 extra border pixel at the left edge of the year:
   var month = (year * 12) + monthOfYear;
   var day = 1;
	if(monthOff % 2 == 1) {
		day = 15;
	}
	var dateString = 
		zeroPad(year + firstYear) + 
		zeroPad(monthOfYear+1,2) +
		zeroPad(day,2) + "000000";

	var monthString = prettyMonths[monthOfYear];
	document.getElementById("displayYearEl").innerHTML = year + 1996;
	document.getElementById("displayMonthEl").innerHTML = monthString;
	// looks too jarring when it changes..
	//document.getElementById("displayDayEl").innerHTML = zeroPad(day,2);

	var url = wbPrefix + dateString + '/' +  wbCurrentUrl;
	document.getElementById('wm-graph-anchor').href = url;

   //document.getElementById("wmtbURL").value="evX("+eventX+") elX("+elementX+") xO("+xOff+") y("+year+") m("+month+") monthOff("+monthOff+") DS("+dateString+") Moy("+monthOfYear+") ms("+monthString+")";
   if(curYear != year) {
       var yrOff = year * yearImgWidth;
       document.getElementById("wbMouseTrackYearImg").style.left = yrOff + "px";
       curYear = year;
   }
   if(curMonth != month) {
       var mtOff = year + (month * monthImgWidth) + 1;
       document.getElementById("wbMouseTrackMonthImg").style.left = mtOff + "px";
       curMonth = month;
   }
}
//]]>
</script>

<style type="text/css">body{margin-top:0!important;padding-top:0!important;min-width:800px!important;}#wm-ipp a:hover{text-decoration:underline!important;}</style>
<div id="wm-ipp" style="display:none; position:relative;padding:0 5px;min-height:70px;min-width:800px; z-index:9000;">
<div id="wm-ipp-inside" style="position:fixed;padding:0!important;margin:0!important;width:97%;min-width:780px;border:5px solid #000;border-top:none;background-image:url(/static/images/toolbar/wm_tb_bk_trns.png);text-align:center;-moz-box-shadow:1px 1px 3px #333;-webkit-box-shadow:1px 1px 3px #333;box-shadow:1px 1px 3px #333;font-size:11px!important;font-family:'Lucida Grande','Arial',sans-serif!important;">
   <table style="border-collapse:collapse;margin:0;padding:0;width:100%;"><tbody><tr>
   <td style="padding:10px;vertical-align:top;min-width:110px;">
   <a href="/web/" title="Wayback Machine home page" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wayback-toolbar-logo.png" alt="Wayback Machine" width="110" height="39" border="0"/></a>
   </td>
   <td style="padding:0!important;text-align:center;vertical-align:top;width:100%;">

       <table style="border-collapse:collapse;margin:0 auto;padding:0;width:570px;"><tbody><tr>
       <td style="padding:3px 0;" colspan="2">
       <form target="_top" method="get" action="/web/form-submit.jsp" name="wmtb" id="wmtb" style="margin:0!important;padding:0!important;"><input type="text" name="url" id="wmtbURL" value="http://rubyquiz.com/quiz35.html" style="width:400px;font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;" onfocus="javascript:this.focus();this.select();" /><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20120120004210" /><input type="submit" value="Go" style="font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;margin-left:5px;" /><span id="wm_tb_options" style="display:block;"></span></form>
       </td>
       <td style="vertical-align:bottom;padding:5px 0 0 0!important;" rowspan="2">
           <table style="border-collapse:collapse;width:110px;color:#99a;font-family:'Helvetica','Lucida Grande','Arial',sans-serif;"><tbody>
			
           <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
           <tr style="width:110px;height:16px;font-size:10px!important;">
           	<td style="padding-right:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20110829045215/http://www.rubyquiz.com/quiz35.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="29 Aug 2011"><strong>AUG</strong></a>
		                
               </td>
               <td id="displayMonthEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight:bold;text-transform:uppercase;width:34px;height:15px;padding-top:1px;text-align:center;" title="You are here: 0:42:10 Jan 20, 2012">JAN</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20120418074315/http://www.rubyquiz.com/quiz35.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="18 Apr 2012"><strong>APR</strong></a>
		                
               </td>
           </tr>

           <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
           <tr>
               <td style="padding-right:9px;white-space:nowrap;overflow:visible;text-align:right!important;vertical-align:middle!important;" nowrap="nowrap">
               
		                <a href="/web/20110829045215/http://www.rubyquiz.com/quiz35.html" title="4:52:15 Aug 29, 2011" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0" /></a>
		                
               </td>
               <td id="displayDayEl" style="background:#000;color:#ff0;width:34px;height:24px;padding:2px 0 0 0;text-align:center;font-size:24px;font-weight: bold;" title="You are here: 0:42:10 Jan 20, 2012">20</td>
				<td style="padding-left:9px;white-space:nowrap;overflow:visible;text-align:left!important;vertical-align:middle!important;" nowrap="nowrap">
               
		                <a href="/web/20120418074315/http://www.rubyquiz.com/quiz35.html" title="7:43:15 Apr 18, 2012" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wm_tb_nxt_on.png" alt="Next capture" width="14" height="16" border="0"/></a>
		                
			    </td>
           </tr>

           <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
           <tr style="width:110px;height:13px;font-size:9px!important;">
				<td style="padding-right:9px;font-size:11px!important;font-weight: bold;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20101127171933/http://rubyquiz.com/quiz35.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="27 Nov 2010"><strong>2010</strong></a>
		                
               </td>
               <td id="displayYearEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight: bold;padding-top:1px;width:34px;height:13px;text-align:center;" title="You are here: 0:42:10 Jan 20, 2012">2012</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight: bold;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20130215052444/http://rubyquiz.com/quiz35.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="15 Feb 2013"><strong>2013</strong></a>
		                
				</td>
           </tr>
           </tbody></table>
       </td>

       </tr>
       <tr>
       <td style="vertical-align:middle;padding:0!important;">
           <a href="/web/20120120004210*/http://rubyquiz.com/quiz35.html" style="color:#33f;font-size:11px;font-weight:bold;background-color:transparent;border:none;" title="See a list of every capture for this URL"><strong>30 captures</strong></a>
           <div style="margin:0!important;padding:0!important;color:#666;font-size:9px;padding-top:2px!important;white-space:nowrap;" title="Timespan for captures of this URL">16 May 06 - 15 Feb 13</div>
       </td>
       <td style="padding:0!important;">
       <a style="position:relative; white-space:nowrap; width:450px;height:27px;" href="" id="wm-graph-anchor">
       <div id="wm-ipp-sparkline" style="position:relative; white-space:nowrap; width:450px;height:27px;background-color:#fff;cursor:pointer;border-right:1px solid #ccc;" title="Explore captures for this URL">
			<img id="sparklineImgId" style="position:absolute; z-index:9012; top:0px; left:0px;"
				onmouseover="showTrackers('inline');" 
				onmouseout="showTrackers('none');"
				onmousemove="trackMouseMove(event,this)"
				alt="sparklines"
				width="450"
				height="27"
				border="0"
				src="/web/jsp/graph.jsp?graphdata=450_27_1996:-1:000000000000_1997:-1:000000000000_1998:-1:000000000000_1999:-1:000000000000_2000:-1:000000000000_2001:-1:000000000000_2002:-1:000000000000_2003:-1:000000000000_2004:-1:000000000000_2005:-1:000000000000_2006:-1:000010000100_2007:-1:000101000000_2008:-1:000020000000_2009:-1:000000000000_2010:-1:100000000010_2011:-1:000000010000_2012:0:10017000a100_2013:-1:010000000000"></img>
			<img id="wbMouseTrackYearImg" 
				style="display:none; position:absolute; z-index:9010;"
				width="25" 
				height="27"
				border="0"
				src="/static/images/toolbar/transp-yellow-pixel.png"></img>
			<img id="wbMouseTrackMonthImg"
				style="display:none; position:absolute; z-index:9011; " 
				width="2"
				height="27" 
				border="0"
				src="/static/images/toolbar/transp-red-pixel.png"></img>
       </div>
		</a>

       </td>
       </tr></tbody></table>
   </td>
   <td style="text-align:right;padding:5px;width:65px;font-size:11px!important;">
       <a href="javascript:;" onclick="document.getElementById('wm-ipp').style.display='none';" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_close.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;margin-bottom:23px;background-color:transparent;border:none;" title="Close the toolbar">Close</a>
       <a href="http://faq.web.archive.org/" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_help.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;background-color:transparent;border:none;" title="Get some help using the Wayback Machine">Help</a>
   </td>
   </tr></tbody></table>

</div>
</div>
<script type="text/javascript">
 var wmDisclaimBanner = document.getElementById("wm-ipp");
 if(wmDisclaimBanner != null) {
   disclaimElement(wmDisclaimBanner);
 }
</script>
<!-- END WAYBACK TOOLBAR INSERT -->

	<div id="page">
		<div id="header"><span class="ruby">Ruby</span> <span class="quiz">Quiz</span></div>
		<div id="content">
			<span class="title">Chess Variants (I) (#35)</span>
			<p>One of the greatest challenges in programming is modular design.  Building code that adapts well to change is a Holy Grail quest for most of us.  This two-part Ruby Quiz is designed to put your ability to predict the future to the test.</p>
			<p>This week, the Ruby Quiz is to build an engine for two player chess.  Note that I said "two player" there.  You are not expected to develop an AI at any point, just a board and piece interface players can use for games.  The game should prevent illegal moves, make sure the right player moves at the right time, declare a winner when a game ends, etc.</p>
			<p>You can use any interface you like, but my recommendation is to keep it as simple as possible.  ASCII art is fine.  Pieces are traditionally represented as follows:</p>
			<p class="example">K = King<br />Q = Queen<br />B = Bishop<br />N = Knight<br />R = Rook<br />P = Pawn</p>
			<p>Uppercase is usually used for white pieces, lowercase for black.  It's fine to assume that both players alternate turns at the same keyboard.  Just provide some means to make moves and see the resulting position.  That's all we need.</p>
			<p>Next week, in part two of this quiz, I will provide a list of chess variants you are expected to modify your program to support.  You may prepare for this with your initial version in any way that you like (plug-in support, a domain specific language for chess games, etc.)  There is little point in trying to predict my chosen variations exactly though.  You don't want to know how many different variations there are to chess, trust me.</p>
			<p>Please do not post any variations this week, even after the spoiler period.  For now, we are concerned only with standard chess.</p>
			<p>If you are not familiar with the rules of chess, you can read about them here:</p>
			<p><a href="/web/20120120004210/http://www.chessvariants.com/d.chess/chess.html">Illustrated rules of chess</a></p>
			<p>Note the description of the "en-passant" rule for pawns.  Some casual chess players are not aware of this rule.  Some people are also unaware that you can castle to queenside, but you can as the rules show.</p>
			<p>You do not need to concern yourself with chess notation (unless you want to use it as an interface) or recognizing draws (other than stalemate).  You should recognize check (because it affects legal moves) and checkmate (as it signals the end of the game).</p>
			<hr />
			<p><span class="title">Quiz Summary</span></p>
			<p>As Gavin Kistner pointed out, this quiz was too much work.  There's nothing that hard about a chess game, as long as you don't need an AI, but there's just a lot of things you have to take care of.</p>
			<p>You have to define moves for six different pieces, build a board with some helper methods that can handle chess geometry, and handle edge cases like en-passant, castling and pawn promotion.  That's just a lot of tedious work.</p>
			<p>Check is the real challenge, for me anyway, because it affects so much of the game.  You must get out of check when you're in check.  You can never make a move that puts you in check.  You can't even castle through a square if you would be in check in that square.  All that eventually adds up.</p>
			<p>What I should have done with this quiz was provide a chess library and then ask for the variations, which is the interesting part of the challenge.  Luckily, Ruby Quiz solvers are always making me look good, and that's basically what we have now, thanks to their efforts.  Three people have submitted libraries and another person has submitted an example of how to use an existing library to solve this problem, with very little code even.  Now, if anyone else wants to give round two a try, my hope is that you'll use these libraries as jumping off points and still be able to join in on the fun.</p>
			<p>The three libraries are surprisingly similar.  We all had about the same idea, build a class hierarchy for the pieces and create a board.  I believe even Bangkok, the library used by Jim Menard's example works that way.  The idea is that common chess piece behavior goes in a Piece class.  Then you subclass Piece for Pawn, Knight, etc., adding the unique behaviors.  In chess, this generally amounts to the piece's unique moves.</p>
			<p>Paolo Capriotti skipped the chess subclasses and rolled the move types into the Board class.  This isn't unreasonable.  Knowing what moves a piece can make at any point in the game requires knowledge of the board.  Those of us who use piece classes pass the board down to the piece to account for this.  Paolo just reverses that.</p>
			<p>The other essential part of a chess library is a Board object, as I said before.  Chess definitely has its own geometry and you need an object that encompasses that.  One question is how to refer to the square themselves.  You can go with a two dimensional array style notation, wrap those x and y pairs in a class, or lean on chess notation and accept things like "e4".  When dealing with chess positions, we often need information about ranks, files, diagonals, those wacky L-shaped knight jumps, etc.  Board provides this information as well. </p>
			<p>Obviously, Board also needs to provide piece moving routines and this can be heavy lifting.  These methods need to be aware of castling, pawn promotion, en-passant capture, and check.  That's the real guts of a chess game.</p>
			<p>I'm not going to dump entire chess libraries in here.  Instead, I'll show usage.  Here's Paolo's chess game portion of rchess.rb:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="keyword">class</span> ChessGame<br />      attr_reader :board<br />      include UI<br /><br />      <span class="keyword">def</span> initialize<br />        <span class="variable">@board</span> = Board.new(8,8)<br />        <span class="variable">@board</span>.promotion_piece = :queen<br /><br />        (0...8).each <span class="keyword">do</span> |x|<br />          <span class="variable">@board</span>[x,1] = Piece.new( :black, :pawn )<br />          <span class="variable">@board</span>[x,6] = Piece.new( :white, :pawn )<br />        <span class="keyword">end</span><br /><br />        <span class="variable">@board</span>[0,0] = Piece.new( :black, :rook )<br />        <span class="variable">@board</span>[1,0] = Piece.new( :black, :knight )<br />        <span class="variable">@board</span>[2,0] = Piece.new( :black, :bishop )<br />        <span class="variable">@board</span>[3,0] = Piece.new( :black, :queen )<br />        <span class="variable">@board</span>[4,0] = Piece.new( :black, :king )<br />        <span class="variable">@board</span>[5,0] = Piece.new( :black, :bishop )<br />        <span class="variable">@board</span>[6,0] = Piece.new( :black, :knight )<br />        <span class="variable">@board</span>[7,0] = Piece.new( :black, :rook )<br /><br />        <span class="variable">@board</span>[0,7] = Piece.new( :white, :rook )<br />        <span class="variable">@board</span>[1,7] = Piece.new( :white, :knight )<br />        <span class="variable">@board</span>[2,7] = Piece.new( :white, :bishop )<br />        <span class="variable">@board</span>[3,7] = Piece.new( :white, :queen )<br />        <span class="variable">@board</span>[4,7] = Piece.new( :white, :king )<br />        <span class="variable">@board</span>[5,7] = Piece.new( :white, :bishop )<br />        <span class="variable">@board</span>[6,7] = Piece.new( :white, :knight )<br />        <span class="variable">@board</span>[7,7] = Piece.new( :white, :rook )<br />      <span class="keyword">end</span><br /><br />      <span class="keyword">def</span> play<br />        <span class="keyword">while</span> (state = <span class="variable">@board</span>.game_state) == :in_game<br />          <span class="keyword">begin</span><br />            move<br />          <span class="keyword">rescue</span> RuntimeError =&gt; err<br />            print <span class="string">"\n"</span><br />            <span class="keyword">if</span> err.message == <span class="string">"no move"</span><br />              say :exiting<br />            <span class="keyword">else</span><br />              say err.message<br />            <span class="keyword">end</span><br />            <span class="keyword">return</span><br />          <span class="keyword">end</span><br />        <span class="keyword">end</span><br />        show_board<br />        say state<br />      <span class="keyword">end</span><br /><br />      <span class="keyword">def</span> move<br />        loop <span class="keyword">do</span><br />          say <span class="string">""</span><br />          show_board<br />          from, to = ask_move<br />          raise <span class="string">"no move"</span> <span class="keyword">unless</span> from<br />          <span class="keyword">if</span> <span class="variable">@board</span>.is_valid(from) <span class="keyword">and</span> <span class="variable">@board</span>.is_valid(to) <span class="keyword">and</span><br />             <span class="variable">@board</span>.legal_move(from, to)<br />            <span class="keyword">if</span> <span class="variable">@board</span>.promotion(from, to)<br />              <span class="variable">@board</span>.promotion_piece = ask_promotion_piece<br />            <span class="keyword">end</span><br />            <span class="variable">@board</span>.move(from, to)<br />            <span class="keyword">break</span><br />          <span class="keyword">else</span><br />            say :invalid_move<br />          <span class="keyword">end</span><br />        <span class="keyword">end</span><br />      <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br />    <span class="variable">@game</span> = ChessGame.new<br />    <span class="variable">@game</span>.play<br /><br /></div></div>
			<p>You can see that Paolo's library also includes a UI module, which this game object makes use of.  The constructor is straight forward, it sets up some initial state information, including a board, and places the pieces in their starting positions.  Notice that the Board object is indexed as a multidimensional array and the pieces can be constructed from just a color and a type.</p>
			<p>The play() method is the game itself.  It's really just a loop looking for an end game condition.  Aside from a little error checking and displaying the final state, it simply calls move() again and again.</p>
			<p>Which brings us to the move() method.  It shows the board (with the help of the UI method show_board()) and then asks for a move (another UI helper).  You can see that the move is validated using the Board object, and then Board.move() is called to advance the game.</p>
			<p>The final two lines kick off the methods we just examined.  All the details are handled by the library itself.</p>
			<p>Here's the same thing using my own library:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="comment">#!/usr/local/bin/ruby -w</span><br /><br />    <span class="comment"># chess</span><br />    <span class="comment">#</span><br />    <span class="comment">#  Created by James Edward Gray II on 2005-06-14.</span><br />    <span class="comment">#  Copyright 2005 Gray Productions. All rights reserved.</span><br /><br />    require <span class="string">"chess"</span><br /><br />    board = Chess::Board.new<br /><br />    puts<br />    puts <span class="string">"Welcome to Ruby Quiz Chess."</span><br /><br />    <span class="comment"># player move loop</span><br />    loop <span class="keyword">do</span><br />        <span class="comment"># show board</span><br />        puts<br />        puts board<br />        puts<br /><br />        <span class="comment"># watch for end conditions</span><br />        <span class="keyword">if</span> board.in_checkmate?<br />            puts <span class="string">"Checkmate!  "</span> +<br />                 <span class="string">"It's #{board.turn == :white ? 'Black' : 'White'}'s game."</span><br />            puts<br />            <span class="keyword">break</span><br />        <span class="keyword">elsif</span> board.in_stalemate?<br />            puts <span class="string">"Stalemate."</span><br />            puts<br />            <span class="keyword">break</span><br />        <span class="keyword">elsif</span> board.in_check?<br />            puts <span class="string">"Check."</span><br />        <span class="keyword">end</span><br /><br />        <span class="comment"># move input loop</span><br />        move = <span class="keyword">nil</span><br />        loop <span class="keyword">do</span><br />            print <span class="string">"#{board.turn.to_s.capitalize}'s Move (from to):  "</span><br />            move = <span class="global">$stdin</span>.gets.chomp<br /><br />            <span class="comment"># validate move</span><br />            moves = board.moves<br />            <span class="keyword">if</span> move !~ <span class="string">/^\s*([a-h][1-8])\s*([a-h][1-8])\s*$/</span><br />                puts <span class="string">"Invalid move format.  Use from to.  (Example:  e2 e4.)"</span><br />            <span class="keyword">elsif</span> board[<span class="global">$1</span>].nil?<br />                puts <span class="string">"No piece on that square."</span><br />            <span class="keyword">elsif</span> board[<span class="global">$1</span>].color != board.turn<br />                puts <span class="string">"That's not your piece to move."</span><br />            <span class="keyword">elsif</span> board.in_check? <span class="keyword">and</span> ( (m = moves.assoc(<span class="global">$1</span>)).nil? <span class="keyword">or</span><br />                                        <span class="keyword">not</span> m.last.include?(<span class="global">$2</span>) )<br />                puts <span class="string">"You must move out of check."</span><br />            <span class="keyword">elsif</span> <span class="keyword">not</span> (board[<span class="global">$1</span>].captures + board[<span class="global">$1</span>].moves).include?(<span class="global">$2</span>)<br />                puts <span class="string">"That piece can't move to that square."</span><br />            <span class="keyword">elsif</span> ((m = moves.assoc(<span class="global">$1</span>)).nil? <span class="keyword">or</span> <span class="keyword">not</span> m.last.include?(<span class="global">$2</span>))<br />                puts <span class="string">"You can't move into check."</span><br />            <span class="keyword">else</span><br />                <span class="keyword">break</span><br />            <span class="keyword">end</span><br />        <span class="keyword">end</span><br /><br />        <span class="comment"># make move, with promotion if needed</span><br />        <span class="keyword">if</span> board[<span class="global">$1</span>].is_a?(Chess::Pawn) <span class="keyword">and</span> <span class="global">$2</span>[1, 1] == <span class="string">"8"</span><br />            from, to = <span class="global">$1</span>, <span class="global">$2</span><br /><br />            print <span class="string">"Promote to (k, b, r, or q)?  "</span><br />            promote = <span class="global">$stdin</span>.gets.chomp<br /><br />            <span class="keyword">case</span> promote.downcase[0, 1]<br />            <span class="keyword">when</span> <span class="string">"k"</span><br />                board.move(<span class="global">$1</span>, <span class="global">$2</span>, Chess::Knight)<br />            <span class="keyword">when</span> <span class="string">"b"</span><br />                board.move(<span class="global">$1</span>, <span class="global">$2</span>, Chess::Bishop)<br />            <span class="keyword">when</span> <span class="string">"r"</span><br />                board.move(<span class="global">$1</span>, <span class="global">$2</span>, Chess::Rook)<br />            <span class="keyword">else</span><br />                board.move(<span class="global">$1</span>, <span class="global">$2</span>, Chess::Queen)<br />            <span class="keyword">end</span><br />        <span class="keyword">else</span><br />            board.move(<span class="global">$1</span>, <span class="global">$2</span>)<br />        <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br /></div></div>
			<p>I pull in my chess library, and create a Chess::Board.  Next, I display a welcome message then launch into my game loop which begins by printing the board.  My Board object defines to_s(), so you can just print it as needed.</p>
			<p>My chess game then checks for game end conditions using helper methods on Board like in_checkmate?() and in_stalemate?().  When found, the code prints messages and breaks out of the game loop.</p>
			<p>The next loop is my move input loop.  It looks like a lot of code but there are two good reasons for that.  One, I wanted good error messages, so I'm checking every little thing that could have gone wrong and printing a custom message for it.  Two, I avoiding using HighLine to simplify the process, so I wouldn't add the dependancy to the library.  So really I'm just reading input and printing error messages here, nothing exciting.</p>
			<p>The final chunk of code checks to see if the requested move is a pawn promotion.  When it is, the user is prompted to choose the new piece type.  Either way, the requested move is passed along to Board.move(), which handles the rest of the game.</p>
			<p>One last example.  Let's look at Gavin Kistner's code:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="keyword">if</span> <span class="global">$0</span> == <span class="keyword">__FILE__</span><br />        include GKChess<br />        require <span class="string">"rubygems"</span><br />        require <span class="string">"highline/import"</span><br />        board = Board.new<br />        <span class="keyword">while</span> !board.game_over?<br />            puts <span class="string">"\n#{board}\n\n"</span><br />            puts <span class="string">"Move ##{board.move_number}, #{board.turn}'s turn"</span><br />            <span class="comment">#puts "(#{@turn} is in check)" if board.king_in_check?( @turn )</span><br /><br />            piece = ask( <span class="string">"\tPiece to move: "</span>,<br />                         lambda { |loc| board[ loc ] } ){ |q|<br />                q.responses[ :not_valid ] = <span class="string">""</span><br />                q.validate = lambda { |loc|<br />                    <span class="keyword">case</span> loc<br />                        <span class="keyword">when</span> <span class="string">/[a-h][1-8]/</span>i<br />                            <span class="keyword">if</span> piece = board[ loc ]<br />                                <span class="keyword">if</span> piece.color == board.turn<br />                                    <span class="keyword">if</span> !piece.possible_moves.empty?<br />                                        <span class="keyword">true</span><br />                                    <span class="keyword">else</span><br />                                        puts <span class="string">"That #{piece.name} has no "</span> +<br />                                             <span class="string">"legal moves available."</span><br />                                        <span class="keyword">false</span><br />                                    <span class="keyword">end</span><br />                                <span class="keyword">else</span><br />                                    puts <span class="string">"The #{piece.name} at #{loc} "</span> +<br />                                         <span class="string">"does not belong to #{board.turn}!"</span><br />                                    <span class="keyword">false</span><br />                                <span class="keyword">end</span><br />                            <span class="keyword">else</span><br />                                puts <span class="string">"There is no piece at #{loc}!"</span><br />                                <span class="keyword">false</span><br />                            <span class="keyword">end</span><br />                        <span class="keyword">else</span><br />                            puts <span class="string">"(Please enter the location such as "</span> +<br />                                 <span class="string">"a8 or c3)"</span><br />                            <span class="keyword">false</span><br />                    <span class="keyword">end</span><br />                }<br />            }<br /><br />            valid_locations = piece.possible_moves.collect{ |move|<br />                move.colrow<br />            }<br /><br />            dest = ask( <span class="string">"\tMove #{piece.name} to: "</span> ){ |q|<br />                q.responses[ :not_valid ] = <span class="string">"The #{piece.name} cannot "</span> +<br />                    <span class="string">"move there. Valid moves: "</span> +<br />                    <span class="string">"#{valid_locations.sort.join(', ')}."</span><br />                q.validate = lambda { |loc|<br />                    valid_locations.include?( loc.downcase )<br />                }<br />            }<br /><br />            board.move( piece.colrow, dest )<br />        <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br /></div></div>
			<p>Gavin start's by pulling in the GKChess namespace and the HighLine library to ease the input fetching process.  The code then creates a Board and loops looking for Board.game_over?().  It prints the board and turn, much like my own code did, then fetches a move from the player.</p>
			<p>Again, this looks like a lot of code, mainly because of the error messages.  The player is asked to select a piece (which HighLine fetches and returns), then the code loads all the valid moves for that piece (using possible_moves()).  Finally, the player is asked to select one of those moves for the piece and Board.move() is called to make it happen.</p>
			<p>As I said, all three solutions were surprisingly similar.</p>
			<p>Now we have to think about how we would adapt these to chess variations.  Obviously, you need to get a little familiar with your library of choice.  Get to know the methods it provides.  Then, you'll probably need to subclass some of the objects and override them with some special behavior.  At that point, you should be able to plug your chess variant objects into something like the above examples.  Of course, any code handles some changes better than others and that's were the real fun comes in.</p>
			<p>I hope you'll consider giving next week's challenge a shot, even if you didn't suffer through this week's torture.  Grab a library and start adapting.  See how it goes.</p>
			<p>I apologize for not estimating this challenge better and presenting it in a more digestible format.  Thanks so much to Gavin Kistner, Jim Menard, and Paolo Capriotti for for trying it anyway!</p>
		</div>
		<div id="logo"><img src="/web/20120120004210im_/http://rubyquiz.com/images/ruby_quiz_logo.jpg" alt="" width="157" height="150" /></div>
		<div id="links">
			<span class="title">Quiz Solutions</span>
			<ol>
				<li><a href="/web/20120120004210/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/145482">Paolo Capriotti</a></li>
				<li><a href="/web/20120120004210/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/145487">Jim Menard</a></li>
				<li><a href="/web/20120120004210/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/145489">Gavin Kistner</a></li>
				<li><a href="/web/20120120004210/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/145512">Paolo Capriotti (2)</a></li>
				<li><a href="/web/20120120004210/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/145516">James Edward Gray II</a></li>
				<li><a href="/web/20120120004210/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/145521">Jim Mernard (2)</a></li>
				<li><a href="/web/20120120004210/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/145590">Devin Mullins</a></li>
			</ol>
			<p><a href="/web/20120120004210/http://rubyquiz.com/quiz35_sols.zip">Download Solutions</a></p>
			<p><a href="/web/20120120004210/http://rubyquiz.com/index.html">Back to Quiz Listing</a></p>
		</div>
		<div id="footer">&nbsp;</div>
	</div>
</body>
</html>





<!--
     FILE ARCHIVED ON 0:42:10 Jan 20, 2012 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 13:09:32 Jun 5, 2013.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
