<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>


<!-- Start Wayback Rewrite JS Include -->
<script type="text/javascript" src="/static/js/jwplayer/jwplayer.js" ></script>
<script type="text/javascript" src="/static/js/video-embed-rewriter.js"></script>
<script type="text/javascript">
function initYTVideo(id)
{
	_wmVideos_.init("/web/", id);
}
</script>
<!-- End Wayback Rewrite JS Include -->

	<title>Ruby Quiz - Regexp.build() (#4)</title>
	<link rel="stylesheet" type="text/css" href="/web/20120121214720cs_/http://rubyquiz.com/quiz.css" />
	<link rel="stylesheet" type="text/css" href="/web/20120121214720cs_/http://rubyquiz.com/print.css" media="print" />
</head><body>
<!-- BEGIN WAYBACK TOOLBAR INSERT -->

<script type="text/javascript" src="/static/js/disclaim-element.js" ></script>
<script type="text/javascript" src="/static/js/graph-calc.js" ></script>
<script type="text/javascript" src="/static/jflot/jquery.min.js" ></script>
<script type="text/javascript">
//<![CDATA[
var firstDate = 820454400000;
var lastDate = 1388534399999;
var wbPrefix = "/web/";
var wbCurrentUrl = "http:\/\/rubyquiz.com\/quiz4.html";

var curYear = -1;
var curMonth = -1;
var yearCount = 18;
var firstYear = 1996;
var imgWidth = 450;
var yearImgWidth = 25;
var monthImgWidth = 2;
var trackerVal = "none";
var displayDay = "21";
var displayMonth = "Jan";
var displayYear = "2012";
var prettyMonths = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

function showTrackers(val) {
	if(val == trackerVal) {
		return;
	}
	if(val == "inline") {
		document.getElementById("displayYearEl").style.color = "#ec008c";
		document.getElementById("displayMonthEl").style.color = "#ec008c";
		document.getElementById("displayDayEl").style.color = "#ec008c";		
	} else {
		document.getElementById("displayYearEl").innerHTML = displayYear;
		document.getElementById("displayYearEl").style.color = "#ff0";
		document.getElementById("displayMonthEl").innerHTML = displayMonth;
		document.getElementById("displayMonthEl").style.color = "#ff0";
		document.getElementById("displayDayEl").innerHTML = displayDay;
		document.getElementById("displayDayEl").style.color = "#ff0";
	}
   document.getElementById("wbMouseTrackYearImg").style.display = val;
   document.getElementById("wbMouseTrackMonthImg").style.display = val;
   trackerVal = val;
}
function getElementX2(obj) {
	var thing = jQuery(obj);
	if((thing == undefined) 
			|| (typeof thing == "undefined") 
			|| (typeof thing.offset == "undefined")) {
		return getElementX(obj);
	}
	return Math.round(thing.offset().left);
}
function trackMouseMove(event,element) {

   var eventX = getEventX(event);
   var elementX = getElementX2(element);
   var xOff = eventX - elementX;
	if(xOff < 0) {
		xOff = 0;
	} else if(xOff > imgWidth) {
		xOff = imgWidth;
	}
   var monthOff = xOff % yearImgWidth;

   var year = Math.floor(xOff / yearImgWidth);
	var yearStart = year * yearImgWidth;
   var monthOfYear = Math.floor(monthOff / monthImgWidth);
   if(monthOfYear > 11) {
       monthOfYear = 11;
   }
   // 1 extra border pixel at the left edge of the year:
   var month = (year * 12) + monthOfYear;
   var day = 1;
	if(monthOff % 2 == 1) {
		day = 15;
	}
	var dateString = 
		zeroPad(year + firstYear) + 
		zeroPad(monthOfYear+1,2) +
		zeroPad(day,2) + "000000";

	var monthString = prettyMonths[monthOfYear];
	document.getElementById("displayYearEl").innerHTML = year + 1996;
	document.getElementById("displayMonthEl").innerHTML = monthString;
	// looks too jarring when it changes..
	//document.getElementById("displayDayEl").innerHTML = zeroPad(day,2);

	var url = wbPrefix + dateString + '/' +  wbCurrentUrl;
	document.getElementById('wm-graph-anchor').href = url;

   //document.getElementById("wmtbURL").value="evX("+eventX+") elX("+elementX+") xO("+xOff+") y("+year+") m("+month+") monthOff("+monthOff+") DS("+dateString+") Moy("+monthOfYear+") ms("+monthString+")";
   if(curYear != year) {
       var yrOff = year * yearImgWidth;
       document.getElementById("wbMouseTrackYearImg").style.left = yrOff + "px";
       curYear = year;
   }
   if(curMonth != month) {
       var mtOff = year + (month * monthImgWidth) + 1;
       document.getElementById("wbMouseTrackMonthImg").style.left = mtOff + "px";
       curMonth = month;
   }
}
//]]>
</script>

<style type="text/css">body{margin-top:0!important;padding-top:0!important;min-width:800px!important;}#wm-ipp a:hover{text-decoration:underline!important;}</style>
<div id="wm-ipp" style="display:none; position:relative;padding:0 5px;min-height:70px;min-width:800px; z-index:9000;">
<div id="wm-ipp-inside" style="position:fixed;padding:0!important;margin:0!important;width:97%;min-width:780px;border:5px solid #000;border-top:none;background-image:url(/static/images/toolbar/wm_tb_bk_trns.png);text-align:center;-moz-box-shadow:1px 1px 3px #333;-webkit-box-shadow:1px 1px 3px #333;box-shadow:1px 1px 3px #333;font-size:11px!important;font-family:'Lucida Grande','Arial',sans-serif!important;">
   <table style="border-collapse:collapse;margin:0;padding:0;width:100%;"><tbody><tr>
   <td style="padding:10px;vertical-align:top;min-width:110px;">
   <a href="/web/" title="Wayback Machine home page" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wayback-toolbar-logo.png" alt="Wayback Machine" width="110" height="39" border="0"/></a>
   </td>
   <td style="padding:0!important;text-align:center;vertical-align:top;width:100%;">

       <table style="border-collapse:collapse;margin:0 auto;padding:0;width:570px;"><tbody><tr>
       <td style="padding:3px 0;" colspan="2">
       <form target="_top" method="get" action="/web/form-submit.jsp" name="wmtb" id="wmtb" style="margin:0!important;padding:0!important;"><input type="text" name="url" id="wmtbURL" value="http://rubyquiz.com/quiz4.html" style="width:400px;font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;" onfocus="javascript:this.focus();this.select();" /><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20120121214720" /><input type="submit" value="Go" style="font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;margin-left:5px;" /><span id="wm_tb_options" style="display:block;"></span></form>
       </td>
       <td style="vertical-align:bottom;padding:5px 0 0 0!important;" rowspan="2">
           <table style="border-collapse:collapse;width:110px;color:#99a;font-family:'Helvetica','Lucida Grande','Arial',sans-serif;"><tbody>
			
           <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
           <tr style="width:110px;height:16px;font-size:10px!important;">
           	<td style="padding-right:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20110723030630/http://rubyquiz.com/quiz4.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="23 Jul 2011"><strong>JUL</strong></a>
		                
               </td>
               <td id="displayMonthEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight:bold;text-transform:uppercase;width:34px;height:15px;padding-top:1px;text-align:center;" title="You are here: 21:47:20 Jan 21, 2012">JAN</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20120502041019/http://rubyquiz.com/quiz4.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="2 May 2012"><strong>MAY</strong></a>
		                
               </td>
           </tr>

           <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
           <tr>
               <td style="padding-right:9px;white-space:nowrap;overflow:visible;text-align:right!important;vertical-align:middle!important;" nowrap="nowrap">
               
		                <a href="/web/20120103142751/http://www.rubyquiz.com/quiz4.html" title="14:27:51 Jan 3, 2012" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0" /></a>
		                
               </td>
               <td id="displayDayEl" style="background:#000;color:#ff0;width:34px;height:24px;padding:2px 0 0 0;text-align:center;font-size:24px;font-weight: bold;" title="You are here: 21:47:20 Jan 21, 2012">21</td>
				<td style="padding-left:9px;white-space:nowrap;overflow:visible;text-align:left!important;vertical-align:middle!important;" nowrap="nowrap">
               
		                <a href="/web/20120122031631/http://rubyquiz.com/quiz4.html" title="3:16:31 Jan 22, 2012" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wm_tb_nxt_on.png" alt="Next capture" width="14" height="16" border="0"/></a>
		                
			    </td>
           </tr>

           <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
           <tr style="width:110px;height:13px;font-size:9px!important;">
				<td style="padding-right:9px;font-size:11px!important;font-weight: bold;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20101127181051/http://rubyquiz.com/quiz4.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="27 Nov 2010"><strong>2010</strong></a>
		                
               </td>
               <td id="displayYearEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight: bold;padding-top:1px;width:34px;height:13px;text-align:center;" title="You are here: 21:47:20 Jan 21, 2012">2012</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight: bold;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20130215053025/http://rubyquiz.com/quiz4.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="15 Feb 2013"><strong>2013</strong></a>
		                
				</td>
           </tr>
           </tbody></table>
       </td>

       </tr>
       <tr>
       <td style="vertical-align:middle;padding:0!important;">
           <a href="/web/20120121214720*/http://rubyquiz.com/quiz4.html" style="color:#33f;font-size:11px;font-weight:bold;background-color:transparent;border:none;" title="See a list of every capture for this URL"><strong>39 captures</strong></a>
           <div style="margin:0!important;padding:0!important;color:#666;font-size:9px;padding-top:2px!important;white-space:nowrap;" title="Timespan for captures of this URL">12 Apr 06 - 15 Feb 13</div>
       </td>
       <td style="padding:0!important;">
       <a style="position:relative; white-space:nowrap; width:450px;height:27px;" href="" id="wm-graph-anchor">
       <div id="wm-ipp-sparkline" style="position:relative; white-space:nowrap; width:450px;height:27px;background-color:#fff;cursor:pointer;border-right:1px solid #ccc;" title="Explore captures for this URL">
			<img id="sparklineImgId" style="position:absolute; z-index:9012; top:0px; left:0px;"
				onmouseover="showTrackers('inline');" 
				onmouseout="showTrackers('none');"
				onmousemove="trackMouseMove(event,this)"
				alt="sparklines"
				width="450"
				height="27"
				border="0"
				src="/web/jsp/graph.jsp?graphdata=450_27_1996:-1:000000000000_1997:-1:000000000000_1998:-1:000000000000_1999:-1:000000000000_2000:-1:000000000000_2001:-1:000000000000_2002:-1:000000000000_2003:-1:000000000000_2004:-1:000000000000_2005:-1:000000000000_2006:-1:000210000100_2007:-1:000100000000_2008:-1:000020000000_2009:-1:000000000000_2010:-1:100000000010_2011:-1:000001100000_2012:0:5000b000a100_2013:-1:010000000000"></img>
			<img id="wbMouseTrackYearImg" 
				style="display:none; position:absolute; z-index:9010;"
				width="25" 
				height="27"
				border="0"
				src="/static/images/toolbar/transp-yellow-pixel.png"></img>
			<img id="wbMouseTrackMonthImg"
				style="display:none; position:absolute; z-index:9011; " 
				width="2"
				height="27" 
				border="0"
				src="/static/images/toolbar/transp-red-pixel.png"></img>
       </div>
		</a>

       </td>
       </tr></tbody></table>
   </td>
   <td style="text-align:right;padding:5px;width:65px;font-size:11px!important;">
       <a href="javascript:;" onclick="document.getElementById('wm-ipp').style.display='none';" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_close.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;margin-bottom:23px;background-color:transparent;border:none;" title="Close the toolbar">Close</a>
       <a href="http://faq.web.archive.org/" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_help.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;background-color:transparent;border:none;" title="Get some help using the Wayback Machine">Help</a>
   </td>
   </tr></tbody></table>

</div>
</div>
<script type="text/javascript">
 var wmDisclaimBanner = document.getElementById("wm-ipp");
 if(wmDisclaimBanner != null) {
   disclaimElement(wmDisclaimBanner);
 }
</script>
<!-- END WAYBACK TOOLBAR INSERT -->

	<div id="page">
		<div id="header"><span class="ruby">Ruby</span> <span class="quiz">Quiz</span></div>
		<div id="content">
			<span class="title">Regexp.build() (#4)</span>
			<p>There's been some discussion on Ruby Talk lately about Range.member? which tests if a given element (often a number) is a member of the set the Range object iterates over.  Obviously, this kind of test is useful in many aspects of programming, but let's approach this problem from a different angle.</p>
			<p>This week's quiz is to build a library that adds a class method called build() to Regexp.  build() should accept a variable number of arguments which can include integers and ranges of integers.  Have build() return a Regexp object that will match only integers in the set of passed arguments.</p>
			<p>Here are some examples of possible usage:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    lucky = Regexp.build( 3, 7 )<br />    <span class="string">"7"</span>    =~ lucky    <span class="comment"># =&gt; true</span><br />    <span class="string">"13"</span>   =~ lucky    <span class="comment"># =&gt; false</span><br />    <span class="string">"3"</span>    =~ lucky    <span class="comment"># =&gt; true</span><br /><br />    month = Regexp.build( 1..12 )<br />    <span class="string">"0"</span>    =~ month    <span class="comment"># =&gt; false</span><br />    <span class="string">"1"</span>    =~ month    <span class="comment"># =&gt; true</span><br />    <span class="string">"12"</span>   =~ month    <span class="comment"># =&gt; true</span><br />    day = Regexp.build( 1..31 )<br />    <span class="string">"6"</span>    =~ day      <span class="comment"># =&gt; true</span><br />    <span class="string">"16"</span>   =~ day      <span class="comment"># =&gt; true</span><br />    <span class="string">"Tues"</span> =~ day      <span class="comment"># =&gt; false</span><br />    year = Regexp.build( 98, 99, 2000..2005 )<br />    <span class="string">"04"</span>   =~ year     <span class="comment"># =&gt; false</span><br />    <span class="string">"2004"</span> =~ year     <span class="comment"># =&gt; true</span><br />    <span class="string">"99"</span>   =~ year     <span class="comment"># =&gt; true</span><br /><br />    num = Regexp.build( 0..1_000_000 )<br />    <span class="string">"-1"</span>   =~ num      <span class="comment"># =&gt; false</span><br /><br /></div></div>
			<p>Some issues you may want to consider while building you're library:</p>
			<p>* How should leading zeros be handled?</p>
			<p class="example">Match the hour from a clock formatted in military time (0 to 23).  Hours 0<br />through 9 may or may not have a single leading zero.</p>
			<p>* Should anything be captured by the returned Regexp?</p>
			<p>* How should anchoring work?</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="string">"2004"</span> =~ Regexp.build( 4 )    <span class="comment"># =&gt; ???</span><br /></div></div>
			<hr />
			<p><span class="title">Quiz Summary</span></p>
			<p>The first thing to consider in this quiz is what does a Regexp to match a number look like?  Here's the most basic answer to match 1..12:</p>
			<p class="example">1|2|3|4|5|6|7|8|9|10|11|12</p>
			<p>Note:  You might want to reverse the order of that, unless you can count on your anchoring to match the right thing.</p>
			<p>Obviously, the above works and is dirt simple to implement.  Here's a submitted solution by Tanaka Akira that does pretty much that:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="keyword">def</span> Regexp.build(*args)<br />        args = args.map {|arg| Array(arg) }.flatten.uniq.sort<br />        neg, pos = args.partition {|arg| arg &lt; 0 }<br />        <span class="string">/ \A (?: -0*#{Regexp.union(*neg.map {|arg| (-arg).to_s })} |<br />                 0*#{Regexp.union(*pos.map {|arg| arg.to_s })} ) \z /x</span><br />    <span class="keyword">end</span><br /><br /></div></div>
			<p>The first line of that method is pretty clever, calling Array() on all the passed arguments.  That turns Range objects into the Array equivalent and wraps simple Integers in an Array of their own.  Following that up with flatten() yields a single Array of all the elements we're trying to match.</p>
			<p>The second line just separates the arguments into positive and negative groups.</p>
			<p>Finally the third line builds a Regexp object from the created groups using the nifty Regexp.union() that I wasn't even aware of when I made this quiz.</p>
			<p>(This solution handles negative numbers and allows for arbitrary leading zeros.)</p>
			<p>Is this quiz really this easy to solve?  Obviously it can be, for simple data sets.  However, Tanaka's solution has limits.  On my box, it only takes:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    Regexp.build(1..10_000)<br /><br /></div></div>
			<p>to get a "...regular expression too big..." error.  Clearly, if your data set is big you'll need to dig a little deeper.</p>
			<p>That get's us back to our original question, but now with a qualification:  What is a short way to match a number with a Regexp?  The most obvious optimization to apply to our patterns is the use of character classes.  Going back to our 1..12 example that might give us something like:</p>
			<p class="example">\d|1[0-2]</p>
			<p>That's getting a lot more reasonable.  Going to a serious example, even 1..1_000_000 is only:</p>
			<p class="example">[1-9]|[1-9]\d|[1-9]\d\d|[1-9]\d\d\d|[1-9]\d\d\d\d|[1-9]\d\d\d\d\d|1000000</p>
			<p>Technically, we could keep going and get to something like:</p>
			<p class="example">[1-9]\d{0,5}|1000000</p>
			<p>But that's a little trickier to build algorithmically and none of the submitted solutions went quite that far.</p>
			<p>The character class approach, on the other hand, was very popular.</p>
			<p>The main trick to building character classes is to break down the passed Range objects.  You could also lump in the individual Integer arguments, but these are pretty insignificant.  Several solutions solved this by adding a method to the Range class to convert them into Regexps.</p>
			<p>Adding a Regexp.build() over that is trivial.  Here's a nice example from Mark Hubbart's second submission:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="keyword">def</span> Regexp.build(*args)<br />      ranges, numbers = args.partition{|item| Range === item}<br />      re = ranges.map{|r| r.to_re } + numbers.map{|n| <span class="string">/0*#{n}/</span> }<br />      <span class="string">/^#{Regexp.union(*re)}$/</span><br />    <span class="keyword">end</span><br /><br /><br />    <span class="keyword">class</span> Range<br />      <span class="keyword">def</span> to_re<br />        <span class="comment"># normalize the range format; we want end inclusive,</span><br />        <span class="comment"># integer ranges this part passes the load off to a</span><br />        <span class="comment"># newly built range if needed.</span><br />        <span class="keyword">if</span> exclude_end?<br />          <span class="keyword">return</span>( (first.to_i..last.to_i - 1).to_re )<br />        <span class="keyword">elsif</span> ! (first + last).kind_of?(Integer)<br />          <span class="keyword">return</span>( (first.to_i .. last.to_i).to_re )<br />        <span class="keyword">end</span><br /><br />        <span class="comment"># Deal with ranges that are wholly or partially negative.</span><br />        <span class="comment"># If range is only partially negative, split in half and</span><br />        <span class="comment"># get two regexen. join them together for the finish.</span><br />        <span class="comment"># If the range is wholly negative, make it positive, then</span><br />        <span class="comment"># add a negative sign to the regexp</span><br />        <span class="keyword">if</span> first &lt; 0 <span class="keyword">and</span> last &lt; 0<br />          <span class="comment"># return a negatized version of the regexp</span><br />          <span class="keyword">return</span> <span class="string">/-#{(-last..-first).to_re}/</span><br />        <span class="keyword">elsif</span> first &lt; 0<br />          neg = (first..-1).to_re<br />          pos = (0..last).to_re<br />          <span class="keyword">return</span> <span class="string">/(?:#{neg}|#{pos})/</span><br />        <span class="keyword">end</span><br /><br />        <span class="comment">### First, create an array of new ranges that are more</span><br />        <span class="comment">### suited to regex conversion.</span><br /><br />        <span class="comment"># a and z will be the remainders of the endpoints</span><br />        <span class="comment"># of the range as we slice it</span><br />        a, z = first, last<br /><br />        <span class="comment"># build the first part of the list of new ranges.</span><br />        list1 = []<br />        num = first<br />        <span class="keyword">until</span> num &gt; z<br />          a = num <span class="comment"># recycle the value</span><br />          <span class="comment"># get the first power of ten that leaves a remainder</span><br />          v = 10<br />          v *= 10 <span class="keyword">while</span> num % v == 0 <span class="keyword">and</span> num != 0<br />          <span class="comment"># compute the next value up</span><br />          num += v - num % v<br />          <span class="comment"># store the value unless it's too high</span><br />          list1 &lt;&lt; (a..num-1) <span class="keyword">unless</span> num &gt; z<br />        <span class="keyword">end</span><br /><br />        <span class="comment"># build the second part of the list; counting down.</span><br />        list2 = []<br />        num = last + 1<br />        <span class="keyword">until</span> num &lt; a<br />          z = num - 1 <span class="comment"># recycle the value</span><br />          <span class="comment"># slice to the nearest power of ten</span><br />          v = 10<br />          v *= 10 <span class="keyword">while</span> num % v == 0 <span class="keyword">and</span> num != 0<br />          <span class="comment"># compute the next value down</span><br />          num -= num % v<br />          <span class="comment"># store the value if it fits</span><br />          list2 &lt;&lt; (num..z) <span class="keyword">unless</span> num &lt; a<br />        <span class="keyword">end</span><br />        <span class="comment"># get the chewey center part, if needed</span><br />        center = a &lt; z ? [a..z] : []<br />        <span class="comment"># our new list</span><br />        list = list1 + center + list2.reverse<br /><br />        <span class="comment">### Next, convert each range to a regexp.</span><br />        list.map! <span class="keyword">do</span> |rng|<br />          a, z = rng.first.to_s, rng.last.to_s<br />          a.split(<span class="string">//</span>).zip(z.split(<span class="string">//</span>)).map <span class="keyword">do</span> |(f,l)|<br />            <span class="keyword">case</span><br />              <span class="keyword">when</span> f == l <span class="keyword">then</span> f<br />              <span class="keyword">when</span> f.to_i + 1 == l.to_i <span class="keyword">then</span> <span class="string">"[%s%s]"</span> % [f,l]<br />              <span class="keyword">when</span> f+l == <span class="string">"09"</span> <span class="keyword">then</span> <span class="string">"\\d"</span><br />              <span class="keyword">else</span><br />                <span class="string">"[%s-%s]"</span> % [f,l]<br />            <span class="keyword">end</span><br />          <span class="keyword">end</span>.join <span class="comment"># returns the regexp for *that* range</span><br />        <span class="keyword">end</span><br /><br />        <span class="comment">### Last, return the final regexp</span><br />        <span class="string">/0*#{ list.join("|") }/</span><br />      <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br /></div></div>
			<p>The first third of the to_re() method just deals with normalizing Ranges and is very well commented.</p>
			<p>The middle third divides the Range into Regexp friendly chunks which are groups that share the same number of digits.  For example, here is what to_re() builds into the local "list" variable for 1..1_000:</p>
			<p class="example">1..9<br />10..99<br />100..999<br />1000..1000</p>
			<p>The final third of to_re() builds character classes from these grouped Ranges.  The code inside "list.map! do ... end" is pretty clever and I recommend working through it until you can follow how it works.</p>
			<p>A big part of using these solutions is a question of how long you'll have to wait for a Regexp object to be built and how quickly the result can find a match.  Here are some benchmarks, first for build times:</p>
			<p class="example">                               user     system      total        real<br />James Edward Gray II       63.490000   0.020000  63.510000 ( 63.512904)<br />James Edward Gray II (2)   20.270000   0.000000  20.270000 ( 20.307565)<br />Jamis Buck                 0.490000   0.000000   0.490000 (  0.488664)<br />Mark Hubbart               0.290000   0.010000   0.300000 (  0.297225)<br />Mark Hubbart (2)           0.030000   0.000000   0.030000 (  0.028206)<br />Tanaka Akira               0.440000   0.000000   0.440000 (  0.442430)<br />Thomas Leitner             0.020000   0.000000   0.020000 (  0.013544)<br />Warren Brown               0.020000   0.000000   0.020000 (  0.015618)</p>
			<p>Or focusing in on the faster solutions over a bigger test:</p>
			<p class="example">                       user     system      total        real<br />Mark Hubbart (2)   3.390000   0.000000   3.390000 (  3.415515)<br />Thomas Leitner     2.120000   0.000000   2.120000 (  2.138968)<br />Warren Brown       2.290000   0.000000   2.290000 (  2.280555)</p>
			<p>As you can see, Thomas Leitner and Warren Brown's solutions are also worth a look, if you haven't checked them out already.  Warren's even has a clever feature to tell you which parameter of build() caused a match.</p>
			<p>And here are some matching benchmarks (build times excluded from results):</p>
			<p class="example">                               user     system      total        real<br />James Edward Gray II       0.070000   0.000000   0.070000 (  0.079497)<br />James Edward Gray II (2)   0.100000   0.000000   0.100000 (  0.115083)<br />Jamis Buck                 5.480000   0.000000   5.480000 (  5.502583)<br />Mark Hubbart               4.590000   0.000000   4.590000 (  4.617739)<br />Mark Hubbart (2)           0.100000   0.010000   0.110000 (  0.124735)<br />Tanaka Akira               4.570000   0.010000   4.580000 (  4.741717)<br />Thomas Leitner             0.100000   0.000000   0.100000 (  0.121431)<br />Warren Brown               0.130000   0.000000   0.130000 (  0.123779)</p>
			<p>As usual, my thanks go out to all who participated as well as to those who just silently followed the discussion.</p>
			<p>I've been unexpectedly called out of town this weekend, so we'll take a break from Ruby Quiz.  Sink all the effort you intended to give next week's quiz into filling my inbox with quiz suggestions.  ;)</p>
			<p>I'll send out a new quiz on the 29th that's all fun and games...</p>
		</div>
		<div id="logo"><img src="/web/20120121214720im_/http://rubyquiz.com/images/ruby_quiz_logo.jpg" alt="" width="157" height="150" /></div>
		<div id="links">
			<span class="title">Quiz Solutions</span>
			<ol>
				<li><a href="/web/20120121214720/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/116906">Jamis Buck</a></li>
				<li><a href="/web/20120121214720/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/116919">James Edward Gray II</a></li>
				<li><a href="/web/20120121214720/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/116923">Tanaka Akira</a></li>
				<li><a href="/web/20120121214720/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/116928">Mark Hubbart</a></li>
				<li><a href="/web/20120121214720/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/116940">Mark Hubbart (2)</a></li>
				<li><a href="/web/20120121214720/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/116967">Warren Brown</a></li>
				<li><a href="/web/20120121214720/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/116978">James Edward Gray II (2)</a></li>
				<li><a href="/web/20120121214720/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/117079">Thomas Leitner</a></li>
			</ol>
			<p><a href="/web/20120121214720/http://rubyquiz.com/quiz4_sols.zip">Download Solutions</a></p>
			<p><a href="/web/20120121214720/http://rubyquiz.com/index.html">Back to Quiz Listing</a></p>
		</div>
		<div id="footer">&nbsp;</div>
	</div>
</body>
</html>





<!--
     FILE ARCHIVED ON 21:47:20 Jan 21, 2012 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 13:09:01 Jun 5, 2013.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
