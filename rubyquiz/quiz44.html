<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>


<!-- Start Wayback Rewrite JS Include -->
<script type="text/javascript" src="/static/js/jwplayer/jwplayer.js" ></script>
<script type="text/javascript" src="/static/js/video-embed-rewriter.js"></script>
<script type="text/javascript">
function initYTVideo(id)
{
	_wmVideos_.init("/web/", id);
}
</script>
<!-- End Wayback Rewrite JS Include -->

	<title>Ruby Quiz - Word Chains (#44)</title>
	<link rel="stylesheet" type="text/css" href="/web/20120121221612cs_/http://rubyquiz.com/quiz.css" />
	<link rel="stylesheet" type="text/css" href="/web/20120121221612cs_/http://rubyquiz.com/print.css" media="print" />
</head><body>
<!-- BEGIN WAYBACK TOOLBAR INSERT -->

<script type="text/javascript" src="/static/js/disclaim-element.js" ></script>
<script type="text/javascript" src="/static/js/graph-calc.js" ></script>
<script type="text/javascript" src="/static/jflot/jquery.min.js" ></script>
<script type="text/javascript">
//<![CDATA[
var firstDate = 820454400000;
var lastDate = 1388534399999;
var wbPrefix = "/web/";
var wbCurrentUrl = "http:\/\/rubyquiz.com\/quiz44.html";

var curYear = -1;
var curMonth = -1;
var yearCount = 18;
var firstYear = 1996;
var imgWidth = 450;
var yearImgWidth = 25;
var monthImgWidth = 2;
var trackerVal = "none";
var displayDay = "21";
var displayMonth = "Jan";
var displayYear = "2012";
var prettyMonths = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

function showTrackers(val) {
	if(val == trackerVal) {
		return;
	}
	if(val == "inline") {
		document.getElementById("displayYearEl").style.color = "#ec008c";
		document.getElementById("displayMonthEl").style.color = "#ec008c";
		document.getElementById("displayDayEl").style.color = "#ec008c";		
	} else {
		document.getElementById("displayYearEl").innerHTML = displayYear;
		document.getElementById("displayYearEl").style.color = "#ff0";
		document.getElementById("displayMonthEl").innerHTML = displayMonth;
		document.getElementById("displayMonthEl").style.color = "#ff0";
		document.getElementById("displayDayEl").innerHTML = displayDay;
		document.getElementById("displayDayEl").style.color = "#ff0";
	}
   document.getElementById("wbMouseTrackYearImg").style.display = val;
   document.getElementById("wbMouseTrackMonthImg").style.display = val;
   trackerVal = val;
}
function getElementX2(obj) {
	var thing = jQuery(obj);
	if((thing == undefined) 
			|| (typeof thing == "undefined") 
			|| (typeof thing.offset == "undefined")) {
		return getElementX(obj);
	}
	return Math.round(thing.offset().left);
}
function trackMouseMove(event,element) {

   var eventX = getEventX(event);
   var elementX = getElementX2(element);
   var xOff = eventX - elementX;
	if(xOff < 0) {
		xOff = 0;
	} else if(xOff > imgWidth) {
		xOff = imgWidth;
	}
   var monthOff = xOff % yearImgWidth;

   var year = Math.floor(xOff / yearImgWidth);
	var yearStart = year * yearImgWidth;
   var monthOfYear = Math.floor(monthOff / monthImgWidth);
   if(monthOfYear > 11) {
       monthOfYear = 11;
   }
   // 1 extra border pixel at the left edge of the year:
   var month = (year * 12) + monthOfYear;
   var day = 1;
	if(monthOff % 2 == 1) {
		day = 15;
	}
	var dateString = 
		zeroPad(year + firstYear) + 
		zeroPad(monthOfYear+1,2) +
		zeroPad(day,2) + "000000";

	var monthString = prettyMonths[monthOfYear];
	document.getElementById("displayYearEl").innerHTML = year + 1996;
	document.getElementById("displayMonthEl").innerHTML = monthString;
	// looks too jarring when it changes..
	//document.getElementById("displayDayEl").innerHTML = zeroPad(day,2);

	var url = wbPrefix + dateString + '/' +  wbCurrentUrl;
	document.getElementById('wm-graph-anchor').href = url;

   //document.getElementById("wmtbURL").value="evX("+eventX+") elX("+elementX+") xO("+xOff+") y("+year+") m("+month+") monthOff("+monthOff+") DS("+dateString+") Moy("+monthOfYear+") ms("+monthString+")";
   if(curYear != year) {
       var yrOff = year * yearImgWidth;
       document.getElementById("wbMouseTrackYearImg").style.left = yrOff + "px";
       curYear = year;
   }
   if(curMonth != month) {
       var mtOff = year + (month * monthImgWidth) + 1;
       document.getElementById("wbMouseTrackMonthImg").style.left = mtOff + "px";
       curMonth = month;
   }
}
//]]>
</script>

<style type="text/css">body{margin-top:0!important;padding-top:0!important;min-width:800px!important;}#wm-ipp a:hover{text-decoration:underline!important;}</style>
<div id="wm-ipp" style="display:none; position:relative;padding:0 5px;min-height:70px;min-width:800px; z-index:9000;">
<div id="wm-ipp-inside" style="position:fixed;padding:0!important;margin:0!important;width:97%;min-width:780px;border:5px solid #000;border-top:none;background-image:url(/static/images/toolbar/wm_tb_bk_trns.png);text-align:center;-moz-box-shadow:1px 1px 3px #333;-webkit-box-shadow:1px 1px 3px #333;box-shadow:1px 1px 3px #333;font-size:11px!important;font-family:'Lucida Grande','Arial',sans-serif!important;">
   <table style="border-collapse:collapse;margin:0;padding:0;width:100%;"><tbody><tr>
   <td style="padding:10px;vertical-align:top;min-width:110px;">
   <a href="/web/" title="Wayback Machine home page" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wayback-toolbar-logo.png" alt="Wayback Machine" width="110" height="39" border="0"/></a>
   </td>
   <td style="padding:0!important;text-align:center;vertical-align:top;width:100%;">

       <table style="border-collapse:collapse;margin:0 auto;padding:0;width:570px;"><tbody><tr>
       <td style="padding:3px 0;" colspan="2">
       <form target="_top" method="get" action="/web/form-submit.jsp" name="wmtb" id="wmtb" style="margin:0!important;padding:0!important;"><input type="text" name="url" id="wmtbURL" value="http://rubyquiz.com/quiz44.html" style="width:400px;font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;" onfocus="javascript:this.focus();this.select();" /><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20120121221612" /><input type="submit" value="Go" style="font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;margin-left:5px;" /><span id="wm_tb_options" style="display:block;"></span></form>
       </td>
       <td style="vertical-align:bottom;padding:5px 0 0 0!important;" rowspan="2">
           <table style="border-collapse:collapse;width:110px;color:#99a;font-family:'Helvetica','Lucida Grande','Arial',sans-serif;"><tbody>
			
           <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
           <tr style="width:110px;height:16px;font-size:10px!important;">
           	<td style="padding-right:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20101127173653/http://rubyquiz.com/quiz44.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="27 Nov 2010"><strong>NOV</strong></a>
		                
               </td>
               <td id="displayMonthEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight:bold;text-transform:uppercase;width:34px;height:15px;padding-top:1px;text-align:center;" title="You are here: 22:16:12 Jan 21, 2012">JAN</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20120418110425/http://www.rubyquiz.com/quiz44.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="18 Apr 2012"><strong>APR</strong></a>
		                
               </td>
           </tr>

           <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
           <tr>
               <td style="padding-right:9px;white-space:nowrap;overflow:visible;text-align:right!important;vertical-align:middle!important;" nowrap="nowrap">
               
		                <a href="/web/20120103144050/http://www.rubyquiz.com/quiz44.html" title="14:40:50 Jan 3, 2012" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0" /></a>
		                
               </td>
               <td id="displayDayEl" style="background:#000;color:#ff0;width:34px;height:24px;padding:2px 0 0 0;text-align:center;font-size:24px;font-weight: bold;" title="You are here: 22:16:12 Jan 21, 2012">21</td>
				<td style="padding-left:9px;white-space:nowrap;overflow:visible;text-align:left!important;vertical-align:middle!important;" nowrap="nowrap">
               
		                <a href="/web/20120122034953/http://rubyquiz.com/quiz44.html" title="3:49:53 Jan 22, 2012" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wm_tb_nxt_on.png" alt="Next capture" width="14" height="16" border="0"/></a>
		                
			    </td>
           </tr>

           <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
           <tr style="width:110px;height:13px;font-size:9px!important;">
				<td style="padding-right:9px;font-size:11px!important;font-weight: bold;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20101127173653/http://rubyquiz.com/quiz44.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="27 Nov 2010"><strong>2010</strong></a>
		                
               </td>
               <td id="displayYearEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight: bold;padding-top:1px;width:34px;height:13px;text-align:center;" title="You are here: 22:16:12 Jan 21, 2012">2012</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight: bold;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20130215052516/http://rubyquiz.com/quiz44.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="15 Feb 2013"><strong>2013</strong></a>
		                
				</td>
           </tr>
           </tbody></table>
       </td>

       </tr>
       <tr>
       <td style="vertical-align:middle;padding:0!important;">
           <a href="/web/20120121221612*/http://rubyquiz.com/quiz44.html" style="color:#33f;font-size:11px;font-weight:bold;background-color:transparent;border:none;" title="See a list of every capture for this URL"><strong>28 captures</strong></a>
           <div style="margin:0!important;padding:0!important;color:#666;font-size:9px;padding-top:2px!important;white-space:nowrap;" title="Timespan for captures of this URL">13 Apr 06 - 15 Feb 13</div>
       </td>
       <td style="padding:0!important;">
       <a style="position:relative; white-space:nowrap; width:450px;height:27px;" href="" id="wm-graph-anchor">
       <div id="wm-ipp-sparkline" style="position:relative; white-space:nowrap; width:450px;height:27px;background-color:#fff;cursor:pointer;border-right:1px solid #ccc;" title="Explore captures for this URL">
			<img id="sparklineImgId" style="position:absolute; z-index:9012; top:0px; left:0px;"
				onmouseover="showTrackers('inline');" 
				onmouseout="showTrackers('none');"
				onmousemove="trackMouseMove(event,this)"
				alt="sparklines"
				width="450"
				height="27"
				border="0"
				src="/web/jsp/graph.jsp?graphdata=450_27_1996:-1:000000000000_1997:-1:000000000000_1998:-1:000000000000_1999:-1:000000000000_2000:-1:000000000000_2001:-1:000000000000_2002:-1:000000000000_2003:-1:000000000000_2004:-1:000000000000_2005:-1:000000000000_2006:-1:000210000100_2007:-1:000000100000_2008:-1:000010000000_2009:-1:000000000000_2010:-1:000000000010_2011:-1:000000000000_2012:0:40014000a100_2013:-1:010000000000"></img>
			<img id="wbMouseTrackYearImg" 
				style="display:none; position:absolute; z-index:9010;"
				width="25" 
				height="27"
				border="0"
				src="/static/images/toolbar/transp-yellow-pixel.png"></img>
			<img id="wbMouseTrackMonthImg"
				style="display:none; position:absolute; z-index:9011; " 
				width="2"
				height="27" 
				border="0"
				src="/static/images/toolbar/transp-red-pixel.png"></img>
       </div>
		</a>

       </td>
       </tr></tbody></table>
   </td>
   <td style="text-align:right;padding:5px;width:65px;font-size:11px!important;">
       <a href="javascript:;" onclick="document.getElementById('wm-ipp').style.display='none';" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_close.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;margin-bottom:23px;background-color:transparent;border:none;" title="Close the toolbar">Close</a>
       <a href="http://faq.web.archive.org/" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_help.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;background-color:transparent;border:none;" title="Get some help using the Wayback Machine">Help</a>
   </td>
   </tr></tbody></table>

</div>
</div>
<script type="text/javascript">
 var wmDisclaimBanner = document.getElementById("wm-ipp");
 if(wmDisclaimBanner != null) {
   disclaimElement(wmDisclaimBanner);
 }
</script>
<!-- END WAYBACK TOOLBAR INSERT -->

	<div id="page">
		<div id="header"><span class="ruby">Ruby</span> <span class="quiz">Quiz</span></div>
		<div id="content">
			<span class="title">Word Chains (#44)</span>
			<p>Our own Dave Thomas has also posted some Ruby code challenges on his blog in the past.  There are several interesting problems there:</p>
			<p><a href="/web/20120121221612/http://codekata.org/">CodeKata</a></p>
			<p>This week's Ruby Quiz is one of my favorite problems posted by Dave.</p>
			<p>Given two words of equal length as command-line arguments, build a chain of words connecting the first to the second.  Each word in the chain must be in the dictionary and every step along the chain changes exactly one letter from the previous word.</p>
			<p>Again, your program should accept input as two command-line arguments.  Your program should also allow a -d command-line switch followed by a dictionary file to use, but feel free to choose a sensible default for your system.  The result should be a word chain starting with the first word and ending with the last printed to STDOUT, one word per line.  Print an error message if a chain cannot be found.</p>
			<p>Bonus points for finding the shortest chain and/or a small execution time.</p>
			<p>Here's an example:</p>
			<p class="example">$ time ruby -d word_chain.rb duck ruby<br />Loading dictionary...<br />Building chain...<br />duck<br />ruck<br />rusk<br />ruse<br />rube<br />ruby<br /><br />real    0m27.551s<br />user    0m27.402s<br />sys     0m0.113s</p>
			<hr />
			<p><span class="title">Quiz Summary</span></p>
			<p>Gavin Kistner asked that I try timing the quiz solutions this week.  I did try, but ran into some difficulties I didn't have time to short out.  Below are the results I got for some of the submissions.  (Simon Kr&ouml;ger later worked up <a href="/web/20120121221612/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/154705">a complete set of time trials</a>.)</p>
			<p class="example">=== Timing ./Brian Schroeder/wordchain.rb ===<br />Loading database<br />Searching connection between duck and ruby<br />duck<br />dusk<br />rusk<br />ruse<br />rube<br />ruby<br /><br />=== ./Brian Schroeder/wordchain.rb:  3.722559 seconds ===<br /><br />=== Timing ./Dominik Bathon/word_chain.rb ===<br />duck<br />luck<br />luce<br />lube<br />rube<br />ruby<br />=== ./Dominik Bathon/word_chain.rb:  1.472335 seconds ===<br /><br />=== Timing ./James Edward Gray II/word_chain.rb ===<br />duck<br />ruck<br />rusk<br />ruse<br />rube<br />ruby<br />=== ./James Edward Gray II/word_chain.rb:  27.577392 seconds ===<br /><br />=== Timing ./Levin Alexander/word_chains.rb ===<br />duck<br />ruck<br />rusk<br />ruse<br />rube<br />ruby<br />=== ./Levin Alexander/word_chains.rb:  2.795315 seconds ===<br /><br />=== Timing ./Will Thimbleby/word_chain.rb ===<br />duck<br />dunk<br />dune<br />rune<br />rube<br />ruby<br />=== ./Will Thimbleby/word_chain.rb:  63.026336 seconds ===</p>
			<p>I actually expected Brian's to be the fastest, just from what I had read about them as they came in.  Under the hood, Brian is using a priority queue written in C.  As the saying goes though, the speed is in the algorithm, and Dominik and Levin prove the truth of it.</p>
			<p>For an interesting comparison, Levin is using a plain Ruby priority queue.  Let's take a look at that class:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="comment"># inefficient implementation of a priority queue</span><br />    <span class="comment">#</span><br />    <span class="keyword">class</span> SimpleQueue<br />      <span class="keyword">def</span> initialize<br />        <span class="variable">@storage</span> = Hash.new { [] }<br />      <span class="keyword">end</span><br />      <span class="keyword">def</span> insert(priority, data)<br />        <span class="variable">@storage</span>[priority] = <span class="variable">@storage</span>[priority] &lt;&lt; data<br />      <span class="keyword">end</span><br />      <span class="keyword">def</span> extract_min<br />        <span class="keyword">return</span> <span class="keyword">nil</span> <span class="keyword">if</span> <span class="variable">@storage</span>.empty?<br />        key, val = *<span class="variable">@storage</span>.min<br />        result = val.shift<br />        <span class="variable">@storage</span>.delete(key) <span class="keyword">if</span> val.empty?<br />        <span class="keyword">return</span> result<br />      <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br /></div></div>
			<p>If you look at that insert() method, you might find the calls a bit odd.  The code does work, but only because of the awkward assignment that shouldn't be needed.  This is a gotcha that bit me early in learning Ruby so I'll explain it here in the hope of helping others.</p>
			<p>Array.new() can take a number and a block.  It will invoke the block the indicated number of times to generate an Array, using the return value of the block as each member.</p>
			<p>Because Hash.new() also takes a block and will call it when a key is first accessed without an assignment, the natural assumption is that it uses the return value, and in truth it does, but it does not set the key to that value!  That's why the extra assignment is needed above.</p>
			<p>The fix is to use the passed in Hash and key String objects to set it yourself.  Using that, we can write the above a little more naturally:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="comment"># inefficient implementation of a priority queue</span><br />    <span class="comment">#</span><br />    <span class="keyword">class</span> SimpleQueue<br />      <span class="keyword">def</span> initialize<br />        <span class="variable">@storage</span> = Hash.new { |hash, key| hash[key] = [] }<br />      <span class="keyword">end</span><br />      <span class="keyword">def</span> insert(priority, data)<br />        <span class="variable">@storage</span>[priority] &lt;&lt; data<br />      <span class="keyword">end</span><br />      <span class="keyword">def</span> extract_min<br />        <span class="keyword">return</span> <span class="keyword">nil</span> <span class="keyword">if</span> <span class="variable">@storage</span>.empty?<br />        key, val = *<span class="variable">@storage</span>.min<br />        result = val.shift<br />        <span class="variable">@storage</span>.delete(key) <span class="keyword">if</span> val.empty?<br />        <span class="keyword">return</span> result<br />      <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br /></div></div>
			<p>I just think that's more natural and easy to follow.  They work the same.</p>
			<p>Looking at the code itself, there's nothing too fancy here.  It stores items by priority in a Hash.  The real work is done in extract_min() which just locates the minimum value, shifts some data off of that Array, and returns it.  The comment warns that it's inefficient, but it sure is easy to setup and use.  Hard to beat that for just fifteen lines of code.  Nice work Levin.</p>
			<p>Now I want to examine Dominik's lightning fast solution.  Here's how it starts:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    DEFAULT_DICTIONARY = <span class="string">"/usr/share/dict/words"</span><br /><br />    <span class="comment"># Data structure that efficiently stores words from a dictionary in a way,</span><br />    <span class="comment"># that it is easy to find all words that differ from a given word only at</span><br />    <span class="comment"># one letter (words that could be the next step in a word chain).</span><br />    <span class="comment"># Example: when adding the word "dog", add_word will register "dog" as</span><br />    <span class="comment"># step for "\0og", "d\0g" and "do\0", later each_possible_step("cat")</span><br />    <span class="comment"># will yield all words registered for "\0at", "c\0t" or "ca\0".</span><br />    <span class="keyword">class</span> WordSteps<br />        <span class="keyword">def</span> initialize<br />            <span class="variable">@steps</span> = Hash.new { |h, k| h[k] = [] }<br />            <span class="variable">@words</span> = {}<br />        <span class="keyword">end</span><br /><br />        <span class="comment"># yields all words (as strings) that were added with add_word</span><br />        <span class="keyword">def</span> each_word(&amp;block)<br />            <span class="variable">@words</span>.each_key(&amp;block)<br />        <span class="keyword">end</span><br /><br />        <span class="comment"># add all steps for word (a string) to the steps</span><br />        <span class="keyword">def</span> add_word(word)<br />            sym = word.to_sym<br />            wdup = word.dup<br />            <span class="keyword">for</span> i <span class="keyword">in</span> 0...word.length<br />                wdup[i] = 0<br />                <span class="variable">@steps</span>[wdup] &lt;&lt; sym<br />                wdup[i] = word[i]<br />            <span class="keyword">end</span><br />            <span class="variable">@words</span>[word] = sym <span class="comment"># for allow_shorter and each_word</span><br />        <span class="keyword">end</span><br /><br />        <span class="comment"># yields each possible next step for word (a string) as symbol, some</span><br />        <span class="comment"># possible steps might be yielded multiple times</span><br />        <span class="comment"># if allow_shorter is true, word[0..-2].to_sym will also be yielded</span><br />        <span class="comment"># if available</span><br />        <span class="comment"># if allow_longer is true, all words that match /#{word}./ will be</span><br />        <span class="comment"># yielded</span><br />        <span class="keyword">def</span> each_possible_step(word, allow_shorter = <span class="keyword">false</span>,<br />                                     allow_longer = <span class="keyword">false</span>)<br />            wdup = word.dup<br />            <span class="keyword">for</span> i <span class="keyword">in</span> 0...word.length<br />                wdup[i] = 0<br />                <span class="keyword">if</span> <span class="variable">@steps</span>.has_key?(wdup)<br />                    <span class="variable">@steps</span>[wdup].each { |step| <span class="keyword">yield</span> step }<br />                <span class="keyword">end</span><br />                wdup[i] = word[i]<br />            <span class="keyword">end</span><br />            <span class="keyword">if</span> allow_shorter &amp;&amp; <span class="variable">@words</span>.has_key?(tmp = word[0..-2])<br />                <span class="keyword">yield</span> <span class="variable">@words</span>[tmp]<br />            <span class="keyword">end</span><br />            <span class="keyword">if</span> allow_longer &amp;&amp; <span class="variable">@steps</span>.has_key?(tmp = word + <span class="string">"\0"</span>)<br />                <span class="variable">@steps</span>[tmp].each { |step| <span class="keyword">yield</span> step }<br />            <span class="keyword">end</span><br />        <span class="keyword">end</span><br /><br />        <span class="comment"># ...</span><br /><br /></div></div>
			<p>The comments are just great in this code.  If you read them, you'll understand how the code moves so darn fast.  Here's the mini-summary:  When called add_word() maps a word to all possible variations with exactly one letter changed to a null character.  Later, each_possible_step() can use the same mapping to quickly look up all possibilities for the current word in question.</p>
			<p>This can also handle searches where words aren't the same size, though that wasn't part of the quiz.</p>
			<div class="code"><span class="type">ruby</span><div class="body">        <span class="comment"># ...</span><br /><br />        <span class="comment"># tries to find a word chain between word1 and word2 (strings) using</span><br />        <span class="comment"># all available steps</span><br />        <span class="comment"># returns the chain as array of symbols or nil, if no chain is found</span><br />        <span class="comment"># shorter/longer determines if shorter or longer words are allowed in</span><br />        <span class="comment"># the chain</span><br />        <span class="keyword">def</span> build_word_chain(word1, word2, shorter = <span class="keyword">false</span>, longer = <span class="keyword">false</span>)<br />            <span class="comment"># build chain with simple breadth first search</span><br />            current = [word1.to_sym]<br />            pre = { current[0] =&gt; <span class="keyword">nil</span> } <span class="comment"># will contain the predecessors</span><br />            target = word2.to_sym<br />            catch(:done) <span class="keyword">do</span><br />                <span class="keyword">until</span> current.empty?<br />                    next_step = []<br />                    current.each <span class="keyword">do</span> |csym|<br />                        each_possible_step(csym.to_s, shorter, longer) <span class="keyword">do</span> |ssym|<br />                            <span class="comment"># have we seen this word before?</span><br />                            <span class="keyword">unless</span> pre.has_key? ssym<br />                                pre[ssym] = csym<br />                                throw(:done) <span class="keyword">if</span> ssym == target<br />                                next_step &lt;&lt; ssym<br />                            <span class="keyword">end</span><br />                        <span class="keyword">end</span><br />                    <span class="keyword">end</span><br />                    current = next_step<br />                <span class="keyword">end</span><br />                <span class="keyword">return</span> <span class="keyword">nil</span> <span class="comment"># no chain found</span><br />            <span class="keyword">end</span><br />            <span class="comment"># build the chain (in reverse order)</span><br />            chain = [target]<br />            chain &lt;&lt; target <span class="keyword">while</span> target = pre[target]<br />            chain.reverse<br />        <span class="keyword">end</span><br /><br />        <span class="comment"># ...</span><br /><br /></div></div>
			<p>This is the search for a chain.  Believe it or not, it's a rather boring unidirectional breadth-first search.  Most people implemented much fancier searches, but thanks to Domink's dictionary storage this code doesn't need to be clever.</p>
			<p>This code just uses each_possible_step() to walk level-by-level of like words, until it finds the end word.  The pre Hash is used to keep the code from retracing its steps and to walk the previous word chain to build the final answer at the bottom of the method.</p>
			<p>This method has a nice use of catch() and throw() to create the equivalent of a labeled goto call in many other languages.</p>
			<p>There's one more piece to this class:</p>
			<div class="code"><span class="type">ruby</span><div class="body">        <span class="comment"># ...</span><br /><br />        <span class="comment"># builds and returns a WordSteps instance "containing" all words with</span><br />        <span class="comment"># length in length_range from the file file_name</span><br />        <span class="keyword">def</span> <span class="keyword">self</span>.load_from_file(file_name, length_range)<br />            word_steps = new<br />            IO.foreach(file_name) <span class="keyword">do</span> |line|<br />                <span class="comment"># only load words with correct length</span><br />                <span class="keyword">if</span> length_range === (word = line.strip).length<br />                    word_steps.add_word(word.downcase)<br />                <span class="keyword">end</span><br />            <span class="keyword">end</span><br />            word_steps<br />        <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br />    <span class="comment"># ...</span><br /><br /></div></div>
			<p>Here's the simple dictionary reading method.  Note the clever use of a Range argument here, to support word chains of differing sizes.  The === check ensures that the current dictionary word is in the Range we care about, before it's added to the memory mappings.</p>
			<p>Finally, here's the interface code:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="comment"># ...</span><br /><br />    <span class="keyword">if</span> <span class="global">$0</span> == <span class="keyword">__FILE__</span><br />        dictionary = DEFAULT_DICTIONARY<br /><br />        <span class="comment"># parse arguments</span><br />        <span class="keyword">if</span> ARGV[0] == <span class="string">"-d"</span><br />            ARGV.shift<br />            dictionary = ARGV.shift<br />        <span class="keyword">end</span><br />        <span class="keyword">unless</span> ARGV.size == 2<br />            puts <span class="string">"usage: #$0 [-d path/to/dictionary] word1 word2"</span><br />            exit 1<br />        <span class="keyword">end</span><br />        word1, word2 = ARGV[0].strip.downcase, ARGV[1].strip.downcase<br /><br />        shorter = word1.length &gt; word2.length<br />        longer = word1.length &lt; word2.length<br />        length_range = <span class="keyword">if</span> longer<br />            word1.length..word2.length<br />        <span class="keyword">else</span><br />            word2.length..word1.length<br />        <span class="keyword">end</span><br /><br />        <span class="comment"># read dictionary</span><br />        warn <span class="string">"Loading dictionary..."</span> <span class="keyword">if</span> <span class="global">$DEBUG</span><br />        word_steps = WordSteps.load_from_file(dictionary, length_range)<br />        word_steps.add_word(word2) <span class="comment"># if it is not in dictionary</span><br /><br />        <span class="comment"># build chain</span><br />        warn <span class="string">"Building chain..."</span> <span class="keyword">if</span> <span class="global">$DEBUG</span><br />        chain = word_steps.build_word_chain(word1, word2, shorter, longer)<br /><br />        <span class="comment"># print result</span><br />        puts chain || <span class="string">"No chain found!"</span><br />    <span class="keyword">end</span><br /><br /></div></div>
			<p>Most of that is just the code to support the arguments from the quiz.  Note the clever building of the length Range that allows the program to switch behavior when different sized words are given.  All around great code Domink.  Thanks for the lesson!</p>
			<p>My thanks to all who were able to understand my command-line argument instructions this week.  ;)  Seriously, thanks to all submitters.  Many great solutions this week.</p>
			<p>If you don't know what tomorrow's quiz is yet, you're not reading Redhanded closely enough...</p>
		</div>
		<div id="logo"><img src="/web/20120121221612im_/http://rubyquiz.com/images/ruby_quiz_logo.jpg" alt="" width="157" height="150" /></div>
		<div id="links">
			<span class="title">Quiz Solutions</span>
			<ol>
				<li><a href="/web/20120121221612/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/153900">Max Rabenmann</a></li>
				<li><a href="/web/20120121221612/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/153901">James Edward Gray II</a></li>
				<li><a href="/web/20120121221612/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/153916">Gavin Kistner</a></li>
				<li><a href="/web/20120121221612/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/153921">Levin Alexander</a></li>
				<li><a href="/web/20120121221612/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/153929">Jannis Harder</a></li>
				<li><a href="/web/20120121221612/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/153946">Gavin Kistner (2)</a></li>
				<li><a href="/web/20120121221612/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/153956">Simon Kr&ouml;ger</a></li>
				<li><a href="/web/20120121221612/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/153960">Dominik Bathon</a></li>
				<li><a href="/web/20120121221612/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/153973">horndude77</a></li>
				<li><a href="/web/20120121221612/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/154022">Adam Shelly</a></li>
				<li><a href="/web/20120121221612/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/154039">Will Thimbleby</a></li>
				<li><a href="/web/20120121221612/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/154152">David Tran</a></li>
				<li><a href="/web/20120121221612/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/154175">Brian Schr&ouml;der</a></li>
				<li><a href="/web/20120121221612/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/154221">Daniel Sheppard</a></li>
				<li><a href="/web/20120121221612/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/154227">Paolo Capriotti</a></li>
				<li><a href="/web/20120121221612/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/154229">Brian Schr&ouml;der (2)</a></li>
				<li><a href="/web/20120121221612/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/154239">William James</a></li>
				<li><a href="/web/20120121221612/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/154346">Simon Kr&ouml;ger (2)</a></li>
				<li><a href="/web/20120121221612/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/154381">William James (2)</a></li>
				<li><a href="/web/20120121221612/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/154400">William James (3)</a></li>
			</ol>
			<p><a href="/web/20120121221612/http://rubyquiz.com/quiz44_sols.zip">Download Solutions</a></p>
			<p><a href="/web/20120121221612/http://rubyquiz.com/index.html">Back to Quiz Listing</a></p>
		</div>
		<div id="footer">&nbsp;</div>
	</div>
</body>
</html>





<!--
     FILE ARCHIVED ON 22:16:12 Jan 21, 2012 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 13:09:42 Jun 5, 2013.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
