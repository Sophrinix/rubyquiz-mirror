<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>


<!-- Start Wayback Rewrite JS Include -->
<script type="text/javascript" src="/static/js/jwplayer/jwplayer.js" ></script>
<script type="text/javascript" src="/static/js/video-embed-rewriter.js"></script>
<script type="text/javascript">
function initYTVideo(id)
{
	_wmVideos_.init("/web/", id);
}
</script>
<!-- End Wayback Rewrite JS Include -->

	<title>Ruby Quiz - Splitting the Loot (#65)</title>
	<link rel="stylesheet" type="text/css" href="/web/20120120003547cs_/http://rubyquiz.com/quiz.css" />
	<link rel="stylesheet" type="text/css" href="/web/20120120003547cs_/http://rubyquiz.com/print.css" media="print" />
</head><body>
<!-- BEGIN WAYBACK TOOLBAR INSERT -->

<script type="text/javascript" src="/static/js/disclaim-element.js" ></script>
<script type="text/javascript" src="/static/js/graph-calc.js" ></script>
<script type="text/javascript" src="/static/jflot/jquery.min.js" ></script>
<script type="text/javascript">
//<![CDATA[
var firstDate = 820454400000;
var lastDate = 1388534399999;
var wbPrefix = "/web/";
var wbCurrentUrl = "http:\/\/rubyquiz.com\/quiz65.html";

var curYear = -1;
var curMonth = -1;
var yearCount = 18;
var firstYear = 1996;
var imgWidth = 450;
var yearImgWidth = 25;
var monthImgWidth = 2;
var trackerVal = "none";
var displayDay = "20";
var displayMonth = "Jan";
var displayYear = "2012";
var prettyMonths = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

function showTrackers(val) {
	if(val == trackerVal) {
		return;
	}
	if(val == "inline") {
		document.getElementById("displayYearEl").style.color = "#ec008c";
		document.getElementById("displayMonthEl").style.color = "#ec008c";
		document.getElementById("displayDayEl").style.color = "#ec008c";		
	} else {
		document.getElementById("displayYearEl").innerHTML = displayYear;
		document.getElementById("displayYearEl").style.color = "#ff0";
		document.getElementById("displayMonthEl").innerHTML = displayMonth;
		document.getElementById("displayMonthEl").style.color = "#ff0";
		document.getElementById("displayDayEl").innerHTML = displayDay;
		document.getElementById("displayDayEl").style.color = "#ff0";
	}
   document.getElementById("wbMouseTrackYearImg").style.display = val;
   document.getElementById("wbMouseTrackMonthImg").style.display = val;
   trackerVal = val;
}
function getElementX2(obj) {
	var thing = jQuery(obj);
	if((thing == undefined) 
			|| (typeof thing == "undefined") 
			|| (typeof thing.offset == "undefined")) {
		return getElementX(obj);
	}
	return Math.round(thing.offset().left);
}
function trackMouseMove(event,element) {

   var eventX = getEventX(event);
   var elementX = getElementX2(element);
   var xOff = eventX - elementX;
	if(xOff < 0) {
		xOff = 0;
	} else if(xOff > imgWidth) {
		xOff = imgWidth;
	}
   var monthOff = xOff % yearImgWidth;

   var year = Math.floor(xOff / yearImgWidth);
	var yearStart = year * yearImgWidth;
   var monthOfYear = Math.floor(monthOff / monthImgWidth);
   if(monthOfYear > 11) {
       monthOfYear = 11;
   }
   // 1 extra border pixel at the left edge of the year:
   var month = (year * 12) + monthOfYear;
   var day = 1;
	if(monthOff % 2 == 1) {
		day = 15;
	}
	var dateString = 
		zeroPad(year + firstYear) + 
		zeroPad(monthOfYear+1,2) +
		zeroPad(day,2) + "000000";

	var monthString = prettyMonths[monthOfYear];
	document.getElementById("displayYearEl").innerHTML = year + 1996;
	document.getElementById("displayMonthEl").innerHTML = monthString;
	// looks too jarring when it changes..
	//document.getElementById("displayDayEl").innerHTML = zeroPad(day,2);

	var url = wbPrefix + dateString + '/' +  wbCurrentUrl;
	document.getElementById('wm-graph-anchor').href = url;

   //document.getElementById("wmtbURL").value="evX("+eventX+") elX("+elementX+") xO("+xOff+") y("+year+") m("+month+") monthOff("+monthOff+") DS("+dateString+") Moy("+monthOfYear+") ms("+monthString+")";
   if(curYear != year) {
       var yrOff = year * yearImgWidth;
       document.getElementById("wbMouseTrackYearImg").style.left = yrOff + "px";
       curYear = year;
   }
   if(curMonth != month) {
       var mtOff = year + (month * monthImgWidth) + 1;
       document.getElementById("wbMouseTrackMonthImg").style.left = mtOff + "px";
       curMonth = month;
   }
}
//]]>
</script>

<style type="text/css">body{margin-top:0!important;padding-top:0!important;min-width:800px!important;}#wm-ipp a:hover{text-decoration:underline!important;}</style>
<div id="wm-ipp" style="display:none; position:relative;padding:0 5px;min-height:70px;min-width:800px; z-index:9000;">
<div id="wm-ipp-inside" style="position:fixed;padding:0!important;margin:0!important;width:97%;min-width:780px;border:5px solid #000;border-top:none;background-image:url(/static/images/toolbar/wm_tb_bk_trns.png);text-align:center;-moz-box-shadow:1px 1px 3px #333;-webkit-box-shadow:1px 1px 3px #333;box-shadow:1px 1px 3px #333;font-size:11px!important;font-family:'Lucida Grande','Arial',sans-serif!important;">
   <table style="border-collapse:collapse;margin:0;padding:0;width:100%;"><tbody><tr>
   <td style="padding:10px;vertical-align:top;min-width:110px;">
   <a href="/web/" title="Wayback Machine home page" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wayback-toolbar-logo.png" alt="Wayback Machine" width="110" height="39" border="0"/></a>
   </td>
   <td style="padding:0!important;text-align:center;vertical-align:top;width:100%;">

       <table style="border-collapse:collapse;margin:0 auto;padding:0;width:570px;"><tbody><tr>
       <td style="padding:3px 0;" colspan="2">
       <form target="_top" method="get" action="/web/form-submit.jsp" name="wmtb" id="wmtb" style="margin:0!important;padding:0!important;"><input type="text" name="url" id="wmtbURL" value="http://rubyquiz.com/quiz65.html" style="width:400px;font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;" onfocus="javascript:this.focus();this.select();" /><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20120120003547" /><input type="submit" value="Go" style="font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;margin-left:5px;" /><span id="wm_tb_options" style="display:block;"></span></form>
       </td>
       <td style="vertical-align:bottom;padding:5px 0 0 0!important;" rowspan="2">
           <table style="border-collapse:collapse;width:110px;color:#99a;font-family:'Helvetica','Lucida Grande','Arial',sans-serif;"><tbody>
			
           <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
           <tr style="width:110px;height:16px;font-size:10px!important;">
           	<td style="padding-right:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20101127172211/http://rubyquiz.com/quiz65.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="27 Nov 2010"><strong>NOV</strong></a>
		                
               </td>
               <td id="displayMonthEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight:bold;text-transform:uppercase;width:34px;height:15px;padding-top:1px;text-align:center;" title="You are here: 0:35:47 Jan 20, 2012">JAN</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20120418101303/http://www.rubyquiz.com/quiz65.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="18 Apr 2012"><strong>APR</strong></a>
		                
               </td>
           </tr>

           <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
           <tr>
               <td style="padding-right:9px;white-space:nowrap;overflow:visible;text-align:right!important;vertical-align:middle!important;" nowrap="nowrap">
               
		                <a href="/web/20101127172211/http://rubyquiz.com/quiz65.html" title="17:22:11 Nov 27, 2010" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0" /></a>
		                
               </td>
               <td id="displayDayEl" style="background:#000;color:#ff0;width:34px;height:24px;padding:2px 0 0 0;text-align:center;font-size:24px;font-weight: bold;" title="You are here: 0:35:47 Jan 20, 2012">20</td>
				<td style="padding-left:9px;white-space:nowrap;overflow:visible;text-align:left!important;vertical-align:middle!important;" nowrap="nowrap">
               
		                <a href="/web/20120418101303/http://www.rubyquiz.com/quiz65.html" title="10:13:03 Apr 18, 2012" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wm_tb_nxt_on.png" alt="Next capture" width="14" height="16" border="0"/></a>
		                
			    </td>
           </tr>

           <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
           <tr style="width:110px;height:13px;font-size:9px!important;">
				<td style="padding-right:9px;font-size:11px!important;font-weight: bold;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20101127172211/http://rubyquiz.com/quiz65.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="27 Nov 2010"><strong>2010</strong></a>
		                
               </td>
               <td id="displayYearEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight: bold;padding-top:1px;width:34px;height:13px;text-align:center;" title="You are here: 0:35:47 Jan 20, 2012">2012</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight: bold;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20130215052500/http://rubyquiz.com/quiz65.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="15 Feb 2013"><strong>2013</strong></a>
		                
				</td>
           </tr>
           </tbody></table>
       </td>

       </tr>
       <tr>
       <td style="vertical-align:middle;padding:0!important;">
           <a href="/web/20120120003547*/http://rubyquiz.com/quiz65.html" style="color:#33f;font-size:11px;font-weight:bold;background-color:transparent;border:none;" title="See a list of every capture for this URL"><strong>32 captures</strong></a>
           <div style="margin:0!important;padding:0!important;color:#666;font-size:9px;padding-top:2px!important;white-space:nowrap;" title="Timespan for captures of this URL">12 Apr 06 - 15 Feb 13</div>
       </td>
       <td style="padding:0!important;">
       <a style="position:relative; white-space:nowrap; width:450px;height:27px;" href="" id="wm-graph-anchor">
       <div id="wm-ipp-sparkline" style="position:relative; white-space:nowrap; width:450px;height:27px;background-color:#fff;cursor:pointer;border-right:1px solid #ccc;" title="Explore captures for this URL">
			<img id="sparklineImgId" style="position:absolute; z-index:9012; top:0px; left:0px;"
				onmouseover="showTrackers('inline');" 
				onmouseout="showTrackers('none');"
				onmousemove="trackMouseMove(event,this)"
				alt="sparklines"
				width="450"
				height="27"
				border="0"
				src="/web/jsp/graph.jsp?graphdata=450_27_1996:-1:000000000000_1997:-1:000000000000_1998:-1:000000000000_1999:-1:000000000000_2000:-1:000000000000_2001:-1:000000000000_2002:-1:000000000000_2003:-1:000000000000_2004:-1:000000000000_2005:-1:000000000000_2006:-1:000210000100_2007:-1:000101100000_2008:-1:000010000000_2009:-1:000000000000_2010:-1:100000000010_2011:-1:000000000000_2012:0:10018000a100_2013:-1:010000000000"></img>
			<img id="wbMouseTrackYearImg" 
				style="display:none; position:absolute; z-index:9010;"
				width="25" 
				height="27"
				border="0"
				src="/static/images/toolbar/transp-yellow-pixel.png"></img>
			<img id="wbMouseTrackMonthImg"
				style="display:none; position:absolute; z-index:9011; " 
				width="2"
				height="27" 
				border="0"
				src="/static/images/toolbar/transp-red-pixel.png"></img>
       </div>
		</a>

       </td>
       </tr></tbody></table>
   </td>
   <td style="text-align:right;padding:5px;width:65px;font-size:11px!important;">
       <a href="javascript:;" onclick="document.getElementById('wm-ipp').style.display='none';" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_close.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;margin-bottom:23px;background-color:transparent;border:none;" title="Close the toolbar">Close</a>
       <a href="http://faq.web.archive.org/" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_help.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;background-color:transparent;border:none;" title="Get some help using the Wayback Machine">Help</a>
   </td>
   </tr></tbody></table>

</div>
</div>
<script type="text/javascript">
 var wmDisclaimBanner = document.getElementById("wm-ipp");
 if(wmDisclaimBanner != null) {
   disclaimElement(wmDisclaimBanner);
 }
</script>
<!-- END WAYBACK TOOLBAR INSERT -->

	<div id="page">
		<div id="header"><span class="ruby">Ruby</span> <span class="quiz">Quiz</span></div>
		<div id="content">
			<span class="title">Splitting the Loot (#65)</span>
			<p>You, and your trusty band of adventurers, have stumbled upon a hidden cache of rubies!  (What luck, eh?)  Not all gems are created equal, so you sneak them home and take your time evaluating the stones.  The find was an equal effort, and you're all horribly greedy, so you must find a fair system for dividing up the gems.</p>
			<p>This week's Ruby Quiz is to write a program that fairly divides treasures, based on worth.</p>
			<p>The first command-line argument to the program will be the number of adventures.  All other arguments are the numerical values of treasures found.  You're program should output a fair split of the treasures, if possible, or a warning message if a fair split cannot be found.</p>
			<p>Examples:</p>
			<p class="example">$ ruby loot.rb 3 1 2 3 4<br />It is not possible to fairly split this treasure 3 ways.<br />$ ruby loot.rb 2 9 12 14 17 23 32 34 40 42 49<br />1:  9 12 32 34 49<br />2:  14 17 23 40 42</p>
			<hr />
			<p><span class="title">Quiz Summary</span></p>
			<p>There was some debate on the list about which NP-complete problem this actually is.  I personally thought it was a variant of the partitioning problem when I put it together, but others made good cases for similar problems.  In the end, two things are important:  it's difficult and tricky to get right.  :)</p>
			<p>Some people thought you could work with the treasures largest to smallest to save time.  A few edge cases were pointed out for this approach though.  The easiest example to understand being this one posted by Avi Bryant:</p>
			<p class="example">$ ruby loot.rb 3 3 3 3 2 2 2 2 2 2 2 2 2<br />1: 3 2 2 2<br />2: 3 2 2 2<br />3: 3 2 2 2</p>
			<p>Here we are looking for totals of nine.  If we work only with the big values, we will find 3 3 3 as an option, but then it is impossible to break the remaining even numbers into totals of nine.  For this reason, you must consider all of the possibilities.</p>
			<p>Manuel Kasten posted many of the edge cases that solutions had trouble with, in addition to the first solution that seems to be able to find them all.  Let's look at that code now, from the bottom up:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="comment"># ...</span><br /><br />    <span class="keyword">if</span> <span class="global">$0</span> == <span class="keyword">__FILE__</span><br />      pirates = ARGV.shift.to_i<br />      treasure = ARGV.map{ |gem| gem.to_i }.sort<br />      si = SplitIt.new(pirates, treasure)<br />      si.go<br />      si.done<br />    <span class="keyword">end</span><br /><br /></div></div>
			<p>That's the first bit of code run when Manuel's program is launched.  We can see that it reads and converts arguments, builds some SplitIt object with them, and finally calls SplitIt#go and SplitIt#done.</p>
			<p>Time to dig into SplitIt:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="keyword">class</span> SplitIt<br />      <span class="keyword">def</span> initialize pirates, treasure<br />        <span class="variable">@pirates</span> = pirates<br />        <span class="variable">@treasure</span> = treasure<br />        <span class="variable">@bags</span> = []<br />        (0...<span class="variable">@pirates</span>).each{ |pirate| <span class="variable">@bags</span>[pirate] = [[], 0] }<br />        loot = <span class="variable">@treasure</span>.inject(0){ |res, gem| res + gem }<br />        done <span class="keyword">unless</span> loot % <span class="variable">@pirates</span> == 0<br />        <span class="variable">@share</span> = loot/<span class="variable">@pirates</span><br />      <span class="keyword">end</span><br /><br />      <span class="comment"># ...</span><br /><br /></div></div>
			<p>The only remotely tricky thing in here is the creation of @bags.  Each pirate is given a two-element Array.  The first element is another Array, which will be filled with the gems placed in their share.  The second element is just the total of their share thus far.</p>
			<p>Also note that this method may immediately force a call to SplitIt#done, if the treasure does not evenly divide.  Let's skip down to done now:</p>
			<div class="code"><span class="type">ruby</span><div class="body">      <span class="comment"># ...</span><br /><br />      <span class="keyword">def</span> done<br />        puts<br />        <span class="keyword">if</span> (<span class="variable">@treasure</span>.length == 0)<br />          <span class="variable">@bags</span>.each_with_index <span class="keyword">do</span> |bag, pirate|<br />            puts <span class="string">"#{pirate+1}: #{bag[0].sort.inspect}"</span><br />          <span class="keyword">end</span><br />        <span class="keyword">else</span><br />          puts <span class="string">"The #{@pirates} pirates won't be able to "</span> +<br />               <span class="string">"split their loot fairly. Take cover!"</span><br />        <span class="keyword">end</span><br />        exit<br />      <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br /></div></div>
			<p>This method just shows the final results.  If all the treasure is gone, we split it up correctly and the shares are printed.  Otherwise, we give the error message.  Either way Kernel#exit is called, because we're all finished.</p>
			<p>That leaves only one method to examine:</p>
			<div class="code"><span class="type">ruby</span><div class="body">      <span class="comment"># ...</span><br /><br />      <span class="keyword">def</span> go<br />        done <span class="keyword">if</span> <span class="variable">@treasure</span>.length == 0<br />        gem = <span class="variable">@treasure</span>.pop<br />        (0...<span class="variable">@pirates</span>).each <span class="keyword">do</span> |pirate|<br />          <span class="keyword">if</span> <span class="variable">@bags</span>[pirate][1] + gem &lt;= <span class="variable">@share</span><br />            <span class="variable">@bags</span>[pirate][1] += gem<br />            <span class="variable">@bags</span>[pirate][0].push gem<br />            go<br />            <span class="variable">@bags</span>[pirate][0].pop<br />            <span class="variable">@bags</span>[pirate][1] -= gem<br />            <span class="comment"># it doesn't matter which pirate is which,</span><br />            <span class="comment"># as long as their bags are empty</span><br />            <span class="keyword">break</span> <span class="keyword">if</span> <span class="variable">@bags</span>[pirate][1] == 0<br />          <span class="keyword">end</span><br />        <span class="keyword">end</span><br />        <span class="variable">@treasure</span>.push gem<br />      <span class="keyword">end</span><br /><br />      <span class="comment"># ...</span><br /><br /></div></div>
			<p>This method does all the work, with a brute-force recursive search.  A gem is pulled off the pile here and tried in each pirate's bag.  After it is placed in a bag, the method recurses to try the remaining treasures.</p>
			<p>If a recursive call returns, there was no split found (because SplitIt#done would have been called if there was).  Since that is the case, the treasure is pulled back out of the bags and replaced on the pile.</p>
			<p>The break line is just a minor optimization.  If a treasure didn't work in one pirate's empty bag, it won't work in any of the empty bags following his and we can skip those checks.</p>
			<p>Since that is an exhaustive search, it will find a correct split eventually, as long as one exists.  Let's look at another variation of the same technique, this time by Simon Kroeger:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    require <span class="string">'set'</span><br /><br />    <span class="keyword">def</span> choose_bags nr, bags, choice = Set[]<br />      <span class="keyword">return</span> [] <span class="keyword">if</span> choice.size == nr<br />      bags.each_with_index <span class="keyword">do</span> |b, i|<br />        c = (choice &amp; b).empty? &amp;&amp; choose_bags(nr, bags, choice | b)<br />        <span class="keyword">return</span> [i] + c <span class="keyword">if</span> c<br />      <span class="keyword">end</span> &amp;&amp; <span class="keyword">nil</span><br />    <span class="keyword">end</span><br /><br />    <span class="keyword">def</span> split_loot  nr, *treasures<br />      each = (sum = treasures.sort!.reverse!.inject{|s, t| s + t}) / nr<br />      <span class="keyword">return</span> <span class="keyword">nil</span> <span class="keyword">if</span> (sum % nr).nonzero?<br /><br />      piles = Hash.new([]).merge!({0 =&gt; [[]]})<br />      treasures.each_with_index <span class="keyword">do</span> |t, i|<br />        piles.dup.each <span class="keyword">do</span> |k, v|<br />          <span class="keyword">if</span> k + t &lt;= each &amp;&amp; k + sum &gt;= each<br />            v.each{|a| piles[k + t] += [a + [i]]}<br />          <span class="keyword">end</span><br />        <span class="keyword">end</span><br />        sum -= t<br />      <span class="keyword">end</span><br />      <span class="keyword">return</span> <span class="keyword">nil</span> <span class="keyword">if</span> piles[each].empty?<br />      <span class="keyword">return</span> <span class="keyword">nil</span> <span class="keyword">if</span> !bags = choose_bags(treasures.size, piles[each])<br /><br />      piles[each].values_at(*bags).map{|b| b.map{|t| treasures[t]}}<br />    <span class="keyword">end</span><br /><br />    loot = split_loot(*ARGV.map{|p| p.to_i})<br />    puts(loot ? loot.map{|a| a.join(<span class="string">' '</span>)} : <span class="string">'impossible!'</span>)<br /><br /></div></div>
			<p>Here again, we see the treasures are converted from the command-line arguments and this time they are sent to #split_loot.  The first line of #split_loot sums the treasures, and places the share total needed in a variable called each.  The second line just cancels the search if the total sum is not easily divided.</p>
			<p>The next bit of Hash manipulation is the magic here.  Each treasure is pulled off the pile and combined with all other totals as long as the resulting total will be less than or equal to the share goal and it will leave us enough treasures to reach that goal.</p>
			<p>How they are stored in the Hash is interesting.  The keys are sums of shares found thus far.  The values for those sums are an Array of the shares that can make that sum (another Array).  The individual items in the shares are indexes into the treasure pile, instead of the treasures themselves.  For example, if I feed Simon's program the problem 2 3 2 1, the piles Hash ends up as:</p>
			<p class="example">{ 0 =&gt; [ []          ],<br />  2 =&gt; [ [1]         ],<br />  3 =&gt; [ [0], [1, 2] ] }</p>
			<p>The 0 empty set split is what the code primes the Hash with, so it has something to add to.  The other two are totals it calculated.  Higher totals weren't figured because they aren't needed.  And remember 0, 1, and 2 inside those sets refer to indexes of treasures.</p>
			<p>I want to mention one more gotcha in this code, before we move on.  Note that the default Hash object is set to an Array.  Usually you want to avoid doing that without the block form of Hash#new, because you will get the same Array each time.  However, whenever this code calls it up, it is to add it to another Array, which returns a third Array (the combined results) that actually gets stored in the Hash.</p>
			<p>The rest of #split_loot makes sure a solution is still possible, tries to divide it out with a call to #choose_bags, and finally translates all those treasure indexes back to actual gems.  (Note that Simon's use of these unique indexes, saved him the trouble of pulling non-unique elements from an Array one-at-a-time that was a discussion topic spawned by this problem.)</p>
			<p>That leaves the only mystery as #choose_bags.  Here's another look at that code:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    require <span class="string">'set'</span><br /><br />    <span class="keyword">def</span> choose_bags nr, bags, choice = Set[]<br />      <span class="keyword">return</span> [] <span class="keyword">if</span> choice.size == nr<br />      bags.each_with_index <span class="keyword">do</span> |b, i|<br />        c = (choice &amp; b).empty? &amp;&amp; choose_bags(nr, bags, choice | b)<br />        <span class="keyword">return</span> [i] + c <span class="keyword">if</span> c<br />      <span class="keyword">end</span> &amp;&amp; <span class="keyword">nil</span><br />    <span class="keyword">end</span><br /><br />    <span class="comment"># ...</span><br /><br /></div></div>
			<p>This method obviously uses the Set library to do its work.  Here each bag is tried one by one and checked that it doesn't contain any already-used elements.  That check is accomplished with a set intersection (&amp;) test.  If clear, the method recurses to find the other bags, after performing a set union (|) with the selected bag and all bags chosen thus far.</p>
			<p>When the first line of the method informs us that we have used all of the treasures, we can start passing the results back up the callstack.  The result set starts as an empty Array, but each level adds in the bag used, again by index of the bag.  If we take one more peek at the final line of #split_loot, we will see that those bag indexes are resolved with a call to Array#values_at, just before the results are returned:</p>
			<div class="code"><span class="type">ruby</span><div class="body">      <span class="comment"># ...</span><br /><br />      piles[each].values_at(*bags).map{|b| b.map{|t| treasures[t]}}<br />    <span class="keyword">end</span><br /><br />    <span class="comment"># ...</span><br /><br /></div></div>
			<p>Finally, one last trick is worth mentioning in #choose_bags.  There is a funny ... &amp;&amp; nil on the last line.  The reason is that Enumerable#each_with_index always returns a true value, but this method needs a false result if a bag could not be added.  You can get that by &amp;&amp;ing any true value with nil, or Simon could have just returned a nil at the end of the method for identical results.</p>
			<p>As usual, all solutions were educational.  My thanks to all for the code and excellent discussion this time around.</p>
			<p>Tomorrow we will begin a run of at least three non-NP-complete problems by myself and others...</p>
		</div>
		<div id="logo"><img src="/web/20120120003547im_/http://rubyquiz.com/images/ruby_quiz_logo.jpg" alt="" width="157" height="150" /></div>
		<div id="links">
			<span class="title">Quiz Solutions</span>
			<ol>
				<li><a href="/web/20120120003547/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/178502">Patrick Deuster</a></li>
				<li><a href="/web/20120120003547/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/178512">Luke Blanshard</a></li>
				<li><a href="/web/20120120003547/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/178520">Manuel Kasten</a></li>
				<li><a href="/web/20120120003547/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/178530">Levin Alexander</a></li>
				<li><a href="/web/20120120003547/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/178537">soxinbox</a></li>
				<li><a href="/web/20120120003547/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/178543">Adam Shelly</a></li>
				<li><a href="/web/20120120003547/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/178561">Chris Parker</a></li>
				<li><a href="/web/20120120003547/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/178585">Matthew Moss</a></li>
				<li><a href="/web/20120120003547/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/178597">Luke Blanshard (2)</a></li>
				<li><a href="/web/20120120003547/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/178598">Levin Alexander (2)</a></li>
				<li><a href="/web/20120120003547/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/178621">Patrick Deuster (2)</a></li>
				<li><a href="/web/20120120003547/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/178626">0x002A</a></li>
				<li><a href="/web/20120120003547/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/178628">James Edward Gray II</a></li>
				<li><a href="/web/20120120003547/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/178656">Adam Shelly (2)</a></li>
				<li><a href="/web/20120120003547/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/178676">Simon Kr&ouml;ger</a></li>
				<li><a href="/web/20120120003547/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/178907">Bill Dolinar</a></li>
				<li><a href="/web/20120120003547/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/179042">Dominik Bathon</a></li>
				<li><a href="/web/20120120003547/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/179085">Adam Shelly (3)</a></li>
				<li><a href="/web/20120120003547/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/179219">Bill Dolinar (2)</a></li>
			</ol>
			<p><a href="/web/20120120003547/http://rubyquiz.com/quiz65_sols.zip">Download Solutions</a></p>
			<p><a href="/web/20120120003547/http://rubyquiz.com/index.html">Back to Quiz Listing</a></p>
		</div>
		<div id="footer">&nbsp;</div>
	</div>
</body>
</html>





<!--
     FILE ARCHIVED ON 0:35:47 Jan 20, 2012 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 13:09:57 Jun 5, 2013.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
