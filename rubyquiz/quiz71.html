<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>


<!-- Start Wayback Rewrite JS Include -->
<script type="text/javascript" src="/static/js/jwplayer/jwplayer.js" ></script>
<script type="text/javascript" src="/static/js/video-embed-rewriter.js"></script>
<script type="text/javascript">
function initYTVideo(id)
{
	_wmVideos_.init("/web/", id);
}
</script>
<!-- End Wayback Rewrite JS Include -->

	<title>Ruby Quiz - Space Merchant (#71)</title>
	<link rel="stylesheet" type="text/css" href="/web/20120121195955cs_/http://rubyquiz.com/quiz.css" />
	<link rel="stylesheet" type="text/css" href="/web/20120121195955cs_/http://rubyquiz.com/print.css" media="print" />
</head><body>
<!-- BEGIN WAYBACK TOOLBAR INSERT -->

<script type="text/javascript" src="/static/js/disclaim-element.js" ></script>
<script type="text/javascript" src="/static/js/graph-calc.js" ></script>
<script type="text/javascript" src="/static/jflot/jquery.min.js" ></script>
<script type="text/javascript">
//<![CDATA[
var firstDate = 820454400000;
var lastDate = 1388534399999;
var wbPrefix = "/web/";
var wbCurrentUrl = "http:\/\/rubyquiz.com\/quiz71.html";

var curYear = -1;
var curMonth = -1;
var yearCount = 18;
var firstYear = 1996;
var imgWidth = 450;
var yearImgWidth = 25;
var monthImgWidth = 2;
var trackerVal = "none";
var displayDay = "21";
var displayMonth = "Jan";
var displayYear = "2012";
var prettyMonths = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

function showTrackers(val) {
	if(val == trackerVal) {
		return;
	}
	if(val == "inline") {
		document.getElementById("displayYearEl").style.color = "#ec008c";
		document.getElementById("displayMonthEl").style.color = "#ec008c";
		document.getElementById("displayDayEl").style.color = "#ec008c";		
	} else {
		document.getElementById("displayYearEl").innerHTML = displayYear;
		document.getElementById("displayYearEl").style.color = "#ff0";
		document.getElementById("displayMonthEl").innerHTML = displayMonth;
		document.getElementById("displayMonthEl").style.color = "#ff0";
		document.getElementById("displayDayEl").innerHTML = displayDay;
		document.getElementById("displayDayEl").style.color = "#ff0";
	}
   document.getElementById("wbMouseTrackYearImg").style.display = val;
   document.getElementById("wbMouseTrackMonthImg").style.display = val;
   trackerVal = val;
}
function getElementX2(obj) {
	var thing = jQuery(obj);
	if((thing == undefined) 
			|| (typeof thing == "undefined") 
			|| (typeof thing.offset == "undefined")) {
		return getElementX(obj);
	}
	return Math.round(thing.offset().left);
}
function trackMouseMove(event,element) {

   var eventX = getEventX(event);
   var elementX = getElementX2(element);
   var xOff = eventX - elementX;
	if(xOff < 0) {
		xOff = 0;
	} else if(xOff > imgWidth) {
		xOff = imgWidth;
	}
   var monthOff = xOff % yearImgWidth;

   var year = Math.floor(xOff / yearImgWidth);
	var yearStart = year * yearImgWidth;
   var monthOfYear = Math.floor(monthOff / monthImgWidth);
   if(monthOfYear > 11) {
       monthOfYear = 11;
   }
   // 1 extra border pixel at the left edge of the year:
   var month = (year * 12) + monthOfYear;
   var day = 1;
	if(monthOff % 2 == 1) {
		day = 15;
	}
	var dateString = 
		zeroPad(year + firstYear) + 
		zeroPad(monthOfYear+1,2) +
		zeroPad(day,2) + "000000";

	var monthString = prettyMonths[monthOfYear];
	document.getElementById("displayYearEl").innerHTML = year + 1996;
	document.getElementById("displayMonthEl").innerHTML = monthString;
	// looks too jarring when it changes..
	//document.getElementById("displayDayEl").innerHTML = zeroPad(day,2);

	var url = wbPrefix + dateString + '/' +  wbCurrentUrl;
	document.getElementById('wm-graph-anchor').href = url;

   //document.getElementById("wmtbURL").value="evX("+eventX+") elX("+elementX+") xO("+xOff+") y("+year+") m("+month+") monthOff("+monthOff+") DS("+dateString+") Moy("+monthOfYear+") ms("+monthString+")";
   if(curYear != year) {
       var yrOff = year * yearImgWidth;
       document.getElementById("wbMouseTrackYearImg").style.left = yrOff + "px";
       curYear = year;
   }
   if(curMonth != month) {
       var mtOff = year + (month * monthImgWidth) + 1;
       document.getElementById("wbMouseTrackMonthImg").style.left = mtOff + "px";
       curMonth = month;
   }
}
//]]>
</script>

<style type="text/css">body{margin-top:0!important;padding-top:0!important;min-width:800px!important;}#wm-ipp a:hover{text-decoration:underline!important;}</style>
<div id="wm-ipp" style="display:none; position:relative;padding:0 5px;min-height:70px;min-width:800px; z-index:9000;">
<div id="wm-ipp-inside" style="position:fixed;padding:0!important;margin:0!important;width:97%;min-width:780px;border:5px solid #000;border-top:none;background-image:url(/static/images/toolbar/wm_tb_bk_trns.png);text-align:center;-moz-box-shadow:1px 1px 3px #333;-webkit-box-shadow:1px 1px 3px #333;box-shadow:1px 1px 3px #333;font-size:11px!important;font-family:'Lucida Grande','Arial',sans-serif!important;">
   <table style="border-collapse:collapse;margin:0;padding:0;width:100%;"><tbody><tr>
   <td style="padding:10px;vertical-align:top;min-width:110px;">
   <a href="/web/" title="Wayback Machine home page" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wayback-toolbar-logo.png" alt="Wayback Machine" width="110" height="39" border="0"/></a>
   </td>
   <td style="padding:0!important;text-align:center;vertical-align:top;width:100%;">

       <table style="border-collapse:collapse;margin:0 auto;padding:0;width:570px;"><tbody><tr>
       <td style="padding:3px 0;" colspan="2">
       <form target="_top" method="get" action="/web/form-submit.jsp" name="wmtb" id="wmtb" style="margin:0!important;padding:0!important;"><input type="text" name="url" id="wmtbURL" value="http://rubyquiz.com/quiz71.html" style="width:400px;font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;" onfocus="javascript:this.focus();this.select();" /><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20120121195955" /><input type="submit" value="Go" style="font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;margin-left:5px;" /><span id="wm_tb_options" style="display:block;"></span></form>
       </td>
       <td style="vertical-align:bottom;padding:5px 0 0 0!important;" rowspan="2">
           <table style="border-collapse:collapse;width:110px;color:#99a;font-family:'Helvetica','Lucida Grande','Arial',sans-serif;"><tbody>
			
           <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
           <tr style="width:110px;height:16px;font-size:10px!important;">
           	<td style="padding-right:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20101127175706/http://rubyquiz.com/quiz71.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="27 Nov 2010"><strong>NOV</strong></a>
		                
               </td>
               <td id="displayMonthEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight:bold;text-transform:uppercase;width:34px;height:15px;padding-top:1px;text-align:center;" title="You are here: 19:59:55 Jan 21, 2012">JAN</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20120418052831/http://www.rubyquiz.com/quiz71.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="18 Apr 2012"><strong>APR</strong></a>
		                
               </td>
           </tr>

           <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
           <tr>
               <td style="padding-right:9px;white-space:nowrap;overflow:visible;text-align:right!important;vertical-align:middle!important;" nowrap="nowrap">
               
		                <a href="/web/20101127175706/http://rubyquiz.com/quiz71.html" title="17:57:06 Nov 27, 2010" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0" /></a>
		                
               </td>
               <td id="displayDayEl" style="background:#000;color:#ff0;width:34px;height:24px;padding:2px 0 0 0;text-align:center;font-size:24px;font-weight: bold;" title="You are here: 19:59:55 Jan 21, 2012">21</td>
				<td style="padding-left:9px;white-space:nowrap;overflow:visible;text-align:left!important;vertical-align:middle!important;" nowrap="nowrap">
               
		                <a href="/web/20120418052831/http://www.rubyquiz.com/quiz71.html" title="5:28:31 Apr 18, 2012" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wm_tb_nxt_on.png" alt="Next capture" width="14" height="16" border="0"/></a>
		                
			    </td>
           </tr>

           <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
           <tr style="width:110px;height:13px;font-size:9px!important;">
				<td style="padding-right:9px;font-size:11px!important;font-weight: bold;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20101127175706/http://rubyquiz.com/quiz71.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="27 Nov 2010"><strong>2010</strong></a>
		                
               </td>
               <td id="displayYearEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight: bold;padding-top:1px;width:34px;height:13px;text-align:center;" title="You are here: 19:59:55 Jan 21, 2012">2012</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight: bold;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20130215052218/http://rubyquiz.com/quiz71.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="15 Feb 2013"><strong>2013</strong></a>
		                
				</td>
           </tr>
           </tbody></table>
       </td>

       </tr>
       <tr>
       <td style="vertical-align:middle;padding:0!important;">
           <a href="/web/20120121195955*/http://rubyquiz.com/quiz71.html" style="color:#33f;font-size:11px;font-weight:bold;background-color:transparent;border:none;" title="See a list of every capture for this URL"><strong>34 captures</strong></a>
           <div style="margin:0!important;padding:0!important;color:#666;font-size:9px;padding-top:2px!important;white-space:nowrap;" title="Timespan for captures of this URL">24 Apr 06 - 15 Feb 13</div>
       </td>
       <td style="padding:0!important;">
       <a style="position:relative; white-space:nowrap; width:450px;height:27px;" href="" id="wm-graph-anchor">
       <div id="wm-ipp-sparkline" style="position:relative; white-space:nowrap; width:450px;height:27px;background-color:#fff;cursor:pointer;border-right:1px solid #ccc;" title="Explore captures for this URL">
			<img id="sparklineImgId" style="position:absolute; z-index:9012; top:0px; left:0px;"
				onmouseover="showTrackers('inline');" 
				onmouseout="showTrackers('none');"
				onmousemove="trackMouseMove(event,this)"
				alt="sparklines"
				width="450"
				height="27"
				border="0"
				src="/web/jsp/graph.jsp?graphdata=450_27_1996:-1:000000000000_1997:-1:000000000000_1998:-1:000000000000_1999:-1:000000000000_2000:-1:000000000000_2001:-1:000000000000_2002:-1:000000000000_2003:-1:000000000000_2004:-1:000000000000_2005:-1:000000000000_2006:-1:000110000100_2007:-1:000100010000_2008:-1:000020000000_2009:-1:000000000000_2010:-1:100000000010_2011:-1:000000000000_2012:0:1001b000a100_2013:-1:010000000000"></img>
			<img id="wbMouseTrackYearImg" 
				style="display:none; position:absolute; z-index:9010;"
				width="25" 
				height="27"
				border="0"
				src="/static/images/toolbar/transp-yellow-pixel.png"></img>
			<img id="wbMouseTrackMonthImg"
				style="display:none; position:absolute; z-index:9011; " 
				width="2"
				height="27" 
				border="0"
				src="/static/images/toolbar/transp-red-pixel.png"></img>
       </div>
		</a>

       </td>
       </tr></tbody></table>
   </td>
   <td style="text-align:right;padding:5px;width:65px;font-size:11px!important;">
       <a href="javascript:;" onclick="document.getElementById('wm-ipp').style.display='none';" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_close.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;margin-bottom:23px;background-color:transparent;border:none;" title="Close the toolbar">Close</a>
       <a href="http://faq.web.archive.org/" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_help.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;background-color:transparent;border:none;" title="Get some help using the Wayback Machine">Help</a>
   </td>
   </tr></tbody></table>

</div>
</div>
<script type="text/javascript">
 var wmDisclaimBanner = document.getElementById("wm-ipp");
 if(wmDisclaimBanner != null) {
   disclaimElement(wmDisclaimBanner);
 }
</script>
<!-- END WAYBACK TOOLBAR INSERT -->

	<div id="page">
		<div id="header"><span class="ruby">Ruby</span> <span class="quiz">Quiz</span></div>
		<div id="content">
			<span class="title">Space Merchant (#71)</span>
			<p>This week's Ruby Quiz is to build a complete game with the help of your fellow Ruby Programmers.  This is a multipart Ruby Quiz all in one week.  Each person should select one task they wish to solve and leave the other tasks for other solutions.</p>
			<p class="example">The Game</p>
			<p>When I was young, I loved to play BBS door games.  A very popular game I was hooked on was called TradeWars 2002.  While the BBS is pretty much a thing of the past, that game has been cloned in some form or another for just about every platform that ever existed.</p>
			<p>The premise of the game is simple:  you play a space trader flying around the galaxy buying and selling goods.  The main goal is to find places to buy goods at a low price and then unload those goods at another location with a higher price, turning a profit.  Most versions of the game allow you to use that money to buy bigger and better space ships, which in turn allows you to carry more goods and make bigger profits.  Many versions of the game don't have a clear ending, though I have seen a version that eventually allowed you to buy a moon to retire on.</p>
			<p class="example">Common Elements</p>
			<p>The thread tying all the pieces of the game together is the Player object.  It is the centralized storage for game state information, like how much money the player currently has.</p>
			<p>The other item we need is a trivial event loop.  The options a player has available at any given time are a function of where they are.  For example, while flying through space the player probably has commands to choose a destination, but when docked with a space station the commands will likely center around buying and selling goods.</p>
			<p>The following code provides both elements:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="comment">#!/usr/local/bin/ruby -w</span><br /><br />    <span class="comment"># space_merchant.rb</span><br /><br />    require <span class="string">"singleton"</span><br /><br />    <span class="keyword">module</span> SpaceMerchant<br />      VERSION = <span class="string">"1.0"</span><br /><br />      <span class="comment"># We will use a basic Hash, but feel free to add methods to it.</span><br />      <span class="keyword">class</span> Player<br />        instance_methods.each { |meth| undef_method(meth) <span class="keyword">unless</span> meth =~ <span class="string">/^__/</span> }<br /><br />        include Singleton<br />        <span class="keyword">def</span> initialize<br />          <span class="variable">@game_data</span> = Hash.new<br />        <span class="keyword">end</span><br /><br />        <span class="keyword">def</span> method_missing( meth, *args, &amp;block )<br />          <span class="variable">@game_data</span>.send(meth, *args, &amp;block)<br />        <span class="keyword">end</span><br />      <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br />    <span class="keyword">if</span> <span class="keyword">__FILE__</span> == <span class="global">$0</span><br />      require <span class="string">"galaxy"</span>   <span class="comment"># Task 1</span><br />      require <span class="string">"sector"</span>   <span class="comment"># Task 2</span><br />      require <span class="string">"station"</span>  <span class="comment"># Task 3</span><br />      require <span class="string">"planet"</span>   <span class="comment"># Task 4</span><br /><br />      <span class="comment"># collect beginning player information</span><br />      player = SpaceMerchant::Player.instance<br /><br />      puts<br />      puts <span class="string">"Welcome to Space Merchant #{SpaceMerchant::VERSION}, "</span> +<br />           <span class="string">"the Ruby Quiz game!"</span><br />      puts<br /><br />      print <span class="string">"What would you like to be called, pilot?  "</span><br />      loop <span class="keyword">do</span><br />        name = gets.chomp<br /><br />        <span class="keyword">if</span> name =~ <span class="string">/\S/</span><br />          player[:name] = name<br /><br />          puts <span class="string">"#{player[:name]} it is."</span><br />          puts<br /><br />          puts <span class="string">"May you find fame and fortune here in the Ruby Galaxy..."</span><br />          puts<br /><br />          <span class="keyword">break</span><br />        <span class="keyword">else</span><br />          print <span class="string">"Please enter a name:  "</span><br />        <span class="keyword">end</span><br />      <span class="keyword">end</span><br /><br />      player[:credits]  = 1000<br />      <span class="comment"># we initialize player[:location], it should be changed to move the player</span><br />      player[:location] = SpaceMerchant::Galaxy.instance.starting_location<br /><br />      catch(:quit) <span class="keyword">do</span>  <span class="comment"># use throw(:quit) to exit the game</span><br />        <span class="comment"># primary event loop</span><br />        loop { player[:location].handle_event(player) }<br />      <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br /></div></div>
			<p>As you can see in the event loop, all Sectors, Stations, and Planets need to support a handle_event() method that gives the player some choices, fetches an action from the keyboard, and responds appropriately.</p>
			<p>The other four pieces I leave to you...</p>
			<p class="example">SpaceMerchant::Galaxy (Task 1)</p>
			<p>We need an object representing the play-space as a whole.  The Galaxy is responsible for creating all of the game locations and allowing event code to access these locations.</p>
			<p>There should only be one Galaxy, so please make it a Singleton (support an instance() class method to retrieve it).</p>
			<p>The first concern of the Galaxy is to construct Sector, Planet and Station objects.  Sectors are pieces of space the players can move between.  Think of them as squares on the game board.  These areas must be connected, so the player can move from location to location.  Sectors will support these creation methods, to aid this process:</p>
			<p class="example">Sector::new( name, location = nil )<br />Sector#link( other_sector )<br />Sector#add_planet( planet )<br />Sector#add_station( station )</p>
			<p>Don't sweat too much over the names for the Sectors, TradeWars simply numbered them:  Sector 1, Sector 2, ..., Sector 1051, ...  This works out surprisingly well because players can enter letter commands for game actions (say l for land) and numbers to move to a new Sector.</p>
			<p>The location parameter is an optional way to divide Sectors into groups.  For example, Sectors 1 through 10 were always "Fed Space" in TradeWars.</p>
			<p>The add_*() methods are for placing Planet and Station objects in the Sector.  Both are trivial to construct (again be creative with the names):</p>
			<p class="example">Planet.new( sector, name )<br />Station.new( sector, name )</p>
			<p>Let's keep the number objects fairly small, just so we don't overwhelm the player.  Something like up to five Planets, possibly one Station, and a maximum of six links to nearby Sectors sounds sane to me (but use your best judgement).  Of course, a Sector can be empty.</p>
			<p>Please provide these iterators to help the other classes locate objects as well:</p>
			<p class="example">Galaxy::find_sectors { |sector| ... }<br />Galaxy::find_planets { |planet| ... }<br />Galaxy::find_stations { |station| ... }</p>
			<p>Finally, the Galaxy should provide a pathfinding algorithm, for use in navigation:</p>
			<p class="example">Galaxy::find_path( start_sector, finish_sector, *avoid_sectors )</p>
			<p>This method should return an Array of Sectors beginning with the start_sector and ending with the finish_sector.  If the optional avoid_sectors are provided, they should not be used.  It's okay to return nil, if a path could not be found, but this should only be possible with avoid_sectors.</p>
			<p>Random idea:  some games have wormholes, one way links between Sectors.  This can make for very interesting layouts.  Just be careful if you add wormholes to make sure all Sectors can still be reached from all other Sectors.</p>
			<p class="example">SpaceMerchant::Sector (Task 2)</p>
			<p>(See Galaxy for the creation methods Sector needs to support.)</p>
			<p>The Sector is the main interface for moving around the Galaxy.  The Sector should show the player their location, and request a command:</p>
			<p class="example">Sector 302<br />The Reaches<br /><br />Station:  ABC Station<br />Planets:  Myr III, Myr IV, Myr VII<br /><br />(D)ock with station<br />(L)and on planet<br />(P)lot a course<br /><br />(Q)uit game<br /><br />Or warp to nearby sector:  [4], [25], 1021, [9919]</p>
			<p>Feel free to deviate from that in anyway you choose.</p>
			<p>With the Sector you are in charge of how the player can move about.  Should they only be allowed to move to nearby Sectors or can they plot long range courses?  Perhaps only to Sectors they have visited before?  You decide.</p>
			<p>Any game level functions also belong here.  Quit is obvious, but can you think of an easy way to support save?</p>
			<p>Random ideas:  consider supporting random encounters with computer controlled ships to make the galaxy feel more alive.  "Unidentified vessel, this is the Galactic Patrol and we suspect you are transporting illegal cargo...  Prepare to be boarded!"</p>
			<p>Also consider supporting other space features like nebulas, black holes, asteroid belts, etc.  How should these affect the player?</p>
			<p class="example">SpaceMerchant::Station (Task 3)</p>
			<p>(See Galaxy for the constructor Station needs to support.)</p>
			<p>Stations are where the player can buy and sell goods.  There may be some set categories of goods available in the Galaxy, but an individual Station should probably just offer to trade in a subset of those.</p>
			<p>Some games have Stations set prices based on where they are in the Galaxy while other games have the prices fluctuate everywhere over time.  You can even have Stations set their prices based on demand, which could rise and fall as the player trades there.</p>
			<p>The player's ship should probably have a limited capacity of goods it can carry at a time.  I purposefully haven't set this, so that Station implementations could flesh out the player's ship as they saw fit.  Perhaps some Stations could even offer ship upgrades.</p>
			<p>Random idea:  The original TradeWars game even allowed players to choose a criminal path.  They could try stealing goods from a Station, to trade elsewhere.  There were penalties for getting caught though and eventually word of your crimes got around and you weren't safe from the other denizens of space.</p>
			<p class="example">SpaceMerchant::Planet (Task 4)</p>
			<p>(See Galaxy for the constructor Planet needs to support.)</p>
			<p>Planets have had numerous functions in the various incarnations of space trading games.  In the spirit of that, I'm leaving this section as a sort of free-for-all.</p>
			<p>My suggestion is to use the planets as a kind of a quest engine.  Allow the player to pick-up unique cargos or people and transport them to other planets in the Galaxy.  See if you can get these quests to build on each other and form a basic plot for the game.</p>
			<p>Random idea:  Some games have had items for sale which allowed the creation and destruction of planets.  You might even be able to tie that into the missions somehow.</p>
			<p class="example">Sharing Your API</p>
			<p>When you have finished a task, you are invited to send in a message telling others what you built, even if the spoiler period has not yet passed.  You may include documentation for some methods your object provides, or detail some variables you set on the Player.  This may help others to choose a different task and take advantage of features you provided.</p>
			<hr />
			<p><span class="title">Quiz Summary</span></p>
			<p>The primary focus of this quiz, for me, was to see how well a handful of developers could quickly throw something together, without much knowledge of what the other guys were doing.  I think it went very well.  I forgot several basic things in my specification (like how Planet and Station needed a name() accessor), but convention and common sense seemed to get us through with little trouble.  Too cool.</p>
			<p>Obviously, I can't show all the code that was written this week.  Instead, I will try to hit on some highlights.</p>
			<p class="example">Development in Isolation</p>
			<p>Since we were each just building a part of the whole, one of the big questions became, how do I test my part?  I built the Station, which doesn't really require much from the other pieces.  Sector and Galaxy help you move from Station to Station, but that turns out to be trivial to bypass.  I really just needed to pretend I was docking at Station after Station.  To do that, I added the following code to the end of station.rb:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="keyword">if</span> <span class="keyword">__FILE__</span> == <span class="global">$PROGRAM_NAME</span><br />      player = {:credits =&gt; 1000}<br /><br />      loop <span class="keyword">do</span><br />        <span class="keyword">if</span> player[:location].nil?<br />          player[:location] = SpaceMerchant::Station.new(<span class="keyword">nil</span>, <span class="string">"Test"</span>)<br />        <span class="keyword">end</span><br /><br />        player[:location].handle_event(player)<br />      <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br /></div></div>
			<p>The idea here is that when you lift off from a Station, you will go back into the Sector.  So if we pass Station some Sector substitute that is easy to watch for, nil for example, we can just replace that object with a newly constructed Station whenever we see it.  This simulates flying from Sector to Sector, docking at Stations.</p>
			<p>Some pieces depended on the others more heavily though, requiring more complete solutions for testing.  Ross Bamford built Galaxy, which requires at least a minimal representations of the other celestial objects.  Ross solved this by mocking the other objects with the needed functionality:</p>
			<div class="code"><span class="type">ruby</span><div class="body">      <span class="keyword">if</span> <span class="global">$0</span> == <span class="keyword">__FILE__</span><br />        <span class="comment"># The comparable stuff is needed only by the tests,</span><br />        <span class="comment"># not the Galaxy impl itself.  </span><br />        <span class="keyword">class</span> Named <span class="comment">#:nodoc: all</span><br />          <span class="keyword">def</span> initialize(sector, name); <span class="variable">@name</span> = name.to_s; <span class="keyword">end</span><br />          <span class="keyword">def</span> name; <span class="variable">@name</span>; <span class="keyword">end</span><br />          <span class="keyword">alias</span> :to_s :name<br />          <span class="keyword">def</span> inspect; <span class="string">"#{self.class.name}:#{@name}"</span>; <span class="keyword">end</span><br />          <span class="keyword">def</span> ==(o); name == o.name; <span class="keyword">end</span><br />          <span class="keyword">def</span> &lt;=&gt;(o); name &lt;=&gt; o.to_s; <span class="keyword">end</span><br />        <span class="keyword">end</span><br /><br />        <span class="keyword">class</span> Sector &lt; Named <span class="comment">#:nodoc: all</span><br />          <span class="keyword">def</span> initialize(name, location = <span class="keyword">nil</span>)<br />            <span class="keyword">super</span>(<span class="keyword">nil</span>, name)<br />            <span class="variable">@location</span>, <span class="variable">@planets</span>, <span class="variable">@stations</span>, <span class="variable">@links</span> = location, [], [], []<br />          <span class="keyword">end</span><br />          attr_accessor :location, :planets, :stations, :links<br />          <span class="keyword">def</span> add_planet(planet); <span class="variable">@planets</span> &lt;&lt; planet; <span class="keyword">end</span><br />          <span class="keyword">def</span> add_station(station); <span class="variable">@stations</span> &lt;&lt; station; <span class="keyword">end</span><br />          <span class="keyword">def</span> link(o); <span class="variable">@links</span> &lt;&lt; o; <span class="keyword">end</span><br />          <span class="keyword">def</span> ==(o)<br />            <span class="keyword">begin</span><br />              name == o.name &amp;&amp;<br />                planets == o.planets &amp;&amp;<br />                stations == o.stations &amp;&amp;<br />                links.length == o.links.length<br />            <span class="keyword">rescue</span> NoMethodError<br />              <span class="keyword">false</span><br />            <span class="keyword">end</span><br />          <span class="keyword">end</span><br />        <span class="keyword">end</span><br /><br />        <span class="keyword">class</span> Planet &lt; Named <span class="comment">#:nodoc: all</span><br />        <span class="keyword">end</span><br /><br />        <span class="keyword">class</span> Station &lt; Named <span class="comment">#:nodoc: all</span><br />        <span class="keyword">end</span><br /><br />        <span class="comment"># ...</span><br /><br /></div></div>
			<p>Ross started with the minimal Named functionality that all objects share.  I would have provided this in the quiz, if I was as smart as Ross.  From there, Ross just adds in the functionality Galaxy requires.  Note how unused details (like the sector parameter to new()) are just casually ignored.  The goal is to build only what is needed to test the Galaxy implementation.</p>
			<p class="example">The Singleton Shortcut</p>
			<p>I know how we all love a good method_missing() trick, so here's my favorite for this week, again from Ross:</p>
			<div class="code"><span class="type">ruby</span><div class="body">      <span class="keyword">class</span> Galaxy<br />        include Singleton<br /><br />        <span class="comment"># ...</span><br /><br />        <span class="keyword">class</span> &lt;&lt; <span class="keyword">self</span><br />          <span class="comment"># tired of writing 'Galaxy.instance' in tests...</span><br />          <span class="keyword">def</span> method_missing(sym, *args, &amp;blk) <span class="comment">#:nodoc: </span><br />            instance.send(sym, *args, &amp;blk)<br />          <span class="keyword">end</span><br />        <span class="keyword">end</span><br /><br />        <span class="comment"># ...</span><br /><br /></div></div>
			<p>Obviously, there are other solutions to the problem the comment describes, but this particular trick made for a nice interface, I thought.  Observe:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    Galaxy.instance.find_planets { |planet| ... }<br />    <span class="comment"># ... becomes...</span><br />    Galaxy.find_planets { |planet| ... }<br /><br /></div></div>
			<p>That might come in handy with other uses of Singleton, I think.</p>
			<p class="example">The Big Event</p>
			<p>Another detail of this quiz the solvers had to work with was how do handle events.  Here's a handle_event() method for Sector, by Timothy Bennett:</p>
			<div class="code"><span class="type">ruby</span><div class="body">        <span class="comment"># ...</span><br /><br />        <span class="keyword">def</span> handle_event ( player )<br />          player[:visited_sectors] ||= []<br />          player[:visited_sectors] &lt;&lt; <span class="keyword">self</span> \<br />            <span class="keyword">unless</span> player[:visited_sectors].find { |sector| sector == <span class="keyword">self</span> }<br />          print_menu<br />          choice = gets.chomp<br />          <span class="keyword">case</span> choice<br />          <span class="keyword">when</span> <span class="string">/d/</span>i: choose_station<br />          <span class="keyword">when</span> <span class="string">/l/</span>i: choose_planet<br />          <span class="keyword">when</span> <span class="string">/p/</span>i: plot_course<br />          <span class="keyword">when</span> <span class="string">/q/</span>i: throw(:quit)<br />          <span class="keyword">when</span> <span class="string">/\d+/</span>: warp player, choice<br />          <span class="keyword">else</span> invalid_choice<br />          <span class="keyword">end</span><br />        <span class="keyword">end</span><br /><br />        <span class="comment"># ...</span><br /><br /></div></div>
			<p>Aside from the elegant menu dispatch at the end of the method, the main point of interest is the first line.  We all had to add our individual elements to the Player object as needed, which required a little defensive programming.  When the Player first arrives in a Sector, there is no :visited_sectors key (the game script doesn't create one).  This is probably a sign that I should have provided an initialization hook in the quiz, but optional assignments like the above still might have been needed for things not known in advance.  Luckily the ||= operator is just perfect for this kind of work.</p>
			<p>I won't show all the all of the event methods used above, but here is one of them:</p>
			<div class="code"><span class="type">ruby</span><div class="body">          <span class="comment"># ...</span><br /><br />          <span class="keyword">def</span> choose_station<br />            player = Player.instance<br />            puts <span class="string">"There are no stations to dock with!"</span> <span class="keyword">if</span> <span class="variable">@stations</span>.empty?<br />            <span class="keyword">if</span> <span class="variable">@stations</span>.size == 1<br />              dock <span class="variable">@stations</span>[0], player<br />            <span class="keyword">else</span><br />              <span class="variable">@stations</span>.each_with_index <span class="keyword">do</span> |station, index|<br />                puts <span class="string">"(#{index + 1}) #{station.name}"</span><br />              <span class="keyword">end</span><br />              puts <span class="string">"Enter the number of the station to dock with: "</span><br /><br />              station_index = gets.chomp.to_i - 1<br />              <span class="keyword">if</span> <span class="variable">@stations</span>[station_index]<br />                dock <span class="variable">@stations</span>[station_index], player<br />              <span class="keyword">else</span><br />                puts <span class="string">"Invalid station."</span><br />              <span class="keyword">end</span><br />            <span class="keyword">end</span><br />          <span class="keyword">end</span><br /><br />          <span class="comment"># ...</span><br /><br /></div></div>
			<p>I really liked how this method would just intelligently make the choice, if there was only one, or prompt the user when a decision needed to be made.  This made for a better playing experience for sure.</p>
			<p class="example">Manufacturing Fun and Destruction</p>
			<p>The final aspect of this quiz was, of course, innovation.  I left the specification very open in the hopes that someone would grab the ball and run...</p>
			<div class="code"><span class="type">ruby</span><div class="body">      <span class="keyword">class</span> UsableItem<br />        attr_reader :rarity, :name, :description<br /><br />        <span class="keyword">def</span> initialize (name, description = <span class="string">""</span>, rarity = 0.7, &amp;block)<br />          <span class="variable">@effect</span> = block <span class="keyword">if</span> block_given?<br />          <span class="variable">@name</span> = name<br />          <span class="variable">@description</span> = description<br />          <span class="variable">@rarity</span> = rarity<br />        <span class="keyword">end</span><br /><br />        <span class="keyword">def</span> use (player)<br />          <span class="keyword">if</span> <span class="variable">@effect</span><br />            <span class="variable">@effect</span>.call player<br />          <span class="keyword">else</span><br />            puts <span class="string">"#{name} has no effect."</span><br />          <span class="keyword">end</span><br />        <span class="keyword">end</span><br /><br />        <span class="keyword">def</span> to_s<br />          name<br />        <span class="keyword">end</span><br />      <span class="keyword">end</span><br /><br /></div></div>
			<p>Obviously, that is just a name, description, and rarity attached to a block (from Timothy Bennett's planet.rb), but just look at this example of the earth-shattering fun to be had with an object like this:</p>
			<div class="code"><span class="type">ruby</span><div class="body">      <span class="comment"># ...</span><br /><br />      omega = SpaceMerchant::UsableItem.new( <span class="string">"Omega"</span>,<br />                                             <span class="string">"Don't push that button.  Please."</span>,<br />                                             0.9 ) <span class="keyword">do</span> |player|<br />        planet = player[:location]<br />        player[:location] = planet.sector<br />        puts<br />        puts <span class="string">"You hear a terrible rumbling as the Vogon constructor fleet"</span><br />        puts <span class="string">"descends upon #{planet.name}.  You scramble to your"</span><br />        puts <span class="string">"ship and launch just in time to avoid becoming space dust."</span><br />        puts<br />        player[:location].planets.slice!(player[:location].planets.index(planet))<br />      <span class="keyword">end</span><br /><br />      <span class="comment"># ...</span><br /><br /></div></div>
			<p>I love it.</p>
			<p>A big thank you to all who played with my pet project.  Hopefully you didn't blow up your planet doing so.</p>
			<p>Tomorrow we will continue our focus on essential Ruby programming skills with Breaking and Entering 101...</p>
		</div>
		<div id="logo"><img src="/web/20120121195955im_/http://rubyquiz.com/images/ruby_quiz_logo.jpg" alt="" width="157" height="150" /></div>
		<div id="links">
			<span class="title">Quiz Solutions</span>
			<ol>
				<li><a href="/web/20120121195955/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/184632">Jacob Fugal</a></li>
				<li><a href="/web/20120121195955/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/184857">Jay Anderson</a></li>
				<li><a href="/web/20120121195955/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/184858">Timothy Bennett</a></li>
				<li><a href="/web/20120121195955/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/184859">Timothy Bennett (2)</a></li>
				<li><a href="/web/20120121195955/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/184860">Jay Anderson (2)</a></li>
				<li><a href="/web/20120121195955/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/184872">Ross Bamford</a></li>
				<li><a href="/web/20120121195955/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/184935">Timothy Bennett (3)</a></li>
				<li><a href="/web/20120121195955/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/184996">Ross Bamford (2)</a></li>
				<li><a href="/web/20120121195955/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/185015">James Edward Gray II</a></li>
				<li><a href="/web/20120121195955/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/185041">Timothy Benett (4)</a></li>
				<li><a href="/web/20120121195955/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/185365">Ross Bamford (3)</a></li>
				<li><a href="/web/20120121195955/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/185485">Dimitri Aivaliotis</a></li>
			</ol>
			<p><a href="/web/20120121195955/http://rubyquiz.com/quiz71_sols.zip">Download Solutions</a></p>
			<p><a href="/web/20120121195955/http://rubyquiz.com/index.html">Back to Quiz Listing</a></p>
		</div>
		<div id="footer">&nbsp;</div>
	</div>
</body>
</html>





<!--
     FILE ARCHIVED ON 19:59:55 Jan 21, 2012 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 13:10:03 Jun 5, 2013.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
