<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>


<!-- Start Wayback Rewrite JS Include -->
<script type="text/javascript" src="/static/js/jwplayer/jwplayer.js" ></script>
<script type="text/javascript" src="/static/js/video-embed-rewriter.js"></script>
<script type="text/javascript">
function initYTVideo(id)
{
	_wmVideos_.init("/web/", id);
}
</script>
<!-- End Wayback Rewrite JS Include -->

	<title>Ruby Quiz - Object Browser (#8)</title>
	<link rel="stylesheet" type="text/css" href="/web/20120121221542cs_/http://rubyquiz.com/quiz.css" />
	<link rel="stylesheet" type="text/css" href="/web/20120121221542cs_/http://rubyquiz.com/print.css" media="print" />
</head><body>
<!-- BEGIN WAYBACK TOOLBAR INSERT -->

<script type="text/javascript" src="/static/js/disclaim-element.js" ></script>
<script type="text/javascript" src="/static/js/graph-calc.js" ></script>
<script type="text/javascript" src="/static/jflot/jquery.min.js" ></script>
<script type="text/javascript">
//<![CDATA[
var firstDate = 820454400000;
var lastDate = 1388534399999;
var wbPrefix = "/web/";
var wbCurrentUrl = "http:\/\/rubyquiz.com\/quiz8.html";

var curYear = -1;
var curMonth = -1;
var yearCount = 18;
var firstYear = 1996;
var imgWidth = 450;
var yearImgWidth = 25;
var monthImgWidth = 2;
var trackerVal = "none";
var displayDay = "21";
var displayMonth = "Jan";
var displayYear = "2012";
var prettyMonths = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

function showTrackers(val) {
	if(val == trackerVal) {
		return;
	}
	if(val == "inline") {
		document.getElementById("displayYearEl").style.color = "#ec008c";
		document.getElementById("displayMonthEl").style.color = "#ec008c";
		document.getElementById("displayDayEl").style.color = "#ec008c";		
	} else {
		document.getElementById("displayYearEl").innerHTML = displayYear;
		document.getElementById("displayYearEl").style.color = "#ff0";
		document.getElementById("displayMonthEl").innerHTML = displayMonth;
		document.getElementById("displayMonthEl").style.color = "#ff0";
		document.getElementById("displayDayEl").innerHTML = displayDay;
		document.getElementById("displayDayEl").style.color = "#ff0";
	}
   document.getElementById("wbMouseTrackYearImg").style.display = val;
   document.getElementById("wbMouseTrackMonthImg").style.display = val;
   trackerVal = val;
}
function getElementX2(obj) {
	var thing = jQuery(obj);
	if((thing == undefined) 
			|| (typeof thing == "undefined") 
			|| (typeof thing.offset == "undefined")) {
		return getElementX(obj);
	}
	return Math.round(thing.offset().left);
}
function trackMouseMove(event,element) {

   var eventX = getEventX(event);
   var elementX = getElementX2(element);
   var xOff = eventX - elementX;
	if(xOff < 0) {
		xOff = 0;
	} else if(xOff > imgWidth) {
		xOff = imgWidth;
	}
   var monthOff = xOff % yearImgWidth;

   var year = Math.floor(xOff / yearImgWidth);
	var yearStart = year * yearImgWidth;
   var monthOfYear = Math.floor(monthOff / monthImgWidth);
   if(monthOfYear > 11) {
       monthOfYear = 11;
   }
   // 1 extra border pixel at the left edge of the year:
   var month = (year * 12) + monthOfYear;
   var day = 1;
	if(monthOff % 2 == 1) {
		day = 15;
	}
	var dateString = 
		zeroPad(year + firstYear) + 
		zeroPad(monthOfYear+1,2) +
		zeroPad(day,2) + "000000";

	var monthString = prettyMonths[monthOfYear];
	document.getElementById("displayYearEl").innerHTML = year + 1996;
	document.getElementById("displayMonthEl").innerHTML = monthString;
	// looks too jarring when it changes..
	//document.getElementById("displayDayEl").innerHTML = zeroPad(day,2);

	var url = wbPrefix + dateString + '/' +  wbCurrentUrl;
	document.getElementById('wm-graph-anchor').href = url;

   //document.getElementById("wmtbURL").value="evX("+eventX+") elX("+elementX+") xO("+xOff+") y("+year+") m("+month+") monthOff("+monthOff+") DS("+dateString+") Moy("+monthOfYear+") ms("+monthString+")";
   if(curYear != year) {
       var yrOff = year * yearImgWidth;
       document.getElementById("wbMouseTrackYearImg").style.left = yrOff + "px";
       curYear = year;
   }
   if(curMonth != month) {
       var mtOff = year + (month * monthImgWidth) + 1;
       document.getElementById("wbMouseTrackMonthImg").style.left = mtOff + "px";
       curMonth = month;
   }
}
//]]>
</script>

<style type="text/css">body{margin-top:0!important;padding-top:0!important;min-width:800px!important;}#wm-ipp a:hover{text-decoration:underline!important;}</style>
<div id="wm-ipp" style="display:none; position:relative;padding:0 5px;min-height:70px;min-width:800px; z-index:9000;">
<div id="wm-ipp-inside" style="position:fixed;padding:0!important;margin:0!important;width:97%;min-width:780px;border:5px solid #000;border-top:none;background-image:url(/static/images/toolbar/wm_tb_bk_trns.png);text-align:center;-moz-box-shadow:1px 1px 3px #333;-webkit-box-shadow:1px 1px 3px #333;box-shadow:1px 1px 3px #333;font-size:11px!important;font-family:'Lucida Grande','Arial',sans-serif!important;">
   <table style="border-collapse:collapse;margin:0;padding:0;width:100%;"><tbody><tr>
   <td style="padding:10px;vertical-align:top;min-width:110px;">
   <a href="/web/" title="Wayback Machine home page" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wayback-toolbar-logo.png" alt="Wayback Machine" width="110" height="39" border="0"/></a>
   </td>
   <td style="padding:0!important;text-align:center;vertical-align:top;width:100%;">

       <table style="border-collapse:collapse;margin:0 auto;padding:0;width:570px;"><tbody><tr>
       <td style="padding:3px 0;" colspan="2">
       <form target="_top" method="get" action="/web/form-submit.jsp" name="wmtb" id="wmtb" style="margin:0!important;padding:0!important;"><input type="text" name="url" id="wmtbURL" value="http://rubyquiz.com/quiz8.html" style="width:400px;font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;" onfocus="javascript:this.focus();this.select();" /><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20120121221542" /><input type="submit" value="Go" style="font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;margin-left:5px;" /><span id="wm_tb_options" style="display:block;"></span></form>
       </td>
       <td style="vertical-align:bottom;padding:5px 0 0 0!important;" rowspan="2">
           <table style="border-collapse:collapse;width:110px;color:#99a;font-family:'Helvetica','Lucida Grande','Arial',sans-serif;"><tbody>
			
           <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
           <tr style="width:110px;height:16px;font-size:10px!important;">
           	<td style="padding-right:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20110828053403/http://www.rubyquiz.com/quiz8.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="28 Aug 2011"><strong>AUG</strong></a>
		                
               </td>
               <td id="displayMonthEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight:bold;text-transform:uppercase;width:34px;height:15px;padding-top:1px;text-align:center;" title="You are here: 22:15:42 Jan 21, 2012">JAN</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20120418095514/http://www.rubyquiz.com/quiz8.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="18 Apr 2012"><strong>APR</strong></a>
		                
               </td>
           </tr>

           <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
           <tr>
               <td style="padding-right:9px;white-space:nowrap;overflow:visible;text-align:right!important;vertical-align:middle!important;" nowrap="nowrap">
               
		                <a href="/web/20110828053403/http://www.rubyquiz.com/quiz8.html" title="5:34:03 Aug 28, 2011" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0" /></a>
		                
               </td>
               <td id="displayDayEl" style="background:#000;color:#ff0;width:34px;height:24px;padding:2px 0 0 0;text-align:center;font-size:24px;font-weight: bold;" title="You are here: 22:15:42 Jan 21, 2012">21</td>
				<td style="padding-left:9px;white-space:nowrap;overflow:visible;text-align:left!important;vertical-align:middle!important;" nowrap="nowrap">
               
		                <a href="/web/20120122034011/http://rubyquiz.com/quiz8.html" title="3:40:11 Jan 22, 2012" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wm_tb_nxt_on.png" alt="Next capture" width="14" height="16" border="0"/></a>
		                
			    </td>
           </tr>

           <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
           <tr style="width:110px;height:13px;font-size:9px!important;">
				<td style="padding-right:9px;font-size:11px!important;font-weight: bold;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20101127175059/http://rubyquiz.com/quiz8.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="27 Nov 2010"><strong>2010</strong></a>
		                
               </td>
               <td id="displayYearEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight: bold;padding-top:1px;width:34px;height:13px;text-align:center;" title="You are here: 22:15:42 Jan 21, 2012">2012</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight: bold;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20130215052730/http://rubyquiz.com/quiz8.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="15 Feb 2013"><strong>2013</strong></a>
		                
				</td>
           </tr>
           </tbody></table>
       </td>

       </tr>
       <tr>
       <td style="vertical-align:middle;padding:0!important;">
           <a href="/web/20120121221542*/http://rubyquiz.com/quiz8.html" style="color:#33f;font-size:11px;font-weight:bold;background-color:transparent;border:none;" title="See a list of every capture for this URL"><strong>33 captures</strong></a>
           <div style="margin:0!important;padding:0!important;color:#666;font-size:9px;padding-top:2px!important;white-space:nowrap;" title="Timespan for captures of this URL">16 May 06 - 15 Feb 13</div>
       </td>
       <td style="padding:0!important;">
       <a style="position:relative; white-space:nowrap; width:450px;height:27px;" href="" id="wm-graph-anchor">
       <div id="wm-ipp-sparkline" style="position:relative; white-space:nowrap; width:450px;height:27px;background-color:#fff;cursor:pointer;border-right:1px solid #ccc;" title="Explore captures for this URL">
			<img id="sparklineImgId" style="position:absolute; z-index:9012; top:0px; left:0px;"
				onmouseover="showTrackers('inline');" 
				onmouseout="showTrackers('none');"
				onmousemove="trackMouseMove(event,this)"
				alt="sparklines"
				width="450"
				height="27"
				border="0"
				src="/web/jsp/graph.jsp?graphdata=450_27_1996:-1:000000000000_1997:-1:000000000000_1998:-1:000000000000_1999:-1:000000000000_2000:-1:000000000000_2001:-1:000000000000_2002:-1:000000000000_2003:-1:000000000000_2004:-1:000000000000_2005:-1:000000000000_2006:-1:000010000100_2007:-1:000001100000_2008:-1:000020000000_2009:-1:000000000000_2010:-1:000000000010_2011:-1:000001130000_2012:0:30015000a100_2013:-1:010000000000"></img>
			<img id="wbMouseTrackYearImg" 
				style="display:none; position:absolute; z-index:9010;"
				width="25" 
				height="27"
				border="0"
				src="/static/images/toolbar/transp-yellow-pixel.png"></img>
			<img id="wbMouseTrackMonthImg"
				style="display:none; position:absolute; z-index:9011; " 
				width="2"
				height="27" 
				border="0"
				src="/static/images/toolbar/transp-red-pixel.png"></img>
       </div>
		</a>

       </td>
       </tr></tbody></table>
   </td>
   <td style="text-align:right;padding:5px;width:65px;font-size:11px!important;">
       <a href="javascript:;" onclick="document.getElementById('wm-ipp').style.display='none';" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_close.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;margin-bottom:23px;background-color:transparent;border:none;" title="Close the toolbar">Close</a>
       <a href="http://faq.web.archive.org/" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_help.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;background-color:transparent;border:none;" title="Get some help using the Wayback Machine">Help</a>
   </td>
   </tr></tbody></table>

</div>
</div>
<script type="text/javascript">
 var wmDisclaimBanner = document.getElementById("wm-ipp");
 if(wmDisclaimBanner != null) {
   disclaimElement(wmDisclaimBanner);
 }
</script>
<!-- END WAYBACK TOOLBAR INSERT -->

	<div id="page">
		<div id="header"><span class="ruby">Ruby</span> <span class="quiz">Quiz</span></div>
		<div id="content">
			<span class="title">Object Browser (#8)</span>
			<p>by Jim Menard</p>
			<p>Recently on ruby-talk, itsme123 asked if there was a generic object browser that will "interactively browse a graph of connected objects by showing their instance variables and letting me click through to browse".</p>
			<p>The quiz challenge: write such a browser. It should be able to start at any object or, if none is given to it, start at the main object ("self" at the top level of any Ruby script).</p>
			<p>The interface to the browser can be text-based or graphical.</p>
			<p>I'm thinking of something like the Squeak Explorer (the new inspector). It's a window that displays the object with an open/close triangle next to it. Click the triangle, and the ivars are exposed.</p>
			<p class="example">V  root: an OrderedCollection(a MyClass, a Number)<br />   V 1: a MyClass<br />    &gt; name: 'the name'<br />    &gt; anotherIvar: 42<br />   &gt; 2: a Number</p>
			<p>That's just one possible UI, of course.</p>
			<p>Bonus points for allowing modification of instance variable values and for allowing inspection of classes (remember, classes are objects, too!).</p>
			<hr />
			<p><span class="title">Quiz Summary</span></p>
			<p>Brian Schr&ouml;der said:</p>
			<p class="example">I always wanted to learn more about the reflection capabilites of ruby,<br />and indeed there is quite a lot to learn. This quiz was not too<br />complicated, but the design of a good gui takes a lot of time.<br />(Especially if you're not accustomed to the toolkit).</p>
			<p>I agree and I think that about summarizes this quiz.</p>
			<p>The main point of the quiz is using "reflection".  What is reflection?  To quote the Pragmatic Programmers:</p>
			<p class="example">...to examine aspects of the program from within the program itself.</p>
			<p>Obviously, to write an Object Browser, we would need to be able to learn things about objects we didn't design and create.  This technique has a lot of practical applications though and odds are even a new Ruby programmer has seen it in action.</p>
			<p>Used tab completion in irb?  Built test cases with Test::Unit?  Both are great examples of tools that figure out your intentions by looking at Ruby code.  That's reflection.</p>
			<p>So, how do we do all that?  I don't want to recreate a bunch of documentation here, but here are some methods to look up if you're new to Ruby's reflection capabilities:</p>
			<p class="example"><a href="/web/20120121221542/http://www.ruby-doc.org/core/classes/ObjectSpace.html#M001384">ObjectSpace.each_object</a><br /><br /><a href="/web/20120121221542/http://www.ruby-doc.org/core/classes/Object.html#M000908">Object.class</a><br /><a href="/web/20120121221542/http://www.ruby-doc.org/core/classes/Object.html#M000920">Object.methods</a><br /><a href="/web/20120121221542/http://www.ruby-doc.org/core/classes/Object.html#M000925">Object.instance_variables</a><br /># and many more in Object<br /><br /><a href="/web/20120121221542/http://www.ruby-doc.org/core/classes/Module.html#M000714">Module.ancestors</a><br /><a href="/web/20120121221542/http://www.ruby-doc.org/core/classes/Module.html#M000692">Module.constants</a><br /><a href="/web/20120121221542/http://www.ruby-doc.org/core/classes/Module.html#M000730">Module.class_variables</a><br /># and many more in Module</p>
			<p>Putting such methods to use is pretty trivial.  Here's Brian's (original) code for building an object tree:</p>
			<div class="code"><span class="type">ruby</span><div class="body">    <span class="comment"># Class Tree</span><br />    <span class="keyword">class</span> ClassTreeNode<br />      attr_accessor :klass, :subclasses, :objects<br /><br />      <span class="keyword">def</span> initialize(klass)<br />        <span class="variable">@klass</span> = klass<br />        <span class="variable">@subclasses</span> = {}<br />        <span class="variable">@objects</span> = []<br />      <span class="keyword">end</span><br /><br />      <span class="keyword">def</span> add_class(klass)<br />        <span class="variable">@subclasses</span>[klass] ||= ClassTreeNode.new(klass)<br />      <span class="keyword">end</span><br /><br />      <span class="keyword">def</span> add_object(object)<br />        <span class="variable">@objects</span> &lt;&lt; object<br />        <span class="keyword">self</span><br />      <span class="keyword">end</span><br />    <span class="keyword">end</span><br /><br />    <span class="comment"># Creates or updates a klass_tree.</span><br />    <span class="comment"># When updating no classes or objects are removed</span><br />    <span class="keyword">def</span> object_browser(classtree = ClassTreeNode.new(Kernel))<br />      ObjectSpace.each_object <span class="keyword">do</span> | x |<br />        classnode = classtree<br />        x.<span class="keyword">class</span>.ancestors.reverse[1..-1] \<br />        .inject(classtree){ | classnode, klass |<br />          classnode.add_class(klass)<br />        }.add_object(x)<br />      <span class="keyword">end</span><br />      classtree<br />    <span class="keyword">end</span><br /><br /></div></div>
			<p>object_browser() just assembles a "Class Tree" by walking ObjectSpace.each_object() and using ancestors() to find parent Classes/Modules.  (Note the clever use of inject().  Isn't that iterator cool?!)</p>
			<p>The rest of Brian's solution (not shown) hands that Class Tree off to GUI routines, to build suitable displays.  These routines use more reflection methods to fetch method and variable lists.</p>
			<p>Both solutions use gtk2 to manage their GUIs.  That involves no small amount of code and is a little beyond the scope of this summary, so I'll simply refer you to the solutions if you want to dig deeper.</p>
			<p>I owe a big thanks to Jamis and Brian for pushing the quiz along this weekend while I was horribly busy.</p>
			<p>All teasers for the next quiz have been censored out of this summary.</p>
		</div>
		<div id="logo"><img src="/web/20120121221542im_/http://rubyquiz.com/images/ruby_quiz_logo.jpg" alt="" width="157" height="150" /></div>
		<div id="links">
			<span class="title">Quiz Solutions</span>
			<ol>
				<li><a href="/web/20120121221542/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/121005">Jamis Buck</a></li>
				<li><a href="/web/20120121221542/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/121093">Brian Schr&ouml;der</a></li>
				<li><a href="/web/20120121221542/http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/121357">Brian Schr&ouml;der (2)</a></li>
			</ol>
			<p><a href="/web/20120121221542/http://rubyquiz.com/quiz8_sols.zip">Download Solutions</a></p>
			<p><a href="/web/20120121221542/http://rubyquiz.com/index.html">Back to Quiz Listing</a></p>
		</div>
		<div id="footer">&nbsp;</div>
	</div>
</body>
</html>





<!--
     FILE ARCHIVED ON 22:15:42 Jan 21, 2012 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 13:09:04 Jun 5, 2013.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
